
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Fundamentals &#8212; scientific-visualization 2022 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="fundamentals">
<h1>Fundamentals<a class="headerlink" href="#fundamentals" title="Permalink to this headline">¶</a></h1>
<section id="anatomy-of-a-figure">
<span id="chap-anatomy"></span><h2>Anatomy of a figure<a class="headerlink" href="#anatomy-of-a-figure" title="Permalink to this headline">¶</a></h2>
<p>A matplotlib figure is composed of a hierarchy of elements that, when put
together, forms the actual figure as shown on figure <span class="xref std std-ref">fig-anatomy</span>. Most
of the time, those elements are not created explicitly by the user but derived
from the processing of the various plot commands. Let us consider for example
the most simple matplotlib script we can write:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>In order to display the result, matplotlib needs to create most of the elements
shown on figure <span class="xref std std-ref">fig-anatomy</span>. The exact list depends on your default
settings (see chapter <a class="reference internal" href="#chap-defaults">chap-defaults</a>), but the bare minimum is the creation of
a <a class="reference external" href="https://matplotlib.org/api/figure_api.html">Figure</a> that is the top level container for all the plot elements, an <a class="reference external" href="https://matplotlib.org/api/axes_api.html">Axes</a>
that contains most of the figure elements and of course your actual plot, a
line in this case. The possibility to not specify everything might be
convenient but in the meantime, it limits your choices because missing elements
are created automatically, using default values. For example, in the previous
example, you have no control of the initial figure size since it has been
chosen implicitly during creation. If you want to change the figure size or
the axes aspect, you need to be more explicit:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">aspect</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default" id="id12">
<a class="reference internal image-reference" href="rst/anatomy/anatomy.pdf"><img alt="rst/anatomy/anatomy.pdf" src="rst/anatomy/anatomy.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">A matplotlib figure is composed of a hierarchy of several elements that,
when put together, forms the actual figure (sources: <span class="source">anatomy/anatomy.py</span>).
<span class="label">fig-anatomy</span></span><a class="headerlink" href="#id12" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>In many cases, this can be further compacted using the <a class="reference external" href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.subplots.html">subplots</a> method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span>
                       <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;aspect&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<section id="elements">
<h3>Elements<a class="headerlink" href="#elements" title="Permalink to this headline">¶</a></h3>
<p>You may have noticed in the previous example that the <a class="reference external" href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.plot.html">plot</a> command is attached
to <span class="code">ax</span> instead of <span class="code">plt</span>. The use of <span class="code">plt.plot</span> is actually a way to tell
matplotlib that we want to plot on the current axes, that is, the last axes
that has been created, implicitly or explicitly. No need to remind that
<em>explicit is better than implicit</em> as explained in The Zen of Python, by
Tim Peters (<span class="code">import this</span>). When you have choice, it is thus preferable to
specify exactly what you want to do. Consequently, it is important to know what
are the different elements of a figure.</p>
<dl class="simple">
<dt><a class="reference external" href="https://matplotlib.org/api/figure_api.html">Figure</a>:</dt><dd><p>The most important element of a figure is the figure itself. It is created
when you call the <span class="code">figure</span> method and we’ve already seen you can specify its
size but you can also specify a background color (<span class="code">facecolor</span>) as well as a
title (<span class="code">suptitle</span>). It is important to know that the background color won’t
be used when you save the figure because the <a class="reference external" href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.savefig.html">savefig</a> function has also a
<span class="code">facecolor</span> argument (that is white by default) that will override your
figure background color. If you don’t want any background you can specify
<span class="code">transparent=True</span> when you save the figure.</p>
</dd>
<dt><a class="reference external" href="https://matplotlib.org/api/axes_api.html">Axes</a>:</dt><dd><p>This is the second most important element that corresponds to the actual area
where your data will be rendered. It is also called a subplot. You can have
one to many axes per figure and each is usually surrounded by four edges
(left, top, right and bottom) that are called <strong>spines</strong>. Each of these
spines can be decorated with major and minor <strong>ticks</strong> (that can point inward
or outward), <strong>tick labels</strong> and a <strong>label</strong>. By default, matplotlib
decorates only the left and bottom spines.</p>
</dd>
<dt><a class="reference external" href="https://matplotlib.org/api/axis_api.html">Axis</a>:</dt><dd><p>The decorated spines are called axis. The horizontal one is the <strong>xaxis</strong> and
the vertical one is the <strong>yaxis</strong>. Each of them are made of a spine, major and
minor ticks, major and minor ticks labels and an axis label.</p>
</dd>
<dt><a class="reference external" href="https://matplotlib.org/api/spines_api.html">Spines</a>:</dt><dd><p>Spines are the lines connecting the <strong>axis</strong> tick marks and noting the
boundaries of the data area. They can be placed at arbitrary positions and
may be visible or invisible.</p>
</dd>
<dt><a class="reference external" href="https://matplotlib.org/tutorials/intermediate/artists.html">Artist</a>:</dt><dd><p>Everything on the figure, including Figure, Axes, and Axis objects, is an
artist. This includes Text objects, Line2D objects, collection objects, Patch
objects. When the figure is rendered, all of the artists are drawn to the
canvas. A given artist can only be in one Axes.</p>
</dd>
</dl>
</section>
<section id="graphic-primitives">
<h3>Graphic primitives<a class="headerlink" href="#graphic-primitives" title="Permalink to this headline">¶</a></h3>
<p>A plot, independently of its nature, is made of patches, lines and
texts. Patches can be very small (e.g. markers) or very large (e.g. bars) and
have a range of shapes (circles, rectangles, polygons, etc.). Lines can be very
small and thin (e.g. ticks) or very thick (e.g. hatches). Text can use any font
available on your system and can also use a latex engine to render maths.</p>
<figure class="align-default" id="id13">
<a class="reference internal image-reference" href="rst/anatomy/bold-ticklabel.pdf"><img alt="rst/anatomy/bold-ticklabel.pdf" src="rst/anatomy/bold-ticklabel.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">All the graphic primitives (i.e. artists) can be accessed and modified. In
the figure above, we modified the boldness of the X axis tick labels
(sources: <span class="source">anatomy/bold-ticklabel.py</span>).</span><a class="headerlink" href="#id13" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Each of these graphic primitives have also a lot of other properties such as
color (facecolor and edgecolor), transparency (from 0 to 1), patterns
(e.g. dashes), styles (e.g. cap styles), special effects (e.g. shadows or
outline), antialiased (True or False), etc. Most of the time, you do not
manipulate these primitives directly. Instead, you call methods that build a
rendering using a collection of such primitives. For example, when you add a
new <span class="code">Axes</span> to a figure, matplotlib will build a collection of line segments for
the spines and the ticks and will also add a collection of labels for the tick
labels and the axis labels. Even though this is totally transparent for you,
you can still access those elements individually if necessary. For example, to
make the X axis tick to be bold, we would write:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">get_ticklabels</span><span class="p">():</span>
    <span class="n">label</span><span class="o">.</span><span class="n">set_fontweight</span><span class="p">(</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>One important property of any primitive is the <span class="code">zorder</span> property that indicates
the virtual depth of the primitives as shown on figure <span class="xref std std-ref">fig-zorder</span>. This
zorder value is used to sort the primitives from the lowest to highest before
rendering them. This allows to control what is behind what. Most artists
possess a default zorder value such that things are rendered properly. For
example, the spines, the ticks and the tick label are generally <em>behind</em>
your actual plot.</p>
<figure class="align-default" id="id14">
<a class="reference internal image-reference" href="rst/anatomy/zorder.pdf"><img alt="rst/anatomy/zorder.pdf" src="rst/anatomy/zorder.pdf" style="width: 50%;" /></a>
<figcaption>
<p><span class="caption-text">Default rendering order of different elements and graphic primitives. The
rendering order is from bottom to top. Note that some methods will override
these default to position themselves properly (sources: <span class="source">anatomy/zorder.py</span>).
<span class="label">fig-zorder</span></span><a class="headerlink" href="#id14" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="backends">
<h3>Backends<a class="headerlink" href="#backends" title="Permalink to this headline">¶</a></h3>
<p>A backend is the combination of a renderer that is responsible for the actual
drawing and an optional user interface that allows to interact with a
figure. Until now, we’ve been using the default renderer and interface
resulting in a window being shown when the <span class="code">plt.show()</span> method was called. To
know what is your default backend, you can type:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="nb">print</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">get_backend</span><span class="p">())</span>
</pre></div>
</div>
<p>In my case, the default backend is <span class="code">MacOSX</span> but yours may be different. If you
want to test for an alternative backend, you can type:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;xxx&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>If you replace <span class="code">xxx</span> with a renderer from table <span class="xref std std-ref">table-renderers</span> below,
you’ll end up with a non-interactive figure, i.e. a figure that cannot be shown
on screen but only saved on disk.</p>
<table class="docutils align-left" id="id15">
<caption><span class="caption-text">Available matplotlib renderers.
        <span class="label">table-renderers</span></span><a class="headerlink" href="#id15" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 13%" />
<col style="width: 25%" />
<col style="width: 63%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Renderer</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Filetype</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Agg</p></td>
<td><p>raster</p></td>
<td><p>Portable Network Graphic (PNG)</p></td>
</tr>
<tr class="row-odd"><td><p>PS</p></td>
<td><p>vector</p></td>
<td><p>Postscript (PS)</p></td>
</tr>
<tr class="row-even"><td><p>PDF</p></td>
<td><p>vector</p></td>
<td><p>Portable Document Format (PDF)</p></td>
</tr>
<tr class="row-odd"><td><p>SVG</p></td>
<td><p>vector</p></td>
<td><p>Scalable Vector Graphics (SVG)</p></td>
</tr>
<tr class="row-even"><td><p>Cairo</p></td>
<td><p>raster / vector</p></td>
<td><p>PNG / PDF / SVG</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-left" id="id16">
<caption><span class="caption-text">Available matplotlib interfaces.
<span class="label">table-interfaces</span></span><a class="headerlink" href="#id16" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 14%" />
<col style="width: 21%" />
<col style="width: 65%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Interface</p></th>
<th class="head"><p>Renderer</p></th>
<th class="head"><p>Dependencies</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>GTK3</p></td>
<td><p>Agg or Cairo</p></td>
<td><p><a class="reference external" href="https://pygobject.readthedocs.io/en/latest/">PyGObject</a> &amp; <a class="reference external" href="https://pycairo.readthedocs.io/en/latest/">Pycairo</a></p></td>
</tr>
<tr class="row-odd"><td><p>Qt4</p></td>
<td><p>Agg</p></td>
<td><p><a class="reference external" href="https://www.riverbankcomputing.com/software/pyqt/intro">PyQt4</a></p></td>
</tr>
<tr class="row-even"><td><p>Qt5</p></td>
<td><p>Agg</p></td>
<td><p><a class="reference external" href="https://www.riverbankcomputing.com/software/pyqt/intro">PyQt5</a></p></td>
</tr>
<tr class="row-odd"><td><p>Tk</p></td>
<td><p>Agg</p></td>
<td><p><a class="reference external" href="https://wiki.python.org/moin/TkInter">TkInter</a></p></td>
</tr>
<tr class="row-even"><td><p>Wx</p></td>
<td><p>Agg</p></td>
<td><p><a class="reference external" href="https://www.wxpython.org/">wxPython</a></p></td>
</tr>
<tr class="row-odd"><td><p>MacOSX</p></td>
<td><p>—</p></td>
<td><p>OSX (obviously)</p></td>
</tr>
<tr class="row-even"><td><p>Web</p></td>
<td><p>Agg</p></td>
<td><p>Browser</p></td>
</tr>
</tbody>
</table>
<p>The canonical renderer is Agg which uses the <a class="reference external" href="https://antigrain.com">Anti-Grain Geometry C++ library</a> to make a raster image of the figure (see figure
<span class="xref std std-ref">fig-raster-vector</span> to see the difference between raster and vector). Note
that even if you choose a raster renderer, you can still save the figure in a
vector format and vice-versa.</p>
<figure class="align-default" id="id17">
<a class="reference internal image-reference" href="rst/anatomy/raster-vector.pdf"><img alt="rst/anatomy/raster-vector.pdf" src="rst/anatomy/raster-vector.pdf" style="width: 75%;" /></a>
<figcaption>
<p><span class="caption-text">Zooming effect for raster graphics and vector graphics (sources:
<span class="source">anatomy/raster-vector.py</span>). <span class="label">fig-raster-vector</span></span><a class="headerlink" href="#id17" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>If you want to have some interaction with your figure, you have to combine one
of the available interfaces (see table <span class="xref std std-ref">table-interfaces</span>) with a
renderer (e.g. <span class="code">GTK3Cairo</span> that stands for GTK3 interface with Cairo
renderer).</p>
<p>For example, to have a rendering in a browser, you can write:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;webagg&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><strong>Warning.</strong> The <span class="code">use</span> function must be called before importing <span class="code">pyplot</span>.</p>
</div>
<p>Once you’ve chosen an interactive backend, you can decide to produce a figure
in interactive mode (figure is updated after each matplotlib command):</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>            <span class="c1"># Interactive mode on</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>    <span class="c1"># Plot is shown</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;X Axis&quot;</span><span class="p">)</span> <span class="c1"># Label is updated</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ioff</span><span class="p">()</span>           <span class="c1"># Interactive mode off</span>
</pre></div>
</div>
<p>If you want to know more on backends, you can have a look at the <a class="reference external" href="https://matplotlib.org/stable/users/explain/backends.html">matplotlib
user guide</a>
on the matplotlib website.</p>
<p>An interesting backend under OSX and <a class="reference external" href="https://iterm2.com/">iterm2</a>
terminal is the <a class="reference external" href="https://github.com/wookayin/python-imgcat">imgcat</a>
backend that allows to render a figure directly inside the terminal,
emulating a kind of jupyter notebook as shown on figure
<span class="xref std std-ref">figure-imgcat</span></p>
<figure class="align-default" id="id18">
<a class="reference internal image-reference" href="rst/anatomy/imgcat.png"><img alt="rst/anatomy/imgcat.png" src="rst/anatomy/imgcat.png" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Matplotlib imgcat backend
<span class="label">figure-imgcat</span>
(sources: <span class="source">anatomy/imgcat.py</span>).</span><a class="headerlink" href="#id18" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;module://imgcat&quot;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
<span class="n">line</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">X</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
<span class="n">line</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">X</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>For other terminals, you might need to use the <a class="reference external" href="https://github.com/koppa/matplotlib-sixel">sixel</a> backend that may work with xterm (not tested).</p>
</section>
<section id="dimensions-resolution">
<h3>Dimensions &amp; resolution<a class="headerlink" href="#dimensions-resolution" title="Permalink to this headline">¶</a></h3>
<p>In the first example of this chapter, we specified a figure size of <span class="code">(6,6)</span>
that corresponds to a size of 6 inches (width) by 6 inches (height) using a
default dpi (dots per inch) of 100. When displayed on a screen, dots
corresponds to pixels and we can immediately deduce that the figure size
(i.e. window size without the toolbar) will be exactly 600×600 pixels.  Same is
true if you save the figure in a bitmap format such as png (Portable Network
Graphics):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;output.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>If we use the <span class="code">identify</span> command from the <a class="reference external" href="https://imagemagick.org">ImageMagick</a> graphical suite to
enquiry about the produced image, we get:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ identify -verbose output.png
Image: output.png
  Format: PNG <span class="o">(</span>Portable Network Graphics<span class="o">)</span>
  Mime type: image/png
  Class: DirectClass
  Geometry: 600x600+0+0
  Resolution: <span class="m">39</span>.37x39.37
  Print size: <span class="m">15</span>.24x15.24
  Units: PixelsPerCentimeter
  Colorspace: sRGB
  ...
</pre></div>
</div>
<p>This confirms that the image geometry is 600×600 while the resolution is 39.37
ppc (pixels per centimeter) which corresponds to 39.37*2.54 ≈ 100 dpi (dots per
inch). If you were to include this image inside a document while keeping the
same dpi, you would need to set the size of the image to 15.24cm by 15.24cm. If
you reduce the size of the image in your document, let’s say by a factor of 3,
this will mechanically increase the figure dpi to 300 in this specific
case. For a scientific article, publishers will generally request figures dpi
to be between 300 and 600. To get things right, it is thus good to know what
will be the physical dimension of your figure once inserted into your document.</p>
<figure class="align-default" id="id19">
<a class="reference internal image-reference" href="rst/anatomy/figure-dpi.png"><img alt="rst/anatomy/figure-dpi.png" src="rst/anatomy/figure-dpi.png" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">A text rendered in matplotlib and saved using different dpi (50,100,300 &amp;
600)  (sources: <span class="source">anatomy/figure-dpi.py</span>). <span class="label">figure-dpi</span></span><a class="headerlink" href="#id19" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>For a more concrete example, let us consider this book whose format is A5
(148×210 millimeters). Right and left margins are 20 millimeters each and
images are usually displayed using the full text width. This means the physical
width of an image is exactly 108 millimeters, or approximately 4.25 inches. If
we were to use the recommended 600 dpi, we would end up with a width of 2550
pixels which might be beyond screen resolution and thus not very convenient.
Instead, we can use the default matplotlib dpi (100) when we display the figure
on the screen and only when we save it, we use a different and higher dpi:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">figure</span><span class="p">(</span><span class="n">dpi</span><span class="p">):</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">4.25</span><span class="p">,</span><span class="mf">.2</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Text rendered at 10pt using </span><span class="si">%d</span><span class="s2"> dpi&quot;</span> <span class="o">%</span> <span class="n">dpi</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
            <span class="n">fontname</span><span class="o">=</span><span class="s2">&quot;Source Serif Pro&quot;</span><span class="p">,</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;light&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;figure-dpi-</span><span class="si">%03d</span><span class="s2">.png&quot;</span> <span class="o">%</span> <span class="n">dpi</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>

<span class="n">figure</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span> <span class="n">figure</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span> <span class="n">figure</span><span class="p">(</span><span class="mi">300</span><span class="p">),</span> <span class="n">figure</span><span class="p">(</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
<p>Figure <span class="xref std std-ref">figure-dpi</span> shows the output for the different dpi. Only the 600
dpi output is acceptable. Note that when it is possible, it is preferable to
save the result in PDF (Portable Document Format) because it is a vector format
that will adapt flawlessly to any resolution. However, even if you save your
figure in a vector format, you still need to indicate a dpi for figure elements
that cannot be vectorized (e.g .images).</p>
<p>Finally, you may have noticed that the font size on figure <span class="xref std std-ref">figure-dpi</span>
appears to be the same as the font size of the text you’re currently
reading. This is not by accident since this Latex document uses a font size of
10 points and the matplotlib figure also uses a font size of 10 points. But
what is a point exactly? In Latex, a point (pt) corresponds to 1/72.27 inches
while in matplotlib it corresponds to 1/72 inches.</p>
<p>To help you visualize the exact dimension of your figure, it is
possible to add a ruler to a figure such that it displays current
figure dimension as shown on figure <span class="xref std std-ref">figure-ruler</span>. If you
manually resize the figure, you’ll see that the actual dimension of
the figure changes while if you only change the dpi, the size will
remain the same. Usage is really simple:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ruler</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ruler</span> <span class="o">=</span> <span class="n">ruler</span><span class="o">.</span><span class="n">Ruler</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default" id="id20">
<a class="reference internal image-reference" href="rst/anatomy/ruler.pdf"><img alt="rst/anatomy/ruler.pdf" src="rst/anatomy/ruler.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Interactive ruler <span class="label">figure-ruler</span>
(<span class="source">anatomy/ruler.py</span>).</span><a class="headerlink" href="#id20" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="exercise">
<h3>Exercise<a class="headerlink" href="#exercise" title="Permalink to this headline">¶</a></h3>
<p>It’s now time to try to make some simple exercises gathering all the concepts
we’ve seen so far (including finding the relevant documentation).</p>
<p><strong>Exercise 1</strong> Try to produce a figure with a given (and exact) pixel size
(e.g. 512x512 pixels). How would you specify the size and save the figure?</p>
<figure class="align-default" id="id21">
<a class="reference internal image-reference" href="rst/anatomy/pixel-font.png"><img alt="rst/anatomy/pixel-font.png" src="rst/anatomy/pixel-font.png" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Pixel font text using exact image size <span class="label">figure-pixel-font</span>
(<span class="source">anatomy/pixel-font.py</span>).</span><a class="headerlink" href="#id21" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p><strong>Exercise 2</strong>
The goal is to make the figure <span class="xref std std-ref">figure-inch-cm</span> that shows a dual axis, one
in inches and one in centimeters. The difficulty is that we want the
centimeters and inched to be physically correct when printed. This requires
some simple computations for finding the right size and some trials and errors
to make the actual figure. Don’t pay too much attention to all the details, the
essential part is to get the size right.</p>
<figure class="align-default" id="id22">
<a class="reference internal image-reference" href="rst/anatomy/inch-cm.pdf"><img alt="rst/anatomy/inch-cm.pdf" src="rst/anatomy/inch-cm.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Inches/centimeter conversion <span class="label">figure-inch-cm</span>
(<strong>solution</strong>: <span class="source">anatomy/inch-cm.py</span>).</span><a class="headerlink" href="#id22" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p><strong>Exercise 3</strong></p>
<p>Here we’ll try to reproduce the figure <span class="xref std std-ref">figure-zorder-plots</span>. If you look
at the figure, you’ll realize that each curve is partially covering other
curves and it is thus important to set a proper zorder for each curve such that
the rendering will be independent of drawing order. For the actual curves, you can start from the following code:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">curve</span><span class="p">():</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">centers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
    <span class="n">widths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span><span class="mf">50.0</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
    <span class="n">widths</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">widths</span><span class="o">/</span><span class="n">widths</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">scales</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
    <span class="n">scales</span> <span class="o">/=</span> <span class="n">scales</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">center</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">scale</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">centers</span><span class="p">,</span> <span class="n">widths</span><span class="p">,</span> <span class="n">scales</span><span class="p">):</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">X</span> <span class="o">+</span> <span class="n">scale</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">center</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">center</span><span class="p">)</span><span class="o">*</span><span class="n">width</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">X</span>
</pre></div>
</div>
<figure class="align-default" id="id23">
<a class="reference internal image-reference" href="rst/anatomy/zorder-plots.pdf"><img alt="rst/anatomy/zorder-plots.pdf" src="rst/anatomy/zorder-plots.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Multiple plots partially covering each other <span class="label">figure-zorder-plots</span>
(<strong>solution</strong>: <span class="source">anatomy/zorder-plots.py</span>).</span><a class="headerlink" href="#id23" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p></p>
</section>
</section>
<section id="coordinate-systems">
<span id="chap-coordinates"></span><h2>Coordinate systems<a class="headerlink" href="#coordinate-systems" title="Permalink to this headline">¶</a></h2>
<p>In any matplotlib figure, there is at least two different coordinate systems
that co-exist anytime. One is related to the figure (FC) while the others are
related to each of the individual plots (DC). Each of these coordinate systems
exists in normalized (NxC) or native version (xC) as illustrated in figures
<span class="xref std std-ref">fig-coordinates-cartesian</span> and <span class="xref std std-ref">fig-coordinates-polar</span>. To convert a
coordinate from one system to the other, matplotlib provides a set of
<span class="code">transform</span> functions:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">360</span><span class="p">),</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="c1">#  FC : Figure coordinates (pixels)</span>
<span class="c1"># NFC : Normalized figure coordinates (0 → 1)</span>
<span class="c1">#  DC : Data coordinates (data units)</span>
<span class="c1"># NDC : Normalized data coordinates (0 → 1)</span>

<span class="n">DC_to_FC</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">transData</span><span class="o">.</span><span class="n">transform</span>
<span class="n">FC_to_DC</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">transData</span><span class="o">.</span><span class="n">inverted</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span>

<span class="n">NDC_to_FC</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="o">.</span><span class="n">transform</span>
<span class="n">FC_to_NDC</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="o">.</span><span class="n">inverted</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span>

<span class="n">NFC_to_FC</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">transFigure</span><span class="o">.</span><span class="n">transform</span>
<span class="n">FC_to_NFC</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">transFigure</span><span class="o">.</span><span class="n">inverted</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span>
</pre></div>
</div>
<figure class="align-default" id="id24">
<a class="reference internal image-reference" href="rst/coordinates/coordinates-cartesian.pdf"><img alt="rst/coordinates/coordinates-cartesian.pdf" src="rst/coordinates/coordinates-cartesian.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">The co-existing coordinate systems within a figure using Cartesian
projection. <strong>FC</strong>: Figure Coordinates, <strong>NFC</strong> Normalized Figure Coordinates,
<strong>DC</strong>: Data Coordinates, <strong>NDC</strong>: Normalized Data Coordinates.
<span class="label">fig-coordinates-cartesian</span></span><a class="headerlink" href="#id24" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="id25">
<a class="reference internal image-reference" href="rst/coordinates/coordinates-polar.pdf"><img alt="rst/coordinates/coordinates-polar.pdf" src="rst/coordinates/coordinates-polar.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">The co-existing coordinate systems within a figure using Polar projection.
<strong>FC</strong>: Figure Coordinates, <strong>NFC</strong> Normalized Figure Coordinates, <strong>DC</strong>:
Data Coordinates, <strong>NDC</strong>: Normalized Data Coordinates.
<span class="label">fig-coordinates-polar</span></span><a class="headerlink" href="#id25" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Let’s test these functions on some specific points (corners):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Top right corner in normalized figure coordinates</span>
<span class="nb">print</span><span class="p">(</span><span class="n">NFC_to_FC</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span>  <span class="c1"># (600,500)</span>

<span class="c1"># Top right corner in normalized data coordinates</span>
<span class="nb">print</span><span class="p">(</span><span class="n">NDC_to_FC</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span>  <span class="c1"># (540,440)</span>

<span class="c1"># Top right corner in data coordinates</span>
<span class="nb">print</span><span class="p">(</span><span class="n">DC_to_FC</span><span class="p">([</span><span class="mi">360</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span> <span class="c1"># (540,440)</span>
</pre></div>
</div>
<p>Since we also have the inverse functions, we can create our own transforms. For
example, from native data coordinates (DC) to normalized data coordinates (NDC):</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Native data to normalized data coordinates</span>
<span class="n">DC_to_NDC</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">FC_to_NDC</span><span class="p">(</span><span class="n">DC_to_FC</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

<span class="c1"># Bottom left corner in data coordinates</span>
<span class="nb">print</span><span class="p">(</span><span class="n">DC_to_NDC</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]))</span>  <span class="c1"># (0.0, 0.0)</span>

<span class="c1"># Center in data coordinates</span>
<span class="nb">print</span><span class="p">(</span><span class="n">DC_to_NDC</span><span class="p">([</span><span class="mi">180</span><span class="p">,</span><span class="mi">0</span><span class="p">]))</span>  <span class="c1"># (0.5, 0.5)</span>

<span class="c1"># Top right corner in data coordinates</span>
<span class="nb">print</span><span class="p">(</span><span class="n">DC_to_NDC</span><span class="p">([</span><span class="mi">360</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span>  <span class="c1"># (1.0, 1.0)</span>
</pre></div>
</div>
<p>When using Cartesian projection, the correspondence is quite clear between the
normalized and native data coordinates. With other kind of projection, things
work just the same even though it might appear less obvious. For example, let
us consider a polar projection where we want to draw the outer axes border. In
normalized data coordinates, we know the coordinates of the four corners,
namely <span class="code">(0,0)</span>, <span class="code">(1,0)</span>, <span class="code">(1,1)</span> and <span class="code">(0,1)</span>. We can then transform these
normalized data coordinates back to native data coordinates and draw the
border. There is however a supplementary difficulty because those coordinates
are beyond the axes limit and we’ll need to tell matplotlib to not care about
the limit using the <span class="code">clip_on</span> arguments.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;polar&#39;</span><span class="p">)</span>

<span class="n">FC_to_DC</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">transData</span><span class="o">.</span><span class="n">inverted</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span>
<span class="n">NDC_to_FC</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="o">.</span><span class="n">transform</span>
<span class="n">NDC_to_DC</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">FC_to_DC</span><span class="p">(</span><span class="n">NDC_to_FC</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="n">P</span> <span class="o">=</span> <span class="n">NDC_to_DC</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">P</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">P</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">10</span>
         <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">P</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">P</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
           <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>The result is shown on figure <span class="xref std std-ref">fig-transforms-polar</span>.</p>
<figure class="align-default" id="id26">
<a class="reference internal image-reference" href="rst/coordinates/transforms-polar.pdf"><img alt="rst/coordinates/transforms-polar.pdf" src="rst/coordinates/transforms-polar.pdf" style="width: 75%;" /></a>
<figcaption>
<p><span class="caption-text">Axes boundaries in polar projection using a transform from normalized data
coordinates to data coordinates (<span class="source">coordinates/transform-polar.py</span>).
<span class="label">fig-transforms-polar</span></span><a class="headerlink" href="#id26" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>However, most of the time, you won’t need to use these transform functions
explicitly but rather implicitly. For example, consider the case where you
want to add some text over a specific plot. For this, you need to use the <a class="reference external" href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.text.html">text</a>
function and specify what is to be written (of course) and the coordinates
where you want to display the text. The question (for matplotlib) is how to
consider these coordinates? Are they expressed in data coordinates? normalized
data coordinates? normalized figure coordinates? The default is to consider
they are expressed in data coordinates. Consequently, if you want to us a
different system, you’ll need to explicitly specify a <span class="code">transform</span> when calling
the function. Let’s say for example we want to add a letter on the bottom left
corner. We can write:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>The letter will be placed at 10% from the left spine and 10% from the bottom
spine. If the two spines have the same physical size (in pixels), the letter
will be equidistant from the right and bottom spines. But, if they have
different size, this won’t be true anymore and the results will not be very
satisfying (see panel A of figure <span class="xref std std-ref">fig-transforms-letter</span>). What we want
to do instead is to specify a transform that is a combination of the normalized
data coordinates (0,0) plus an offset expressed in figure native units
(pixels). To do that, we need to build our own transform function to compute
the offset:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib.transforms</span> <span class="kn">import</span> <span class="n">ScaledTranslation</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="mi">10</span><span class="o">/</span><span class="n">fig</span><span class="o">.</span><span class="n">dpi</span><span class="p">,</span> <span class="mi">10</span><span class="o">/</span><span class="n">fig</span><span class="o">.</span><span class="n">dpi</span>
<span class="n">offset</span> <span class="o">=</span> <span class="n">ScaledTranslation</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">fig</span><span class="o">.</span><span class="n">dpi_scale_trans</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>The result is illustrated on panel B of figure <span class="xref std std-ref">fig-transforms-letter</span>.
The text is now properly positioned and will stay at the right position
independently of figure aspect ratio or data limits.</p>
<figure class="align-default" id="id27">
<a class="reference internal image-reference" href="rst/coordinates/transforms-letter.pdf"><img alt="rst/coordinates/transforms-letter.pdf" src="rst/coordinates/transforms-letter.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Using transforms to position precisely a text over a plot. Top panel uses
normalized data coordinates (0.1,0.1), bottom panel uses normalized data
coordinates (0.0,0.0) plus an offset (10,10) expressed in figure
coordinates (<span class="source">coordinates/transform-letter.py</span>). <span class="label">fig-transforms-letter</span></span><a class="headerlink" href="#id27" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Things can become even more complicated when you need a different transform on
the X and Y axis. Let us consider for example the case where you want to add
some text below the X tick labels. The X position of the tick labels is
expressed in data coordinates, but how do we put something under as illustrated
on figure <span class="xref std std-ref">fig-transforms-blend</span>?</p>
<figure class="align-default" id="id28">
<a class="reference internal image-reference" href="rst/coordinates/transforms-blend.pdf"><img alt="rst/coordinates/transforms-blend.pdf" src="rst/coordinates/transforms-blend.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Precise placement (arrows below X axis tick labels) using blended transform (<span class="source">coordinates/transforms-blend.py</span>).
<span class="label">fig-transforms-blend</span></span><a class="headerlink" href="#id28" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>The natural unit for text is point and we thus want to position our arrow using
a Y offset expressed in points. To do that, we need to use a blend transform:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">point</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">72</span>
<span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5</span><span class="o">*</span><span class="n">fontsize</span><span class="o">*</span><span class="n">point</span>
<span class="n">offset</span> <span class="o">=</span> <span class="n">ScaledTranslation</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">fig</span><span class="o">.</span><span class="n">dpi_scale_trans</span><span class="p">)</span>
<span class="n">transform</span> <span class="o">=</span> <span class="n">blended_transform_factory</span><span class="p">(</span>
                 <span class="n">ax</span><span class="o">.</span><span class="n">transData</span><span class="p">,</span> <span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="o">+</span><span class="n">offset</span><span class="p">)</span>
</pre></div>
</div>
<p>We can also use transformations to a totally different usage as shown
on figure <span class="xref std std-ref">figure-collage</span>. To obtain such figure, I rewrote the
<a class="reference external" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.imshow.html">imshow</a>
function to apply translation, scaling and rotation and I call the
function 200 times with random values.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">imshow</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">I</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">extent</span> <span class="o">=</span> <span class="n">scale</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
                               <span class="o">-</span><span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Affine2D</span><span class="p">()</span><span class="o">.</span><span class="n">rotate_deg</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="o">*</span><span class="n">position</span><span class="p">)</span>
    <span class="n">im</span><span class="o">.</span><span class="n">set_transform</span><span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="n">ax</span><span class="o">.</span><span class="n">transData</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-default" id="id29">
<a class="reference internal image-reference" href="rst/coordinates/collage.png"><img alt="rst/coordinates/collage.png" src="rst/coordinates/collage.png" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Collage
<span class="label">figure-collage</span>
(sources: <span class="source">coordinates/collage.py</span>).</span><a class="headerlink" href="#id29" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Transformations are quite powerful tools even though you won’t manipulate them
too often in your daily life. But there are a few cases where you’ll be
happy to know about them. You can read further on transforms and coordinates
with the <a class="reference external" href="https://matplotlib.org/tutorials/advanced/transforms_tutorial.html">Transformation tutorial</a> on the matplotlib website.</p>
<section id="real-case-usage">
<h3>Real case usage<a class="headerlink" href="#real-case-usage" title="Permalink to this headline">¶</a></h3>
<p>Let’s now study a real case of transforms as shown on figure
<span class="xref std std-ref">fig-transforms-hist</span>. This is a simple scatter plot showing some Gaussian
data, with two principal axis. I added a histogram that is orthogonal to the
first principal component axis to show the distribution on the main axis.
This figure might appear simple (a scatter plot and an oriented histogram) but
the reality is quite different and rendering such a figure is far from
obvious. The main difficulty is to have the histogram at the right position,
size and orientation knowing that position must be set in data coordinates,
size must be given in figure normalized coordinates and orientation in
degrees. To complicate things, we want to express the elevation of the text
above the histogram bars in data points. </p>
<figure class="align-default" id="id30">
<a class="reference internal image-reference" href="rst/coordinates/transforms-hist.pdf"><img alt="rst/coordinates/transforms-hist.pdf" src="rst/coordinates/transforms-hist.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Rotated histogram aligned with second main PCA axis
(<span class="source">coordinates/transforms-hist.py</span>). <span class="label">fig-transforms-hist</span></span><a class="headerlink" href="#id30" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>You can have a look at the sources for the complete story but let’s concentrate
on the main difficulty, that is adding a rotated floating axis. Let us start with
a simple figure:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.transforms</span> <span class="kn">import</span> <span class="n">Affine2D</span>
<span class="kn">import</span> <span class="nn">mpl_toolkits.axisartist.floating_axes</span> <span class="k">as</span> <span class="nn">floating</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                  <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">])</span>
</pre></div>
</div>
<p>Let’s imagine we want to have a floating axis whose center is (5,5) in data
coordinates, size is (5,3) in data coordinates and orientation is -30 degrees:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>
<span class="n">size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
<span class="n">orientation</span> <span class="o">=</span> <span class="o">-</span><span class="mi">30</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">size</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="p">[(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
<span class="n">rotation</span> <span class="o">=</span> <span class="n">Affine2D</span><span class="p">()</span><span class="o">.</span><span class="n">rotate_deg</span><span class="p">(</span><span class="n">orientation</span><span class="p">)</span>
<span class="n">P</span> <span class="o">=</span> <span class="n">center</span> <span class="o">+</span> <span class="n">rotation</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
<p>In the code above, we defined the four points delimiting the extent of our new
axis and we took advantage of matplotlib affine transforms to do the actual
rotation. At this point, we have thus four points describing the border of the
axis in data coordinates and we need to transform them in figure normalized
coordinates because the floating axis requires normalized figure coordinates.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">DC_to_FC</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">transData</span><span class="o">.</span><span class="n">transform</span>
<span class="n">FC_to_NFC</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">transFigure</span><span class="o">.</span><span class="n">inverted</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span>
<span class="n">DC_to_NFC</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">FC_to_NFC</span><span class="p">(</span><span class="n">DC_to_FC</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</pre></div>
</div>
<p>We have one supplementary difficulty because the position of a floating axis
needs to be defined in terms of the non-rotated bounding box:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span> <span class="o">=</span> <span class="n">DC_to_NFC</span><span class="p">((</span><span class="n">P</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">P</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()))</span>
<span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">DC_to_NFC</span><span class="p">((</span><span class="n">P</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">P</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
</pre></div>
</div>
<p>We now have all the information to add our new axis:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">transform</span> <span class="o">=</span> <span class="n">Affine2D</span><span class="p">()</span><span class="o">.</span><span class="n">rotate_deg</span><span class="p">(</span><span class="n">orientation</span><span class="p">)</span>
<span class="n">helper</span> <span class="o">=</span> <span class="n">floating</span><span class="o">.</span><span class="n">GridHelperCurveLinear</span><span class="p">(</span>
              <span class="n">transform</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">floating</span><span class="o">.</span><span class="n">FloatingSubplot</span><span class="p">(</span>
              <span class="n">fig</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="n">grid_helper</span><span class="o">=</span><span class="n">helper</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_position</span><span class="p">((</span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="o">-</span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymax</span><span class="o">-</span><span class="n">xmin</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">ax2</span><span class="p">)</span>
</pre></div>
</div>
<p>The result is shown on figure <span class="xref std std-ref">fig-transforms-floating-axis</span>.</p>
</section>
<section id="id2">
<h3>Exercise<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p><strong>Exercise 1</strong> When you specify the size of markers in a scatter plot, this
size is expressed in points. Try to make a scatter plot whose size is expressed
in data points such as to obtain figure <span class="xref std std-ref">fig-transforms-exercise-1</span>.</p>
<figure class="align-default" id="id31">
<a class="reference internal image-reference" href="rst/coordinates/transforms-exercise-1.pdf"><img alt="rst/coordinates/transforms-exercise-1.pdf" src="rst/coordinates/transforms-exercise-1.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">A scatter plot whose marker size is expressed in data coordinates instead of points
(<span class="source">coordinates/transforms-exercise-1.py</span>).
<span class="label">fig-transforms-exercise-1</span></span><a class="headerlink" href="#id31" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="id32">
<a class="reference internal image-reference" href="rst/coordinates/transforms-floating-axis.pdf"><img alt="rst/coordinates/transforms-floating-axis.pdf" src="rst/coordinates/transforms-floating-axis.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">A floating and rotated floating axis with controlled position size and
rotation (<span class="source">coordinates/transforms-floating-axis.py</span>).
<span class="label">fig-transforms-floating-axis</span></span><a class="headerlink" href="#id32" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p></p>
</section>
</section>
<section id="scales-projections">
<span id="chap-projection"></span><h2>Scales &amp; projections<a class="headerlink" href="#scales-projections" title="Permalink to this headline">¶</a></h2>
<p>Beyond affine transforms, matplotlib also offers advanced transformations that
allows to drastically change the representation of your data without ever
modifying it. Those transformations correspond to a data preprocessing stage
that allows you to adapt the rendering to the nature of your data. As explained
in the matplotlib documentation, there are two main families of transforms:
separable transformations, working on a single dimension, are called
<span class="nameref">scales</span>, and non-separable transformations, that handle data in two
or more dimensions at once are called <span class="nameref">projections</span>.</p>
<section id="scales">
<h3>Scales<a class="headerlink" href="#scales" title="Permalink to this headline">¶</a></h3>
<p>Scales provide a mapping mechanism between the data and their representation
in the figure along a given dimension. Matplotlib offers four different scales
(<span class="code">linear</span>, <span class="code">log</span>, <span class="code">symlog</span> and <span class="code">logit</span>) and takes care, for each of them, of
modifying the figure such as to adapt the ticks positions and labels (see
figure <span class="xref std std-ref">figure-scales</span>). Note that a scale can be applied to x axis only
(<span class="code">set_xscale</span>), y axis only (<span class="code">set_yscale</span>) or both.</p>
<figure class="align-default" id="id33">
<a class="reference internal image-reference" href="rst/scales-projections/scales-comparison.pdf"><img alt="rst/scales-projections/scales-comparison.pdf" src="rst/scales-projections/scales-comparison.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Comparison of the <a class="reference external" href="https://matplotlib.org/api/scale_api.html?#matplotlib.scale.LinearScale">linear</a>, <a class="reference external" href="https://matplotlib.org/api/scale_api.html?#matplotlib.scale.LogScale">log</a> and <a class="reference external" href="https://matplotlib.org/api/scale_api.html?#matplotlib.scale.LogitScale">logit</a> scales.
<span class="label">figure-scales</span> (sources: <span class="source">scales-projections/scales-comparison.py</span>).</span><a class="headerlink" href="#id33" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>The default (and implicit) scale is <a class="reference external" href="https://matplotlib.org/api/scale_api.html?#matplotlib.scale.LinearScale">linear</a> and it is thus generally not
necessary to specify anything. You can check if a scale is linear by comparing
the distance between three points in the figure coordinates (actually we should
compare every points but you get the idea) and check whether their difference
in data space is the same as in figure space modulo a given factor (see
<span class="source">scales-projections/scales-check.py</span>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
<span class="go">                     aspect=1, xlim=[0,100], ylim=[0,100])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">P0</span><span class="p">,</span> <span class="n">P1</span><span class="p">,</span> <span class="n">P2</span><span class="p">,</span> <span class="n">P3</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">transform</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">transData</span><span class="o">.</span><span class="n">transform</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span> <span class="p">(</span><span class="n">transform</span><span class="p">(</span><span class="n">P1</span><span class="p">)</span><span class="o">-</span><span class="n">transform</span><span class="p">(</span><span class="n">P0</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
<span class="go">4.185</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span> <span class="p">(</span><span class="n">transform</span><span class="p">(</span><span class="n">P2</span><span class="p">)</span><span class="o">-</span><span class="n">transform</span><span class="p">(</span><span class="n">P1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
<span class="go">41.85</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span> <span class="p">(</span><span class="n">transform</span><span class="p">(</span><span class="n">P3</span><span class="p">)</span><span class="o">-</span><span class="n">transform</span><span class="p">(</span><span class="n">P2</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
<span class="go">418.5</span>
</pre></div>
</div>
<p>Logarithmic scale (<a class="reference external" href="https://matplotlib.org/api/scale_api.html?#matplotlib.scale.LogScale">log</a>) is a nonlinear scale where, instead of increasing in equal
increments, each interval is increased by a factor of the base of the logarithm
(hence the name). Log scales are used for values that are strictly positive since
the logarithm is undefined for negative and null values. If we apply the previous
script to check the difference in data and figure space, you can now see the
distances are the same:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
<span class="go">                     aspect=1, xlim=[0.1,100], ylim=[0.1,100])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">P0</span><span class="p">,</span> <span class="n">P1</span><span class="p">,</span> <span class="n">P2</span><span class="p">,</span> <span class="n">P3</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">transform</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">transData</span><span class="o">.</span><span class="n">transform</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span> <span class="p">(</span><span class="n">transform</span><span class="p">(</span><span class="n">P1</span><span class="p">)</span><span class="o">-</span><span class="n">transform</span><span class="p">(</span><span class="n">P0</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
<span class="go">155.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span> <span class="p">(</span><span class="n">transform</span><span class="p">(</span><span class="n">P2</span><span class="p">)</span><span class="o">-</span><span class="n">transform</span><span class="p">(</span><span class="n">P1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
<span class="go">155.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span> <span class="p">(</span><span class="n">transform</span><span class="p">(</span><span class="n">P3</span><span class="p">)</span><span class="o">-</span><span class="n">transform</span><span class="p">(</span><span class="n">P2</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
<span class="go">155.0</span>
</pre></div>
</div>
<p>If your data has negative values, you have to use a symmetric log scale (<a class="reference external" href="https://matplotlib.org/api/scale_api.html?#matplotlib.scale.SymmetricalLogScale">symlog</a>)
that is a composition of both a linear and a logarithmic scale. More precisely,
values around 0 use a linear scale and values outside the vicinity of zero uses
a logarithmic scale. You can of course specify the extent of the linear zone
when you set the scale. The <a class="reference external" href="https://matplotlib.org/api/scale_api.html?#matplotlib.scale.LogitScale">logit</a> scale is used for values in the range ]0,1[
and uses a logarithmic scale on the “border” and a quasi-linear scale in the
middle (around 0.5). If none of these scales suit your needs, you still have
the option to define your own custom scale:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">inverse</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;function&#39;</span><span class="p">,</span> <span class="n">functions</span><span class="o">=</span><span class="p">(</span><span class="n">forward</span><span class="p">,</span> <span class="n">inverse</span><span class="p">))</span>
</pre></div>
</div>
<p>In such case, you have to provide both the forward and inverse function that
allows to transform your data. The inverse function is used when displaying
coordinates under the mouse pointer.</p>
<figure class="align-default" id="id34">
<a class="reference internal image-reference" href="rst/scales-projections/scales-custom.pdf"><img alt="rst/scales-projections/scales-custom.pdf" src="rst/scales-projections/scales-custom.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Custom (user defined) scales.
<span class="label">figure-scales-custom</span> (sources: <span class="source">scales-projections/scales-custom.py</span>).</span><a class="headerlink" href="#id34" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Finally, if you need a custom scale with complex transforms, you may need to
write a proper scale object as it is explained on the <a class="reference external" href="https://matplotlib.org/gallery/scales/custom_scale.html">matplotlib documentation</a>.</p>
</section>
<section id="projections">
<h3>Projections<a class="headerlink" href="#projections" title="Permalink to this headline">¶</a></h3>
<p>Projections are a bit more complex than scales but in the meantime much more
powerful. Projections allows you to apply arbitrary transformation to your data
before rendering them in a figure. There is no real limit on the kind of
transformation you can apply as long as you know how to transform your data into
something that will be 2 dimensional (the figure space) and reciprocally. In
other words, you need to define a forward and an inverse
transformation. Matplotlib comes with only a few standard projections but offers
all the machinery to create new domain-dependent projection such as for example
cartographic projection. You might wonder why there are so few native
projections. The answer is that it would be too time-consuming and too difficult
for the developers to implement and maintain each and every projections that
are domain specific. They chose instead to restrict projection to the most
generic ones, namely <a class="reference external" href="https://matplotlib.org/api/projections_api.html#module-matplotlib.projections.polar">polar</a> and <a class="reference external" href="https://matplotlib.org/mpl_toolkits/mplot3d/tutorial.html">3d</a>.</p>
<p>We’ve already seen the polar projection in the previous chapter. The most simple
and straightforward way to use is to specify the projection when you create an
axis:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;polar&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This axis is now equipped with a polar projection. This means that any plotting
command you apply is pre-processed such as to apply (automatically) the forward
transformation on the data. In the case of a polar projection, the forward
transformation must specify how to go from polar coordinates <span class="math notranslate nohighlight">\((\rho,
\theta)\)</span> to Cartesian coordinates <span class="math notranslate nohighlight">\((x,y) = (\rho cos(\theta), \rho
sin(\theta))\)</span>. When you declare a polar axis, you can specify limits of the axis
as we’ve done previously but we have also some dedicated settings such as
<span class="code">set_thetamin</span>, <span class="code">set_thetamax</span>, <span class="code">set_rmin</span>, <span class="code">set_rmax</span> and more specifically
<span class="code">set_rorigin</span>. This allows you to have fine control over what is actually shown as illustrated on the figure <span class="xref std std-ref">figure-projection-polar-config</span>.</p>
<figure class="align-default" id="id35">
<a class="reference internal image-reference" href="rst/scales-projections/projection-polar-config.pdf"><img alt="rst/scales-projections/projection-polar-config.pdf" src="rst/scales-projections/projection-polar-config.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Polar projection
<span class="label">figure-projection-polar-config</span>
(sources: <span class="source">scales-projections/projection-polar-config.py</span>).</span><a class="headerlink" href="#id35" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>If you now try to do some plots (e.g. plot, scatter, bar), you’ll see that
everything is transformed but a few elements. More precisely, the shape of
markers is not transformed (a disc marker will remains a disc visually), the
text is not transformed (such that it remains readable) and the width of lines
is kept constant. Let’s have a look at a more elaborate figure to see what it
means more precisely. On figure <span class="xref std std-ref">figure-projection-polar-histogram</span>, I
plotted a simple signal using mostly <a class="reference external" href="https://matplotlib.org/api/_as_gen/matplotlib.axes.Axes.fill_between.html">fill_between</a>
command. The concentric grey/white colored rings are made using the
<span class="code">fill_between</span> command between two different <span class="math notranslate nohighlight">\(\rho\)</span> values while the
histogram is made with various <span class="math notranslate nohighlight">\(\rho\)</span> values. If you now look more closely
at the <span class="math notranslate nohighlight">\(\rho\)</span> axis with ticks ranging from 100 to 900, you can observe
that the ticks have the same vertical size. It is indeed an <em>anomaly</em> I
introduced deliberately for purely aesthetic reasons. If I had specified these
ticks using a plot command, the length of each tick would correspond to a
difference of angle (for the vertical size) and they would become taller and
taller as we move away from the center. To have regulars ticks, we thus have to
do some computations using the inverse transform (remember, a projection is a
forward and an inverse transform). I won’t give all the details here but you can
read the code (<span class="source">projection-polar-histogram.py</span>) to see how it is
made. Note that the actual role of the inverse transformation is to link mouse
coordinates (in Cartesian 2D coordinates) back to your data.</p>
<figure class="align-default" id="id36">
<a class="reference internal image-reference" href="rst/scales-projections/projection-polar-histogram.pdf"><img alt="rst/scales-projections/projection-polar-histogram.pdf" src="rst/scales-projections/projection-polar-histogram.pdf" style="width: 95%;" /></a>
<figcaption>
<p><span class="caption-text">Polar projection with better defaults.
<span class="label">figure-projection-polar-histogram</span>
(sources: <span class="source">scales-projections/projection-polar-histogram.py</span>).</span><a class="headerlink" href="#id36" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Conversely, there are some situations were we might be interested in having
the text and the markers to be transformed as illustrated on figure
<span class="xref std std-ref">figure-text-polar</span>.</p>
<figure class="align-default" id="id37">
<a class="reference internal image-reference" href="rst/scales-projections/text-polar.pdf"><img alt="rst/scales-projections/text-polar.pdf" src="rst/scales-projections/text-polar.pdf" style="width: 90%;" /></a>
<figcaption>
<p><span class="caption-text">Polar projection with transformation of text and markers.
<span class="label">figure-text-polar</span>
(sources: <span class="source">scales-projections/text-polar.py</span>).</span><a class="headerlink" href="#id37" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>On this example, both the markers and the text have been transformed
manually. For the markers, the trick is to use <a class="reference external" href="https://matplotlib.org/api/_as_gen/matplotlib.patches.Ellipse.html">Ellipses</a> that are
approximated as a sequence of small line segments, each of them being
transformed. In the corresponding code, I only specify the center, and the size
of the pseudo-marker and the pre-processing stage takes care of applying the
polar projection to each individual parts composing the marker (ellipse),
resulting in a slightly curved ellipse. For the text, the process is the same
but it is a bit more complicated since we need first to convert the text into a
path that can be transformed (we’ll see that in more detail in the next
chapter).</p>
<p>The second projection that matplotlib offers is the 3d projection, that is the
projection from a 3D Cartesian space to a 2 Cartesian space. To start using 3D
projection, you’ll need to use the <a class="reference external" href="https://matplotlib.org/api/toolkits/mplot3d.html">Axis3D</a> toolkit that is generally
shipped with matplotlib:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>With this 3D axis, you can use regular plotting commands with a big difference
though: you need now to provide 3 coordinates (x,y,z) where you previously
provided only two (x,y) as illustrated on figure
<span class="xref std std-ref">figure-projection-3d-frame</span>. Note that this figure is quite different from
the default 3D axis you may get from matplotlib. Here, I tweaked every setting
I can think of to try to improve the default look and to show how things can be
changed. Have a look at the corresponding code and try to modify some settings to
see the actual effect. The <a class="reference external" href="https://matplotlib.org/mpl_toolkits/mplot3d/api.html">3D Axis API</a> is fairly well
documented on the matplotlib website and I won’t explain each and every command.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Note</strong> The 3D axis projection is limited by the absence of a proper
<a class="reference external" href="https://en.wikipedia.org/wiki/Z-buffering">depth-buffer</a>. This is not a
bug (nor a feature) and this results in some glitches between the elements
composing a figure.</p>
</div>
<figure class="align-default" id="id38">
<a class="reference internal image-reference" href="rst/scales-projections/projection-3d-frame.pdf"><img alt="rst/scales-projections/projection-3d-frame.pdf" src="rst/scales-projections/projection-3d-frame.pdf" style="width: 80%;" /></a>
<figcaption>
<p><span class="caption-text">Three dimensional projection
<span class="label">figure-projection-3d-frame</span>
(sources: <span class="source">scales-projections/projection-3d-frame.py</span>).</span><a class="headerlink" href="#id38" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>For other type of projections, you’ll need to install third-party packages
depending on the type of projection you intend to use:</p>
<dl class="simple">
<dt><a class="reference external" href="https://scitools.org.uk/cartopy/docs/latest/">Cartopy</a></dt><dd><p>is a Python package
designed for geospatial data processing in order to produce maps and other
geospatial data analyses. Cartopy makes use of the powerful PROJ.4, NumPy and
Shapely libraries and includes a programmatic interface built on top of
Matplotlib for the creation of publication quality maps.</p>
</dd>
<dt><a class="reference external" href="https://geopandas.org/">GeoPandas</a></dt><dd><p>is an open source project to make working
with geospatial data in python easier. GeoPandas extends the data types used by
pandas to allow spatial operations on geometric types. Geometric operations
are performed by Shapely. Geopandas further depends on fiona for file access
and descartes and matplotlib for plotting.</p>
</dd>
<dt><a class="reference external" href="https://github.com/marcharper/python-ternary">Python-ternary</a></dt><dd><p>is a plotting library for use with matplotlib to make ternary plots in
the two dimensional simplex projected onto a two dimensional plane. The
library provides functions for plotting projected lines, curves
(trajectories), scatter plots, and heatmaps. There are several examples and a
short tutorial below.</p>
</dd>
<dt><a class="reference external" href="https://github.com/vMeijin/pySmithPlot">pySmithPlot</a></dt><dd><p>is a matplotlib extension providing a projection class for creating high
quality Smith Charts with Python. The generated plots blend seamlessly into
matplotlib’s style and support almost the full range of customization options.</p>
</dd>
<dt><a class="reference external" href="https://github.com/rougier/matplotlib-3d">Matplotlib-3D</a></dt><dd><p>is an experimental project that attempts to provide a better and more
versatile 3d axis for Matplotlib.</p>
</dd>
</dl>
<p>If you’re still not satisfied with existing projections, your last option is to
create your own projection but this is quite an advanced operation even though
the matplotlib documentation provides some <a class="reference external" href="https://matplotlib.org/devel/add_new_projection.html">examples</a></p>
</section>
<section id="exercises">
<h3>Exercises<a class="headerlink" href="#exercises" title="Permalink to this headline">¶</a></h3>
<p><strong>Exercise 1</strong> Considering functions <span class="math notranslate nohighlight">\(f(x) = 10^x\)</span>, <span class="math notranslate nohighlight">\(f(x) = x\)</span> and
<span class="math notranslate nohighlight">\(f(x) = log_{10}(x)\)</span>, try to reproduce figure <span class="xref std std-ref">figure-scales-log-log</span>.</p>
<figure class="align-default" id="id39">
<a class="reference internal image-reference" href="rst/scales-projections/scales-log-log.pdf"><img alt="rst/scales-projections/scales-log-log.pdf" src="rst/scales-projections/scales-log-log.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Combining linear and logarithmic scales.
<span class="label">figure-scales-log-log</span> (sources: <span class="source">scales-projections/scales-log-log.py</span>).</span><a class="headerlink" href="#id39" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p><strong>Exercise 2</strong> The goal is to produce a figure showing <a class="reference external" href="https://en.wikipedia.org/wiki/Microphone#Polar_patterns">microphone
polar patterns</a>
(omnidirectional, subcardioid, cardioid, supercardioid, bidirectional
and shotgun). The first five patterns are simple functions where
radius evolves with angle, while the last pattern may require some
work.</p>
<figure class="align-default" id="id40">
<a class="reference internal image-reference" href="rst/scales-projections/polar-patterns.pdf"><img alt="rst/scales-projections/polar-patterns.pdf" src="rst/scales-projections/polar-patterns.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Microphone polar patterns
<span class="label">figure-polar-patterns</span>
(sources: <span class="source">scales-projections/polar-patterns.py</span>).</span><a class="headerlink" href="#id40" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p></p>
</section>
</section>
<section id="elements-of-typography">
<span id="chap-typography"></span><h2>Elements of typography<a class="headerlink" href="#elements-of-typography" title="Permalink to this headline">¶</a></h2>
<p>Typography is <em>the art of arranging type to make written language legible,
readable, and appealing when displayed</em> (Wikipedia). However, for the neophyte,
typography is mostly apprehended as the juxtaposition of characters displayed on
the screen while for the expert, typography means typeface, scripts, unicode,
glyphs, ascender, descender, tracking, hinting, kerning, shaping, weight, slant,
etc. Typography is actually much more than the mere rendering of glyphs and
involves many different concepts. If glyph rendering is an important part of the
rendering pipeline as it will be explained below, it is nonetheless important
to have a basic understanding of typography. Unfortunately, I cannot write here
a full course on typography and I advise the interested reader to read
<a class="reference external" href="https://practicaltypography.com/">Practical Typography</a> by Matthew
Butterick. This open access book introduces the main concepts and give sound
advice to improve your written documents.</p>
<p>At this point, you could object that a scientific figure possesses only a few
places with written text and it is thus not that important. And yet, it is.
Let’s have a look at figure <span class="xref std std-ref">figure-typography-matters</span> that differs only
at the typographic level. The top part is the default typographic choices of
Matplotlib in terms of font families, slant, weight and size. Those defaults are
actually already quite good but can be slightly improved as shown on the bottom
figure which was made using different font families (Roboto Condensed and Roboto
Slab), size and weights. The difference might appear subtle but is really an
important dimension of a scientific figure.</p>
<figure class="align-default" id="id41">
<a class="reference internal image-reference" href="rst/typography/typography-matters.png"><img alt="rst/typography/typography-matters.png" src="rst/typography/typography-matters.png" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Influence of typography on the perception of a figure
<span class="label">figure-typography-matters</span>
(sources: <span class="source">typography/typography-matters.py</span>).</span><a class="headerlink" href="#id41" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Unfortunately, there’s no magical recipe to tell you how to tweak typography for
a given figure and it depends on a number of factors over which you have no real
control most of the time. For example, consider a figure you make for inclusion
in an article that will be published in a scientific journal. These kind of
journals possess a template which dictate the future layout of your article (if
accepted) as well as a font stack, that is, a choice of fonts for main body,
bibliography and peripheral information. If you want your figure to have a good
appearance, you’ll need to choose your fonts accordingly. To do that, you can
have a look at fonts installed on your system or browse online galleries such as
<a class="reference external" href="https://www.fontsquirrel.com/">Font squirrel</a>, <a class="reference external" href="https://www.dafont.com/fr/">dafont.com</a> or <a class="reference external" href="https://fonts.google.com/">Google font</a>.</p>
<p>If you install a new font on your system, don’t forget to rebuild the font list
cache or Matplotlib will just ignore you newly installed font:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.font_manager</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">font_manager</span><span class="o">.</span><span class="n">_rebuild</span><span class="p">()</span>
</pre></div>
</div>
<section id="font-stacks">
<h3>Font stacks<a class="headerlink" href="#font-stacks" title="Permalink to this headline">¶</a></h3>
<p>The Matplotlib font stack is defined using four different typeface families,
namely <a class="reference external" href="https://en.wikipedia.org/wiki/Sans-serif">sans</a>, <a class="reference external" href="https://en.wikipedia.org/wiki/Serif">serif</a>, <a class="reference external" href="https://en.wikipedia.org/wiki/Monospaced_font">monospace</a> and <a class="reference external" href="https://en.wikipedia.org/wiki/Script_typeface">cursive</a>. The default font stack is
based on the <a class="reference external" href="https://en.wikipedia.org/wiki/DejaVu_fonts">DejaVu</a> fonts that
are based on the <a class="reference external" href="https://en.wikipedia.org/wiki/Bitstream_Vera">Bitstream Vera</a> fonts. DejaVu fonts offer good
unicode coverage but they come with only two weights (regular and bold) which
might be a bit limiting and the project seems to have been abandoned
since 2016. The default cursive font is <a class="reference external" href="https://en.wikipedia.org/wiki/Kris_Holmes#/media/File:Apple_Chancery.jpg">Apple Chancery</a>. Note
however that these are only the primary default choices and Matplotlib can fall
back to other typefaces if the defaults are not installed. To check which font is actually used, you can type:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib.font_manager</span> <span class="kn">import</span> <span class="n">findfont</span><span class="p">,</span> <span class="n">FontProperties</span>
<span class="k">for</span> <span class="n">family</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;serif&quot;</span><span class="p">,</span> <span class="s2">&quot;sans&quot;</span><span class="p">,</span> <span class="s2">&quot;monospace&quot;</span><span class="p">,</span> <span class="s2">&quot;cursive&quot;</span><span class="p">]:</span>
    <span class="n">font</span> <span class="o">=</span> <span class="n">findfont</span><span class="p">(</span><span class="n">FontProperties</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="n">family</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="s2">&quot;:&quot;</span> <span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">font</span><span class="p">))</span>
</pre></div>
</div>
<p>You can also design your own font stack by choosing a set of alternative
font families. Figure <span class="xref std std-ref">figure-typography-font-stacks</span> shows some
alternative font stacks based on the Roboto and Source Pro Family which both
have serif, sans and monospace typefaces and comes with several weights.</p>
<figure class="align-default" id="id42">
<a class="reference internal image-reference" href="rst/typography/typography-font-stacks.pdf"><img alt="rst/typography/typography-font-stacks.pdf" src="rst/typography/typography-font-stacks.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Font stack alternatives
<span class="label">figure-typography-font-stacks</span>
(sources: <span class="source">typography/typography-font-stacks.py</span>).</span><a class="headerlink" href="#id42" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>This font stack can be used as the default by modifying either the <a class="reference external" href="https://matplotlib.org/tutorials/introductory/customizing.html">rc</a> file or the
stylesheet (we’ll see that in the section <span class="nameref">chap-defaults</span>) but you can also use a specific font face for any textual object such as tick
labels, legend, figure title, etc. However, for consistency, it’s better to
use the same family of fonts (serif, sans and mono) for the whole figure.</p>
</section>
<section id="rendering-mathematics">
<h3>Rendering mathematics<a class="headerlink" href="#rendering-mathematics" title="Permalink to this headline">¶</a></h3>
<p>The case of mathematical text is slightly more complicated because it requires
several different fonts possessing all the necessary mathematical symbols and
there are not so many such fonts. Matplotlib offers five different families,
namely <a class="reference external" href="https://en.wikipedia.org/wiki/DejaVu_fonts">DejaVu</a> (sans and serif),
<a class="reference external" href="https://en.wikipedia.org/wiki/STIX_Fonts_project">Styx</a> (sans and serif) and
<a class="reference external" href="https://en.wikipedia.org/wiki/Computer_Modern">computer modern</a>:</p>
<figure class="align-default" id="id43">
<a class="reference internal image-reference" href="rst/typography/typography-math-stacks.pdf"><img alt="rst/typography/typography-math-stacks.pdf" src="rst/typography/typography-math-stacks.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Mathematics font stacks.
<span class="label">figure-typography-math-stacks</span>
(sources: <span class="source">typography/typography-math-stacks.py</span>).</span><a class="headerlink" href="#id43" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Matplotlib possesses its own <a class="reference external" href="https://matplotlib.org/tutorials/text/mathtext.html">TeX parser and layout engine</a> which is quite capable
even though it suffers from some imperfections. For comparison, here is the
same mathematical expression as rendered by LaTeX:</p>
<div class="math notranslate nohighlight">
\[\frac{\pi}{4} = \sum_{k=0}^\infty\frac{(-1)^k}{2k+1}\]</div>
<p>We can notice some obvious differences (alignment, weights, line widths). If
this is unacceptable for your case, you still have the option to use the real
TeX engine by setting the usetex variable:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;text.usetex&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
</pre></div>
</div>
</section>
<section id="a-note-about-size">
<h3>A note about size<a class="headerlink" href="#a-note-about-size" title="Permalink to this headline">¶</a></h3>
<p>When you manipulate textual objects you need to specify a size (either
explicitly or through the defaults) that is expressed in point (pt). In
matplotlib, a point corresponds to 1/72 inches (0.35mm) (while for LaTeX, a
point corresponds to 1/72.27 inches). The question is then what does this size
measure exactly? It corresponds to 1 <em>em</em> which is a typographic unit and more or
less corresponds to a bounding box that can contain any glyphs. No need to say
more at this point because the important information is that font sizes are
specified in inches and the apparent size is thus directly linked to the
resolution of your figure (not the dimension) through the dots per inch (dpi)
parameter. You can thus define either a very large or tiny figure, and a font with
size 10 will have the same visual aspects on your screen.</p>
<p><strong>Exercise</strong> Using different fonts, weights and size, try to reproduce the figure <span class="xref std std-ref">figure-tick-labels-variation</span>.</p>
<figure class="align-default" id="id44">
<a class="reference internal image-reference" href="rst/typography/tick-labels-variation.pdf"><img alt="rst/typography/tick-labels-variation.pdf" src="rst/typography/tick-labels-variation.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Tick label variations
<span class="label">figure-tick-labels-variation</span>
(sources: <span class="source">typography/tick-labels-variation.py</span>).</span><a class="headerlink" href="#id44" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="legibility">
<h3>Legibility<a class="headerlink" href="#legibility" title="Permalink to this headline">¶</a></h3>
<p>For a traditional document, text is usually rendered in black against a white
background that maximizes legibility. The case of scientific visualization is a
bit different because there are some situations where you cannot control the
background color since it is part of your results.</p>
<figure class="align-default" id="id45">
<a class="reference internal image-reference" href="rst/typography/typography-legibility.pdf"><img alt="rst/typography/typography-legibility.pdf" src="rst/typography/typography-legibility.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Typograpy legibility variations.
<span class="label">figure-typography-legibility</span>
(sources: <span class="source">typography/typography-legibility.py</span>).</span><a class="headerlink" href="#id45" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>This is especially true if you add text over an image such as shown on figure
<span class="xref std std-ref">figure-typography-legibility</span>. The first line shows what happens if you
add white or black text over a random grey image. The result is nearly
impossible to read unless you zoom in. The second line is a bit better thanks to
the weight of the font that has been made heavier but the text remains difficult
to read. On the third line, I added a semi-transparent background to enhance
contrast. This dramatically improves legibility but the result is not really
aesthetic and hides a lot of data in the meantime. The best option is shown on
the last line where I outlined the font with a thin border. Here the text is
legible, aesthetic and does not hide too much data.</p>
<p><strong>Exercise</strong> Try to reproduce exactly the figure <span class="xref std std-ref">figure-text-outline</span>
which uses the <a class="reference external" href="https://fonts.google.com/specimen/Pacifico">Pacifico</a> font
family. Colors come from the magma colormap. Make sure to use different outline
widths to get the thin black line between each color.</p>
<figure class="align-default" id="id46">
<a class="reference internal image-reference" href="rst/typography/text-outline.pdf"><img alt="rst/typography/text-outline.pdf" src="rst/typography/text-outline.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Text with far too many outlines.
<span class="label">figure-text-outline</span>
(sources: <span class="source">typography/text-outline.py</span>).</span><a class="headerlink" href="#id46" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>At this point, it is important to understand that Matplotlib offers two types of
textual object. The first and most commonly used is the regular <a class="reference external" href="https://matplotlib.org/api/text_api.html#matplotlib.text.Text">Text</a> that is used
for labels, titles or annotations. It cannot be heavily transformed and most of
the time, the text is rendered following a single direction (e.g.horizontal or
vertical) even though it can be freely rotated. There exists however another
type of textual object which is the <a class="reference external" href="https://matplotlib.org/api/textpath_api.html">TextPath</a>. Usage is very simple:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib.textpath</span> <span class="kn">import</span> <span class="n">TextPath</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">PathPatch</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">TextPath</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="s2">&quot;ABC&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
<p>The result is a path object that can be inserted in a figure</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">patch</span> <span class="o">=</span> <span class="n">PathPatch</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">patch</span><span class="p">)</span>
</pre></div>
</div>
<p>What is really interesting with such path objects is that it can now be
transformed at the level of individual vertices composing a glyph as shown on
figure <span class="xref std std-ref">figure-typography-text-path</span>.</p>
<figure class="align-default" id="id47">
<a class="reference internal image-reference" href="rst/typography/typography-text-path.pdf"><img alt="rst/typography/typography-text-path.pdf" src="rst/typography/typography-text-path.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Better contour labels using text path.
<span class="label">figure-typography-text-path</span>
(sources: <span class="source">typography/typography-text-path.py</span>).</span><a class="headerlink" href="#id47" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>In this example, I replaced the regular contour labels with text path objects
that follow the path. It requires some computations but not that much
actually. The result is aesthetically better to me but it must be used
wisely. If your contour lines are too small or possess sharp turns, it will
make the text unreadable.</p>
<figure class="align-default" id="id48">
<a class="reference internal image-reference" href="rst/typography/projection-3D-gaussian.pdf"><img alt="rst/typography/projection-3D-gaussian.pdf" src="rst/typography/projection-3D-gaussian.pdf" style="width: 70%;" /></a>
<figcaption>
<p><span class="caption-text">Example of 3D text paths.
<span class="label">figure-projection-3d-gaussian</span>
(sources: <span class="source">typography/projection-3d-gaussian.py</span>).</span><a class="headerlink" href="#id48" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Another interesting usage of text path is the case of 3D projection as
illustrated on figure <span class="xref std std-ref">figure-projection-3d-gaussian</span>. On this figure, I
took advantage of the <a class="reference external" href="https://matplotlib.org/gallery/mplot3d/text3d.html">3D text API</a> to orient and project
tick labels and axes titles. Note that such projection is fine as long as the
figure is properly oriented. If you rotate, text might be difficult to read and
this is the reason why the default for 3d projection is to have text that always
face the camera, ensuring legibility.</p>
<p><strong>Exercise</strong> Try to reproduce figures <span class="xref std std-ref">figure-text-starwars</span>. A simple
<em>compression</em> on X vertices depending on the Y level should work. Vertices
of a path can be accessed with <span class="code">path.vertices</span>.</p>
<figure class="align-default" id="id49">
<a class="reference internal image-reference" href="rst/typography/text-starwars.pdf"><img alt="rst/typography/text-starwars.pdf" src="rst/typography/text-starwars.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">In a far distant galaxy.
<span class="label">figure-text-starwars</span> (sources: <span class="source">typography/text-starwars.py</span>).</span><a class="headerlink" href="#id49" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
</section>
<section id="a-primer-on-colors">
<span id="chap-colors"></span><h2>A primer on colors<a class="headerlink" href="#a-primer-on-colors" title="Permalink to this headline">¶</a></h2>
<p>Color is a <a class="reference external" href="https://en.wikipedia.org/wiki/Color">highly complex topic</a> and a whole book would
probably not be enough to explain each and every aspect. This is the
reason why I won’t try to explain everything here, the other reason
being that I’m simply not knowledgeable enough on the topic. There are
nonetheless a few things that are good to know, for example
how are colors represented on a computer. To represent a color on a
computer, we use (most of the time) the notion of a <a class="reference external" href="https://en.wikipedia.org/wiki/Color_model">color model</a> (how do we represent a
color) and a <a class="reference external" href="https://en.wikipedia.org/wiki/Color_space">color space</a> (what colors can be
represented). There exists several color models (RGB, HSV, HLS, CMYK,
CIEXYZ, CIELAB, etc.) and several color spaces (Adobe RGB, sRGB,
Colormatch RGB, etc.) such that you can access the same color space
using different color models. The standard for computers (since 1996)
is the <a class="reference external" href="https://en.wikipedia.org/wiki/SRGB">sRGB color space</a> where
the <span class="code">s</span> stands for standard. This color space uses an additive color
model based on the RGB model. This means that to obtain a given color,
you need to mix different amounts of red, green, and blue light.  When
these amounts are all zero, you obtain black and when these amounts
are all at full intensity, you obtain white (D65 white point, see <a class="reference external" href="https://en.wikipedia.org/wiki/CIE_1931_color_space">CIE
1931 xy chromaticity space</a>).</p>
<p>Consequently, when you specify a color in matplotlib
(e.g. <span class="code">“#123456”</span>), you need to realize that this color is implicitly
encoded in the sRGB color model and space. This draws immediate
consequences. For example, if you try to produce a gradient between
two colors using a naive approach, you’ll get wrong perceptual results
because the sRGB model is not linear. This is illustrated on figure
<span class="xref std std-ref">figure-color-gradients</span> where I plotted gradients using the sRGB
naive approach (first line on each gradient). You can observe that the
result is far from being satisfactory. A better way to build a
gradient is to first convert colors to the linear RGB space, apply
the gradient, and then convert it back to the sRGB color model. This is
illustrated on the second line of each gradient that are now
perceptually smoother. A third (and better) solution is to use the
<a class="reference external" href="https://en.wikipedia.org/wiki/CIELAB_color_space">CIE Lab</a> model
that has been tailored to the human perception and provides a
perceptually uniform space. It is a bit more complicated to manipulate
and you’ll need external packages such as <a class="reference external" href="https://scikit-image.org/">scikit-image</a> or <a class="reference external" href="https://colour.readthedocs.io/en/develop/index.html">colour</a> to make the
conversion between the different models and spaces, but results are
worth the effort.</p>
<figure class="align-default" id="id50">
<a class="reference internal image-reference" href="rst/colors/color-gradients.pdf"><img alt="rst/colors/color-gradients.pdf" src="rst/colors/color-gradients.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Linear color gradients using different color models
<span class="label">figure-color-gradients</span> (sources: <span class="source">colors/color-gradients.py</span>).</span><a class="headerlink" href="#id50" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Another popular model is the <a class="reference external" href="https://en.wikipedia.org/wiki/HSL_and_HSV">HSV</a> model that stands for
Hue, Saturation and Value (see figure <span class="xref std std-ref">figure-color-wheel</span>). It
provides an alternate color model to access the same color space as
the sRGB system. Matplotlib provides methods to convert to and
from the HSV model (see the <a class="reference external" href="https://matplotlib.org/stable/api/colors_api.html">colors</a> module).</p>
<figure class="align-default" id="id51">
<a class="reference internal image-reference" href="rst/colors/color-wheel.pdf"><img alt="rst/colors/color-wheel.pdf" src="rst/colors/color-wheel.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Color wheel (HSV)
<span class="label">figure-color-wheel</span> (sources: <span class="source">colors/color-wheel.py</span>).</span><a class="headerlink" href="#id51" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<section id="choosing-colors">
<h3>Choosing colors<a class="headerlink" href="#choosing-colors" title="Permalink to this headline">¶</a></h3>
<p>Maybe at this point the only question you have in mind is “Ok,
interesting, but how do I choose a color then? Do I even have to
choose anyway?” For this second question, you can actually let
Matplotlib choose for you. When you draw several plots at once, you
may have noticed that the plots use several different colors. These
colors are picked from what is called a color cycle:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.prop_cycle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">by_key</span><span class="p">()[</span><span class="s1">&#39;color&#39;</span><span class="p">])</span>
<span class="go">[&#39;#1f77b4&#39;, &#39;#ff7f0e&#39;, &#39;#2ca02c&#39;, &#39;#d62728&#39;, &#39;#9467bd&#39;,</span>
<span class="go"> &#39;#8c564b&#39;, &#39;#e377c2&#39;, &#39;#7f7f7f&#39;, &#39;#bcbd22&#39;, &#39;#17becf&#39;]</span>
</pre></div>
</div>
<p>These colors come from the <span class="code">tab10</span> colormap which itself comes from
the <a class="reference external" href="https://www.tableau.com/">Tableau</a> software:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">colors</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;tab10&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">colors</span><span class="o">.</span><span class="n">to_hex</span><span class="p">(</span><span class="n">cmap</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
<span class="go">[&#39;#1f77b4&#39;, &#39;#ff7f0e&#39;, &#39;#2ca02c&#39;, &#39;#d62728&#39;, &#39;#9467bd&#39;,</span>
<span class="go"> &#39;#8c564b&#39;, &#39;#e377c2&#39;, &#39;#7f7f7f&#39;, &#39;#bcbd22&#39;, &#39;#17becf&#39;]</span>
</pre></div>
</div>
<p>These colors have been designed to be sufficiently different such as
to ease the visual perception of difference while being not too
aggressive on the eye (compared to saturated pure blue, green or red
colors for example). If you need more colors, you need first to ask
yourself whether you really need more colors. Then, and only then, you
might consider using palettes that have been designed with care. This
is the case of the open color palette (see figure
<span class="xref std std-ref">figure-open-colors</span>) and the material color palette (see
<span class="xref std std-ref">figure-material-colors</span>). For example, on figure
<span class="xref std std-ref">stacked-plots</span>, I use two color stacks (<span class="code">blue grey</span> and <span class="code">yellow</span>
from the material palettes) to highlight an area of interest.</p>
<figure class="align-default" id="id52">
<a class="reference internal image-reference" href="rst/colors/stacked-plots.pdf"><img alt="rst/colors/stacked-plots.pdf" src="rst/colors/stacked-plots.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Stacked plots using two different color stacks to better highlight
an area of interest <span class="label">stacked-plots</span> (sources:
<span class="source">colors/stacked-plots.py</span>).</span><a class="headerlink" href="#id52" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="id53">
<a class="reference internal image-reference" href="rst/colors/open-colors.pdf"><img alt="rst/colors/open-colors.pdf" src="rst/colors/open-colors.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Open colors
<span class="label">figure-open-colors</span> (sources: <span class="source">colors/open-colors.py</span>).</span><a class="headerlink" href="#id53" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="id54">
<a class="reference internal image-reference" href="rst/colors/material-colors.pdf"><img alt="rst/colors/material-colors.pdf" src="rst/colors/material-colors.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Material colors
<span class="label">figure-material-colors</span> (sources: <span class="source">colors/material-colors.py</span>).</span><a class="headerlink" href="#id54" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Another usage is to use color stacks to identify different groups
while allowing variation inside each group. When doing this, you need
to conserve the same color semantics throughout all your subsequent
figures.</p>
<figure class="align-default" id="id55">
<a class="reference internal image-reference" href="rst/colors/colored-hist.pdf"><img alt="rst/colors/colored-hist.pdf" src="rst/colors/colored-hist.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Identification of groups with internal variations using color stacks.
<span class="label">figure-colored-hist</span> (sources: <span class="source">colors/colored-hist.py</span>).</span><a class="headerlink" href="#id55" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Another popular usage of color is to show some plots associated with their standard deviation (SD) or standard error (SE). To do that, there are two different ways to do it. Either with use palettes as the o,e defined previously or we use transparency using the <span class="code">alpha</span> keyword. Let’s compare the results.</p>
<figure class="align-default" id="id56">
<a class="reference internal image-reference" href="rst/colors/alpha-vs-color.pdf"><img alt="rst/colors/alpha-vs-color.pdf" src="rst/colors/alpha-vs-color.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Showing standard deviation, with or without transparency
<span class="label">figure-alpha-vs-color</span> (sources: <span class="source">colors/alpha-vs-color.py</span>).</span><a class="headerlink" href="#id56" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>As you can see on the left part of figure <span class="xref std std-ref">figure-alpha-vs-color</span>, using transparency results in the two plots to be somehow mixed together. This might be a useful effect since it allows you to show what is happening in shared  areas. This is not the case when using opaque colors and you thus have to decide which plot is covering the other (using <span class="code">zorder</span>). Note that the choice of one or the other solution is up to you since it very much depends on your data.</p>
<p>However, it is important to note that the use of transparency is quite specific in the sense that the visual result is not specified explicitly in the script. It depends actually from the actual rendering of the figure and the way matplotlib composes the different elements. Let’s consider for example a scatter plot (normal distribution) where each point is transparent (10%):</p>
<figure class="align-default" id="id57">
<a class="reference internal image-reference" href="rst/colors/alpha-scatter.pdf"><img alt="rst/colors/alpha-scatter.pdf" src="rst/colors/alpha-scatter.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Semi-transparent scatter plots
<span class="label">figure-alpha-scatter</span> (sources: <span class="source">colors/alpha-scatter.py</span>).</span><a class="headerlink" href="#id57" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>On the left part of figure <span class="xref std std-ref">figure-alpha-scatter</span>, we can see the result with a perceptually darker area in the center. This is a direct result of rendering several small discs on top of each other in the central area. If we want to quantify this perceptual result, we need to use a trick. The trick is to render the scatter plot in an array such that we can consider the result as an image. Such image is displayed in the central part and from this, we can play with the perceptual density as shown on the right part.</p>
</section>
<section id="choosing-colormaps">
<h3>Choosing colormaps<a class="headerlink" href="#choosing-colormaps" title="Permalink to this headline">¶</a></h3>
<p>Colormapping corresponds to the mapping of values to colors, using a colormap that defines, for each value, the corresponding color. There are different types of colormaps (sequential, diverging, cyclic, qualitative or none of these) that correspond to different use cases. It is is important to use the right type or colormap that corresponds to your data. To pick a colormap, you can start by answering questions illustrated on figure <span class="xref std std-ref">colormap-tree</span> and then choose the corresponding <a class="reference external" href="https://matplotlib.org/stable/tutorials/colors/colormaps.html">colormap</a> from the matplotlib website.</p>
<figure class="align-default" id="id58">
<a class="reference internal image-reference" href="rst/colors/colormap-tree.pdf"><img alt="rst/colors/colormap-tree.pdf" src="rst/colors/colormap-tree.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">How to choose a colormap?
<span class="label">colormap-tree</span></span><a class="headerlink" href="#id58" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Problem is, for each type, there exist several colormaps. But if you pick the right type, the choice is yours and depends mostly on you aesthetic taste. As long as you choose the right type, you cannot be wrong. Figure <span class="xref std std-ref">figure-mona-lisa</span> a few choices associated with sequential colormaps and they all look good. In this case, one selection criterion could be the fact that the image represents a human being and we may prefer a colormap close to skin tones.</p>
<figure class="align-default" id="id59">
<a class="reference internal image-reference" href="rst/colors/mona-lisa.pdf"><img alt="rst/colors/mona-lisa.pdf" src="rst/colors/mona-lisa.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Variations on Mona Lisa (Leonardo da Vinci, 1503).
<span class="label">figure-mona-lisa</span> (sources: <span class="source">colors/mona-lisa.py</span>).</span><a class="headerlink" href="#id59" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Diverging colormaps needs special care because they are really composed of two gradients with a special central value. By default, this central value is mapped to 0.5 in the normalized linear mapping and this works pretty well as long as the absolute minimum and maximum value of your data are the same. Now, consider the situation illustrated on figure <span class="xref std std-ref">figure-colormap-transform</span>. Here we have a small domain with negative values and a larger domain with positive values. Ideally, we would like the negative values to be mapped with blueish colors and positive values with yellowish colors. If we use a diverging colormap without any precaution, there’s no guarantee that we’ll obtain the result we want. To fix the problem, we thus need to tell matplotlib what is the central value and to do this, we need to use a <a class="reference external" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.colors.TwoSlopeNorm.html#matplotlib.colors.TwoSlopeNorm">Two Slope norm</a> instead of a <a class="reference external" href="https://matplotlib.org/stable/tutorials/colors/colormapnorms.html#">Linear norm</a>.</p>
<figure class="align-default" id="id60">
<a class="reference internal image-reference" href="rst/colors/colormap-transform.pdf"><img alt="rst/colors/colormap-transform.pdf" src="rst/colors/colormap-transform.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Colormap with linear norm vs two slopes norm.
<span class="label">figure-colormap-transform</span></span><a class="headerlink" href="#id60" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">colors</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;Spectral&quot;</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">norm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=-</span><span class="mi">3</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Print</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<span class="go">0.23076923076923078</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cmap</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span>
<span class="go">(0.968, 0.507, 0.300, 1.0)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">norm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">TwoSlopeNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=-</span><span class="mi">3</span><span class="p">,</span> <span class="n">vcenter</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<span class="go">0.5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;Spectral&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cmap</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span>
<span class="go">(0.998, 0.999, 0.746, 1.0)</span>
</pre></div>
</div>
</section>
<section id="id4">
<h3>Exercises<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p><strong>Exercise 1</strong> The goal is to reproduce the figure <span class="xref std std-ref">figure-colored-plot</span>. The trick is to split each line is small segments such that they can each have their own colors since it is not possible to do that with a regular plot. However, for performance reasons, you’ll need to use <a class="reference external" href="https://matplotlib.org/stable/gallery/shapes_and_collections/line_collection.html">LineCollection</a>. You can start from the following code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="o">+</span><span class="mi">5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">2500</span><span class="p">)</span>
<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">15</span><span class="p">):</span>
    <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">d</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="n">d</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">/</span><span class="n">X</span><span class="o">.</span><span class="n">max</span><span class="p">())</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dx</span><span class="o">*</span><span class="n">X</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">3</span><span class="o">+</span><span class="mi">5</span><span class="o">*</span><span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-default" id="id61">
<a class="reference internal image-reference" href="rst/colors/colored-plot.pdf"><img alt="rst/colors/colored-plot.pdf" src="rst/colors/colored-plot.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">(Too much) colored line plots  (sources <span class="source">colors/colored-plot.py</span>)
<span class="label">figure-colored-plot</span></span><a class="headerlink" href="#id61" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p><strong>Exercise 2</strong> This exercise is a bit tricky and requires the usage of <a class="reference external" href="https://matplotlib.org/stable/api/collections_api.html#matplotlib.collections.PolyCollection">PolyCollection</a>. The tricky part is to define, in a generic way, each polygon depending on the number of branches and sections. It is mostly trigonometry. I advise to start by drawing only the main lines and then create the small patches. The color part should then be easy because it depends only on the angle and you can thus use HSV encoding.</p>
<figure class="align-default" id="id62">
<a class="reference internal image-reference" href="rst/colors/flower-polar.pdf"><img alt="rst/colors/flower-polar.pdf" src="rst/colors/flower-polar.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Flower polar (sources <span class="source">colors/flower-polar.py</span>)
<span class="label">figure-flower-polar</span></span><a class="headerlink" href="#id62" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p></p>
</section>
</section>
</section>
<section id="figure-design">
<h1>Figure design<a class="headerlink" href="#figure-design" title="Permalink to this headline">¶</a></h1>
<section id="ten-simple-rules">
<span id="chap-rules"></span><h2>Ten simple rules<a class="headerlink" href="#ten-simple-rules" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Note.</strong> This chapter is an article I co-authored with Michael Droettboom
and Philip E. Bourne. It has been published in <a class="reference external" href="https://doi.org/10.1371/journal.pcbi.1003833">PLOS Computational Biology</a> under a Creative Commons
CC0 public domain dedication in September 2014. It is five years old but
still relevant and very popular.</p>
</div>
<p>Scientific visualization is classically defined as the process of graphically
displaying scientific data. However, this process is far from direct or
automatic. There are so many different ways to represent the same data: scatter
plots, linear plots, bar plots, and pie charts, to name just a
few. Furthermore, the same data, using the same type of plot, may be perceived
very differently depending on who is looking at the figure. A more accurate
definition for scientific visualization would be a graphical interface between
people and data. In this short article, we do not pretend to explain everything
about this interface. Instead we aim to provide a basic set of rules to improve
figure design and to explain some of the common pitfalls.</p>
<section id="rule-1-know-your-audience">
<h3>Rule 1: Know Your Audience<a class="headerlink" href="#rule-1-know-your-audience" title="Permalink to this headline">¶</a></h3>
<p>Given the definition above, problems arise when how a visual is perceived
differs significantly from the intent of the conveyer. Consequently, it is
important to identify, as early as possible in the design process, the audience
and the message the visual is to convey. The graphical design of the visual
should be informed by this intent. If you are making a figure for yourself and
your direct collaborators, you can possibly skip a number of steps in the
design process, because each of you knows what the figure is about. However, if
you intend to publish a figure in a scientific journal, you should make sure
your figure is correct and conveys all the relevant information to a broader
audience. Student audiences require special care since the goal for that
situation is to explain a concept. In that case, you may have to add extra
information to make sure the concept is fully understood. Finally, the general
public may be the most difficult audience of all since you need to design a
simple, possibly approximated, figure that reveals only the most salient part
of your research (Figure <span class="xref std std-ref">fig-rule-1</span>). This has proven to be a difficult
exercise.</p>
<figure class="align-default" id="id63">
<a class="reference internal image-reference" href="rst/rules/rule-1.pdf"><img alt="rst/rules/rule-1.pdf" src="rst/rules/rule-1.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text"><strong>Know your audience.</strong> This is a remake of a figure that was originally
published in the New York Times (NYT) in 2007. This new figure was made with
matplotlib using approximated data. The data is made of four series (men
deaths/cases, women deaths/cases) that could have been displayed using
classical double column (deaths/cases) bar plots. However, the layout used
here is better for the intended audience. It exploits the fact that the
number of new cases is always greater than the corresponding number of
deaths to mix the two values. It also takes advantage of the reading
direction (English [left-to-right] for NYT) in order to ease comparison
between men and women while the central labels give an immediate access to
the main message of the figure (cancer). This is a self-contained figure
that delivers a clear message on cancer deaths. However, it is not
precise. The chosen layout makes it actually difficult to estimate the
number of kidney cancer deaths because of its bottom position and the
location of the labelled ticks at the top. While this is acceptable for a
general-audience publication, it would not be acceptable in a scientific
publication if actual numerical values were not given elsewhere in the
article. (<span class="source">rules/rule-1.py</span>). <span class="label">fig-rule-1</span></span><a class="headerlink" href="#id63" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="rule-2-identify-your-message">
<h3>Rule 2: Identify Your Message<a class="headerlink" href="#rule-2-identify-your-message" title="Permalink to this headline">¶</a></h3>
<p>A figure is meant to express an idea or introduce some facts or a result that
would be too long (or nearly impossible) to explain only with words, be it for
an article or during a time-limited oral presentation. In this context, it is
important to clearly identify the role of the figure, i.e., what is the
underlying message and how can a figure best express this message? Once clearly
identified, this message will be a strong guide for the design of the figure,
as shown in Figure <span class="xref std std-ref">fig-rule-2</span>. Only after identifying the message will
it be worth the time to develop your figure, just as you would take the time to
craft your words and sentences when writing an article only after deciding on
the main points of the text. If your figure is able to convey a striking
message at first glance, chances are increased that your article will draw more
attention from the community.</p>
<figure class="align-default" id="id64">
<a class="reference internal image-reference" href="rst/rules/rule-2.pdf"><img alt="rst/rules/rule-2.pdf" src="rst/rules/rule-2.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text"><strong>Identify your message.</strong> The superior colliculus (SC) is a brainstem
structure at the crossroads of multiple functional pathways. Several
neurophysiological studies suggest that the population of active neurons in
the SC encodes the location of a visual target that induces saccadic eye
movement. The projection from the retina surface (on the left) to the
collicular surface (on the right) is based on a standard and quantitative
model in which a logarithmic mapping function ensures the projection from
retinal coordinates to collicular coordinates. This logarithmic mapping
plays a major role in saccade decision. To better illustrate this role, an
artificial checkerboard pattern has been used, even though such a pattern is
not used during experiments. This checkerboard pattern clearly demonstrates
the extreme magnification of the foveal region, which is the main message of
the figure. (<span class="source">rules/rule-2.py</span>) <span class="label">fig-rule-2</span></span><a class="headerlink" href="#id64" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="rule-3-adapt-the-figure-to-the-support-medium">
<h3>Rule 3: Adapt the Figure to the Support Medium<a class="headerlink" href="#rule-3-adapt-the-figure-to-the-support-medium" title="Permalink to this headline">¶</a></h3>
<p>A figure can be displayed on a variety of media, such as a poster, a computer
monitor, a projection screen (as in an oral presentation), or a simple sheet of
paper (as in a printed article). Each of these media represents different
physical sizes for the figure, but more importantly, each of them also implies
different ways of viewing and interacting with the figure. For example, during
an oral presentation, a figure will be displayed for a limited time. Thus, the
viewer must quickly understand what is displayed and what it represents while
still listening to your explanation. In such a situation, the figure must be
kept simple and the message must be visually salient in order to grab
attention, as shown in Figure <span class="xref std std-ref">fig-rule-3</span>. It is also important to keep
in mind that during oral presentations, figures will be video-projected and
will be seen from a distance, and figure elements must consequently be made
thicker (lines) or bigger (points, text), colors should have strong contrast,
and vertical text should be avoided, etc. For a journal article, the situation
is totally different, because the reader is able to view the figure as long as
necessary. This means a lot of details can be added, along with complementary
explanations in the caption. If we take into account the fact that more and
more people now read articles on computer screens, they also have the
possibility to zoom and drag the figure. Ideally, each type of support medium
requires a different figure, and you should abandon the practice of extracting
a figure from your article to be put, as is, in your oral presentation.</p>
<figure class="align-default" id="id65">
<a class="reference internal image-reference" href="rst/rules/rule-3.pdf"><img alt="rst/rules/rule-3.pdf" src="rst/rules/rule-3.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text"><strong>Adapt the figure to the support medium</strong> These two figures represent the
same simulation of the trajectories of a dual-particle system
(<span class="math notranslate nohighlight">\(\dot{x} = (1/4 + (x-y))(1-x)\)</span>, <span class="math notranslate nohighlight">\(x \ge 0\)</span>, <span class="math notranslate nohighlight">\(\dot{y} =
(1/4 + (y-x))(1-y)\)</span>, <span class="math notranslate nohighlight">\(y \ge 0\)</span>) where each particle interacts with the
other. Depending on the initial conditions, the system may end up in three
different states. The left figure has been prepared for a journal article
where the reader is free to look at every detail. The red color has been
used consistently to indicate both initial conditions (red dots in the
zoomed panel) and trajectories (red lines). Line transparency has been
increased in order to highlight regions where trajectories overlap (high
color density). The right figure has been prepared for an oral
presentation. Many details have been removed (reduced number of
trajectories, no overlapping trajectories, reduced number of ticks, bigger
axis and tick labels, no title, thicker lines) because the time-limited
display of this figure would not allow for the audience to scrutinize every
detail. Furthermore, since the figure will be described during the oral
presentation, some parts have been modified to make them easier to reference
(e.g., the yellow box, the red dashed line). (<span class="source">rules/rule-3.py</span>)
<span class="label">fig-rule-3</span></span><a class="headerlink" href="#id65" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="rule-4-captions-are-not-optional">
<h3>Rule 4: Captions Are Not Optional<a class="headerlink" href="#rule-4-captions-are-not-optional" title="Permalink to this headline">¶</a></h3>
<p>Whether describing an experimental setup, introducing a new model, or
presenting new results, you cannot explain everything within the figure
itself—a figure should be accompanied by a caption. The caption explains how to
read the figure and provides additional precision for what cannot be
graphically represented. This can be thought of as the explanation you would
give during an oral presentation, or in front of a poster, but with the
difference that you must think in advance about the questions people would
ask. For example, if you have a bar plot, do not expect the reader to guess the
value of the different bars by just looking and measuring relative heights on
the figure. If the numeric values are important, they must be provided
elsewhere in your article or be written very clearly on the figure. Similarly,
if there is a point of interest in the figure (critical domain, specific point,
etc.), make sure it is visually distinct but do not hesitate to point it out
again in the caption.</p>
</section>
<section id="rule-5-do-not-trust-the-defaults">
<h3>Rule 5: Do Not Trust the Defaults<a class="headerlink" href="#rule-5-do-not-trust-the-defaults" title="Permalink to this headline">¶</a></h3>
<p>Any plotting library or software comes with a set of default settings. When the
end-user does not specify anything, these default settings are used to specify
size, font, colors, styles, ticks, markers, etc. (Figure <span class="xref std std-ref">fig-rule-5</span>).
Virtually any setting can be specified, and you can usually recognize the
specific style of each software package (Matlab, Excel, Keynote, etc.) or
library (LaTeX, matplotlib, gnuplot, etc.) thanks to the choice of these
default settings. Since these settings are to be used for virtually any type of
plot, they are not fine-tuned for a specific type of plot. In other words, they
are good enough for any plot but they are best for none. All plots require at
least some manual tuning of the different settings to better express the
message, be it for making a precise plot more salient to a broad audience, or
to choose the best colormap for the nature of the data. For example, see
chapter <a class="reference internal" href="#chap-defaults">chap-defaults</a> for how to go from the default settings to a nicer
visual in the case of the matplotlib library.</p>
<figure class="align-default" id="id66">
<a class="reference internal image-reference" href="rst/rules/rule-5.pdf"><img alt="rst/rules/rule-5.pdf" src="rst/rules/rule-5.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text"><strong>Do not trust the defaults.</strong> The left panel shows the sine and cosine
functions as rendered by matplotlib using default settings. While this
figure is clear enough, it can be visually improved by tweaking the various
available settings, as shown on the right
panel. (<span class="source">rules/rule-5-left.py</span> and <span class="source">rules/rule-5-right.py</span>)
<span class="label">fig-rule-5</span></span><a class="headerlink" href="#id66" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="rule-6-use-color-effectively">
<h3>Rule 6: Use Color Effectively<a class="headerlink" href="#rule-6-use-color-effectively" title="Permalink to this headline">¶</a></h3>
<p>Color is an important dimension in human vision and is consequently equally
important in the design of a scientific figure. However, as explained by Edward
Tufte, color can be either your greatest ally or your worst enemy if not used
properly. If you decide to use color, you should consider which colors to use
and where to use them. For example, to highlight some element of a figure, you
can use color for this element while keeping other elements gray or black. This
provides an enhancing effect. However, if you have no such need, you need to
ask yourself, “Is there any reason this plot is blue and not black?” If you
don’t know the answer, just keep it black. The same holds true for
colormaps. Do not use the default colormap (e.g., jet or rainbow) unless there
is an explicit reason to do so (see Figure <span class="xref std std-ref">fig-rule-6</span>). Colormaps are
traditionally classified into three main categories:</p>
<ul class="simple">
<li><p><strong>Sequential</strong>: one variation of a unique color, used for quantitative data
varying from low to high.</p></li>
<li><p><strong>Diverging</strong>: variation from one color to another, used to highlight deviation
from a median value.</p></li>
<li><p><strong>Qualitative</strong>: rapid variation of colors, used mainly for discrete or
categorical data.</p></li>
</ul>
<p>Use the colormap that is the most relevant to your data. Lastly, avoid using
too many similar colors since color blindness may make it difficult to discern
some color differences.</p>
<figure class="align-default" id="id67">
<a class="reference internal image-reference" href="rst/rules/rule-6.pdf"><img alt="rst/rules/rule-6.pdf" src="rst/rules/rule-6.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text"><strong>Use color effectively.</strong> This figure represents the same signal, whose
frequency increases to the right and intensity increases towards the bottom,
using three different colormaps. The rainbow colormap (qualitative) and the
seismic colormap (diverging) are equally bad for such a signal because they
tend to hide details in the high frequency domain (bottom-right part). Using
a sequential colormap such as the purple one, it is easier to see details in
the high frequency domain. (<span class="source">rules/rule-6.py</span>) <span class="label">fig-rule-6</span></span><a class="headerlink" href="#id67" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="rule-7-do-not-mislead-the-reader">
<h3>Rule 7: Do Not Mislead the Reader<a class="headerlink" href="#rule-7-do-not-mislead-the-reader" title="Permalink to this headline">¶</a></h3>
<p>What distinguishes a scientific figure from other graphical artwork is the
presence of data that needs to be shown as objectively as possible. A
scientific figure is, by definition, tied to the data (be it an experimental
setup, a model, or some results) and if you loosen this tie, you may
unintentionally project a different message than intended. However,
representing results objectively is not always straightforward. For example, a
number of implicit choices made by the library or software you’re using that
are meant to be accurate in most situations may also mislead the viewer under
certain circumstances. If your software automatically re-scales values, you
might obtain an objective representation of the data (because title, labels,
and ticks indicate clearly what is actually displayed) that is nonetheless
visually misleading (see bar plot in Figure <span class="xref std std-ref">fig-rule-7</span>); you have
inadvertently misled your readers into visually believing something that does
not exist in your data. You can also make explicit choices that are wrong by
design, such as using pie charts or 3-D charts to compare quantities. These two
kinds of plots are known to induce an incorrect perception of quantities and it
requires some expertise to use them properly. As a rule of thumb, make sure to
always use the simplest type of plots that can convey your message and make
sure to use labels, ticks, title, and the full range of values when
relevant. Lastly, do not hesitate to ask colleagues about their interpretation
of your figures.</p>
<figure class="align-default" id="id68">
<a class="reference internal image-reference" href="rst/rules/rule-7.pdf"><img alt="rst/rules/rule-7.pdf" src="rst/rules/rule-7.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text"><strong>Do not mislead the reader.</strong> On the left part of the figure, we
represented a series of four values: 30, 20, 15, 10. On the upper left part,
we used the disc area to represent the value, while in the bottom part we
used the disc radius. Results are visually very different. In the latter
case (red circles), the last value (10) appears very small compared to the
first one (30), while the ratio between the two values is only 3:1. This
situation is actually very frequent in the literature because the command
(or interface) used to produce circles or scatter plots (with varying point
sizes) offers to use the radius as default to specify the disc size. It thus
appears logical to use the value for the radius, but this is misleading. On
the right part of the figure, we display a series of ten values using the
full range for values on the top part (y axis goes from 0 to 100) or a
partial range in the bottom part (y axis goes from 80 to 100), and we
explicitly did not label the y-axis to enhance the confusion. The visual
perception of the two series is totally different. In the top part (black
series), we tend to interpret the values as very similar, while in the
bottom part, we tend to believe there are significant differences. Even if
we had used labels to indicate the actual range, the effect would persist
because the bars are the most salient information on these
figures.  (<span class="source">rules/rule-7.py</span>) <span class="label">fig-rule-7</span></span><a class="headerlink" href="#id68" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="rule-8-avoid-chartjunk">
<h3>Rule 8: Avoid “Chartjunk”<a class="headerlink" href="#rule-8-avoid-chartjunk" title="Permalink to this headline">¶</a></h3>
<p>Chartjunk refers to all the unnecessary or confusing visual elements found in a
figure that do not improve the message (in the best case) or add confusion (in
the worst case). For example, chartjunk may include the use of too many colors,
too many labels, gratuitously colored backgrounds, useless grid lines,
etc. (see left part of Figure <span class="xref std std-ref">fig-rule-8</span>). The term was first coined by
Edward Tutfe, in which he argues that any decorations that do not tell the
viewer something new must be banned: “Regardless of the cause, it is all
non-data-ink or redundant data-ink, and it is often chartjunk.” Thus, in order
to avoid chartjunk, try to save ink, or electrons in the computing era. Stephen
Few reminds us that graphs should ideally “represent all the data that is
needed to see and understand what’s meaningful.” However, an element that could
be considered chartjunk in one figure can be justified in another. For example,
the use of a background color in a regular plot is generally a bad idea because
it does not bring useful information. However, in the right part of Figure 7,
we use a gray background box to indicate the range [−1,+1] as described in the
caption. If you’re in doubt, do not hesitate to consult the excellent blog of
Kaiser Fung, which explains quite clearly the concept of chartjunk through the
study of many examples.</p>
<figure class="align-default" id="id69">
<a class="reference internal image-reference" href="rst/rules/rule-8.pdf"><img alt="rst/rules/rule-8.pdf" src="rst/rules/rule-8.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text"><strong>Avoid chartjunk.</strong> We have seven series of samples that are equally
important, and we would like to show them all in order to visually compare
them (exact signal values are supposed to be given elsewhere). The left
figure demonstrates what is certainly one of the worst possible designs. All
the curves cover each other and the different colors (that have been badly
and automatically chosen by the software) do not help to distinguish
them. The legend box overlaps part of the graphic, making it impossible to
check if there is any interesting information in this area. There are far
too many ticks: x labels overlap each other, making them unreadable, and the
three-digit precision does not seem to carry any significant
information. Finally, the grid does not help because (among other
criticisms) it is not aligned with the signal, which can be considered
discrete given the small number of sample points. The right figure adopts a
radically different layout while using the same area on the sheet of
paper. Series have been split into seven plots, each of them showing one
series, while other series are drawn very lightly behind the main
one. Series labels have been put on the left of each plot, avoiding the use
of colors and a legend box. The number of x ticks has been reduced to three,
and a thin line indicates these three values for all plots. Finally, y ticks
have been completely removed and the height of the gray background boxes
indicate the [−1,+1] range (this should also be indicated in the figure
caption if it were to be used in an article).  (<span class="source">rules/rule-8.py</span>)
<span class="label">fig-rule-8</span></span><a class="headerlink" href="#id69" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="rule-9-message-trumps-beauty">
<h3>Rule 9: Message Trumps Beauty<a class="headerlink" href="#rule-9-message-trumps-beauty" title="Permalink to this headline">¶</a></h3>
<p>Figures have been used in scientific literature since antiquity. Over the
years, a lot of progress has been made, and each scientific domain has
developed its own set of best practices. It is important to know these
standards, because they facilitate a more direct comparison between models,
studies, or experiments. More importantly, they can help you to spot obvious
errors in your results. However, most of the time, you may need to design a
brand-new figure, because there is no standard way of describing your
research. In such a case, browsing the scientific literature is a good starting
point. If some article displays a stunning figure to introduce results similar
to yours, you might want to try to adapt the figure for your own needs (note
that we did not say copy; be careful with image copyright). If you turn to the
web, you have to be very careful, because the frontiers between data
visualization, infographics, design, and art are becoming thinner and thinner
[9]. There exists a myriad of online graphics in which aesthetic is the first
criterion and content comes in second place. Even if a lot of those graphics
might be considered beautiful, most of them do not fit the scientific
framework. Remember, in science, message and readability of the figure is the
most important aspect while beauty is only an option, as dramatically shown in
Figure <span class="xref std std-ref">fig-rule-9</span>.</p>
<figure class="align-default" id="id70">
<a class="reference internal image-reference" href="rst/rules/rule-9.pdf"><img alt="rst/rules/rule-9.pdf" src="rst/rules/rule-9.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text"><strong>Message trumps beauty.</strong> This figure is an extreme case where the message
is particularly clear even if the aesthetic of the figure is
questionable. The uncanny valley is a well-known hypothesis in the field of
robotics that correlates our comfort level with the human-likeness of a
robot. To express this hypothetical nature, hypothetical data were used
(<span class="math notranslate nohighlight">\(y=x^2 - 5e^{-5(x-2)^2}\)</span>) and the figure was given a sketched look
(xkcd filter on matplotlib) associated with a cartoonish font that enhances
the overall effect. Tick labels were also removed since only the overall
shape of the curve matters. Using a sketch style conveys to the viewer that
the data is approximate, and that it is the higher-level concepts rather
than low-level details that are important.  (<span class="source">rules/rule-9.py</span>)
<span class="label">fig-rule-9</span></span><a class="headerlink" href="#id70" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="rule-10-get-the-right-tool">
<h3>Rule 10: Get the Right Tool<a class="headerlink" href="#rule-10-get-the-right-tool" title="Permalink to this headline">¶</a></h3>
<p>There exist many tools that can make your life easier when creating figures,
and knowing a few of them can save you a lot of time. Depending on the type of
visual you’re trying to create, there is generally a dedicated tool that will
do what you’re trying to achieve. It is important to understand at this point
that the software or library you’re using to make a visualization can be
different from the software or library you’re using to conduct your research
and/or analyze your data. You can always export data in order to use it in
another tool. Whether drawing a graph, designing a schema of your experiment,
or plotting some data, there are open-source tools for you. They’re just
waiting to be found and used. Below is a small list of open-source tools.</p>
<ul class="simple">
<li><p><strong>Matplotlib</strong> is a python plotting library, primarily for 2-D plotting, but
with some 3-D support, which produces publication-quality figures in a
variety of hardcopy formats and interactive environments across platforms. It
comes with a huge <a class="reference external" href="http://matplotlib.org/gallery.html">gallery</a> of
examples that cover virtually all scientific domains.</p></li>
<li><p><strong>R</strong> is a language and environment for statistical computing and graphics. R
provides a wide variety of statistical (linear and nonlinear modeling,
classical statistical tests, time-series analysis, classification,
clustering, etc.) and graphical techniques, and is highly extensible.</p></li>
<li><p><strong>Inkscape</strong> is a professional vector graphics editor. It allows you to
design complex figures and can be used, for example, to improve a
script-generated figure or to read a PDF file in order to extract figures and
transform them any way you like.</p></li>
<li><p><strong>TikZ and PGF</strong> are TeX packages for creating graphics
programmatically. TikZ is built on top of PGF and allows you to create
sophisticated graphics in a rather intuitive and easy manner, as shown by the
<a class="reference external" href="http://www.texample.net/tikz/examples/all/">Tikz gallery</a>.</p></li>
<li><p><strong>GIMP</strong> is the GNU Image Manipulation Program. It is an application for such
tasks as photo retouching, image composition, and image authoring. If you
need to quickly retouch an image or add some legends or labels, GIMP is the
perfect tool.</p></li>
<li><p><strong>ImageMagick</strong> is a software suite to create, edit, compose, or convert
bitmap images from the command line. It can be used to quickly convert an
image into another format, and the huge <a class="reference external" href="http://www.fmwconcepts.com/imagemagick/index.php">script gallery</a> by Fred Weinhaus will
provide virtually any effect you might want to achieve.</p></li>
<li><p><strong>D3.js</strong> (or just D3 for Data-Driven Documents) is a JavaScript library that
offers an easy way to create and control interactive data-based graphical
forms which run in web browsers, as shown in the <a class="reference external" href="http://github.com/mbostock/d3/wiki/Gallery">gallery</a>.</p></li>
<li><p><strong>Cytoscape</strong> is a software platform for visualizing complex networks and
integrating these with any type of attribute data. If your data or results
are very complex, cytoscape may help you alleviate this complexity.</p></li>
<li><p><strong>Circos</strong> was originally designed for visualizing genomic data but can
create figures from data in any field. Circos is useful if you have data that
describes relationships or multilayered annotations of one or more scales.</p></li>
</ul>
<p></p>
</section>
</section>
<section id="mastering-the-defaults">
<span id="chap-defaults"></span><h2>Mastering the defaults<a class="headerlink" href="#mastering-the-defaults" title="Permalink to this headline">¶</a></h2>
<p>We’ve just explained (see rule 5 in chapter <a class="reference internal" href="#chap-rules">chap-rules</a>) that any visualization library or software comes with a set of default settings that identifies it. For example, figure <span class="xref std std-ref">figure-sine-cosine-variants</span> show the sine and cosine functions as rendered by Google calculator, Julia, Gnuplot and Matlab. Even for such simple functions, these displays are quite characteristic.</p>
<figure class="align-default" id="id71">
<a class="reference internal image-reference" href="rst/defaults/sine-cosine-variants.png"><img alt="rst/defaults/sine-cosine-variants.png" src="rst/defaults/sine-cosine-variants.png" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Sine and cosine functions as displayed by (A) Google calculator (B) Julia,
(C) Gnuplot (D) Matlab. <span class="label">figure-sine-cosine-variants</span></span><a class="headerlink" href="#id71" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Let’s draw sine and cosine functions using Matplotlib defaults.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">C</span><span class="p">,</span> <span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">S</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>Figure <span class="xref std std-ref">figure-defaults-step-2</span> shows the result that is quite characteristic of Matplotlib.</p>
<figure class="align-default" id="id72">
<a class="reference internal image-reference" href="rst/defaults/defaults-step-1.pdf"><img alt="rst/defaults/defaults-step-1.pdf" src="rst/defaults/defaults-step-1.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Sine and cosine functions with implicit defaults
(sources <span class="source">defaults/defaults-step-1.py</span>)
<span class="label">figure-defaults-step-1</span></span><a class="headerlink" href="#id72" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<section id="explicit-settings">
<h3>Explicit settings<a class="headerlink" href="#explicit-settings" title="Permalink to this headline">¶</a></h3>
<p>Let’s now redo the figure but with the specification of all the different settings. This includes, figure size, line colors, widths and styles, ticks positions and labels, axes limits, etc.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">],</span>
                 <span class="n">dpi</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;figure.dpi&#39;</span><span class="p">],</span>
                 <span class="n">facecolor</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;figure.facecolor&#39;</span><span class="p">],</span>
                 <span class="n">edgecolor</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;figure.edgecolor&#39;</span><span class="p">],</span>
                 <span class="n">frameon</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;figure.frameon&#39;</span><span class="p">])</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span>
              <span class="n">linewidth</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;lines.linewidth&#39;</span><span class="p">],</span>
              <span class="n">linestyle</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;lines.linestyle&#39;</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span>
              <span class="n">linewidth</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;lines.linewidth&#39;</span><span class="p">],</span>
              <span class="n">linestyle</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;lines.linestyle&#39;</span><span class="p">])</span>

<span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">X</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">xmargin</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;axes.xmargin&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">xmax</span> <span class="o">-</span> <span class="n">xmin</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xmin</span> <span class="o">-</span> <span class="n">xmargin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">+</span> <span class="n">xmargin</span><span class="p">)</span>

<span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">S</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span> <span class="nb">max</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">S</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">ymargin</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;axes.ymargin&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span> <span class="o">-</span> <span class="n">ymargin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">+</span> <span class="n">ymargin</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span><span class="p">,</span>
               <span class="n">direction</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;xtick.direction&#39;</span><span class="p">],</span>
               <span class="n">length</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;xtick.major.size&#39;</span><span class="p">],</span>
               <span class="n">width</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;xtick.major.width&#39;</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span><span class="p">,</span>
               <span class="n">direction</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;ytick.direction&#39;</span><span class="p">],</span>
               <span class="n">length</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;ytick.major.size&#39;</span><span class="p">],</span>
               <span class="n">width</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;ytick.major.width&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default" id="id73">
<a class="reference internal image-reference" href="rst/defaults/defaults-step-2.pdf"><img alt="rst/defaults/defaults-step-2.pdf" src="rst/defaults/defaults-step-2.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Sine and cosine functions using matplotlib explicit defaults
(sources <span class="source">defaults/defaults-step-2.py</span>)
<span class="label">figure-defaults-step-2</span></span><a class="headerlink" href="#id73" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>The resulting figure <span class="xref std std-ref">figure-defaults-step-2</span> is an exact copy of  <span class="xref std std-ref">figure-defaults-step-1</span>. This comes as no surprise because I took care of reading the default values that are used implicitly by Matplotlib and set them explicitly. In fact, there are many more default choices that I did not materialize in this short example. For instance, the font family, slant, weight and size of tick labels can be configured in the defaults.</p>
</section>
<section id="user-settings">
<h3>User settings<a class="headerlink" href="#user-settings" title="Permalink to this headline">¶</a></h3>
<p>Note that we can also do the opposite and change the defaults before creating the figure. This way, matplotlib will use our custom defaults instead of standard ones. The result is shown on figure <span class="xref std std-ref">figure-defaults-step-3</span> where I changed a number of settings. Unfortunately, not every settings can be modified this way. For example, the position of markers (<span class="code">markevery</span>) cannot yet be set.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span><span class="mf">2.5</span>
<span class="n">p</span><span class="p">[</span><span class="s2">&quot;figure.edgecolor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span>
<span class="n">p</span><span class="p">[</span><span class="s2">&quot;figure.facecolor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;#f9f9f9&quot;</span>

<span class="n">p</span><span class="p">[</span><span class="s2">&quot;axes.linewidth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">p</span><span class="p">[</span><span class="s2">&quot;axes.facecolor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;#f9f9f9&quot;</span>
<span class="n">p</span><span class="p">[</span><span class="s2">&quot;axes.ymargin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">p</span><span class="p">[</span><span class="s2">&quot;axes.spines.bottom&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">p</span><span class="p">[</span><span class="s2">&quot;axes.spines.left&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">p</span><span class="p">[</span><span class="s2">&quot;axes.spines.right&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">p</span><span class="p">[</span><span class="s2">&quot;axes.spines.top&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">p</span><span class="p">[</span><span class="s2">&quot;font.sans-serif&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Fira Sans Condensed&quot;</span><span class="p">]</span>

<span class="n">p</span><span class="p">[</span><span class="s2">&quot;axes.grid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">p</span><span class="p">[</span><span class="s2">&quot;grid.color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span>
<span class="n">p</span><span class="p">[</span><span class="s2">&quot;grid.linewidth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">.1</span>

<span class="n">p</span><span class="p">[</span><span class="s2">&quot;xtick.bottom&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">p</span><span class="p">[</span><span class="s2">&quot;xtick.top&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">p</span><span class="p">[</span><span class="s2">&quot;xtick.direction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;out&quot;</span>
<span class="n">p</span><span class="p">[</span><span class="s2">&quot;xtick.major.size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">p</span><span class="p">[</span><span class="s2">&quot;xtick.major.width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">p</span><span class="p">[</span><span class="s2">&quot;xtick.minor.size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">p</span><span class="p">[</span><span class="s2">&quot;xtick.minor.width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">.5</span>
<span class="n">p</span><span class="p">[</span><span class="s2">&quot;xtick.minor.visible&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">p</span><span class="p">[</span><span class="s2">&quot;ytick.left&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">p</span><span class="p">[</span><span class="s2">&quot;ytick.right&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">p</span><span class="p">[</span><span class="s2">&quot;ytick.direction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;out&quot;</span>
<span class="n">p</span><span class="p">[</span><span class="s2">&quot;ytick.major.size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">p</span><span class="p">[</span><span class="s2">&quot;ytick.major.width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">p</span><span class="p">[</span><span class="s2">&quot;ytick.minor.size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">p</span><span class="p">[</span><span class="s2">&quot;ytick.minor.width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">.5</span>
<span class="n">p</span><span class="p">[</span><span class="s2">&quot;ytick.minor.visible&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">p</span><span class="p">[</span><span class="s2">&quot;lines.linewidth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">p</span><span class="p">[</span><span class="s2">&quot;lines.markersize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">aspect</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">S</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default" id="id74">
<a class="reference internal image-reference" href="rst/defaults/defaults-step-3.pdf"><img alt="rst/defaults/defaults-step-3.pdf" src="rst/defaults/defaults-step-3.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Sine and cosine functions using custom defaults
(sources <span class="source">defaults/defaults-step-3.py</span>)
<span class="label">figure-defaults-step-3</span></span><a class="headerlink" href="#id74" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="stylesheets">
<h3>Stylesheets<a class="headerlink" href="#stylesheets" title="Permalink to this headline">¶</a></h3>
<p>Changing default settings is thus an easy way to customize the style of your figure. But writing such style inside the figure script as we did until now is not very convenient and this is where <a class="reference external" href="https://matplotlib.org/stable/tutorials/introductory/customizing.html">style</a> comes into play. Styles are small text files describing (some) settings in the same way as they are defined in the main resource file <a class="reference external" href="https://matplotlib.org/stable/tutorials/introductory/customizing.html#the-matplotlibrc-file">matplotlibrc</a>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>figure.figsize: 6,2.5
figure.edgecolor: black
figure.facecolor: ffffff

axes.linewidth: 1
axes.facecolor: ffffff
axes.ymargin: 0.1
axes.spines.bottom: True
axes.spines.left: True
axes.spines.right: False
axes.spines.top: False
font.sans-serif: Fira Sans Condensed

axes.grid: False
grid.color: black
grid.linewidth: .1

xtick.bottom: True
xtick.top: False
xtick.direction: out
xtick.major.size: 5
xtick.major.width: 1
xtick.minor.size: 3
xtick.minor.width: .5
xtick.minor.visible: True

ytick.left: True
ytick.right: False
ytick.direction: out
ytick.major.size: 5
ytick.major.width: 1
ytick.minor.size: 3
ytick.minor.width: .5
ytick.minor.visible: True

lines.linewidth: 2
lines.markersize: 5
</pre></div>
</div>
<p>And we can now write:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;./mystyle.txt&quot;</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">aspect</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">S</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</section>
<section id="beyond-stylesheets">
<h3>Beyond stylesheets<a class="headerlink" href="#beyond-stylesheets" title="Permalink to this headline">¶</a></h3>
<p>If stylesheet allows to set a fair number of parameters, there is still plenty of other things that can be changed to improve the style of a figure even though we cannot use the stylesheet to do so. One of the reason is that these settings are specific to a given figure and it wouldn’t make sense to set them in the stylesheet. In the sine and cosine case, we can for example specify explicitly the location and labels of xticks, taking advantage of the fact that we know that we’re dealing with trigonometry functions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="s2">&quot;-1&quot;</span><span class="p">,</span> <span class="s2">&quot;+1&quot;</span><span class="p">])</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s2">&quot;-π&quot;</span><span class="p">,</span> <span class="s2">&quot;-π/2&quot;</span><span class="p">,</span> <span class="s2">&quot;+π/2&quot;</span><span class="p">,</span> <span class="s2">&quot;+π&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>We can also move the spines such as to center them:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">((</span><span class="s1">&#39;data&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">((</span><span class="s1">&#39;data&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
<p>And add some arrows at axis ends:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;&gt;k&quot;</span><span class="p">,</span>
        <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yaxis_transform</span><span class="p">(),</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;^k&quot;</span><span class="p">,</span>
        <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xaxis_transform</span><span class="p">(),</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>You can see the result on figure <span class="xref std std-ref">figure-defaults-step-5</span>. From this, you can start refining further the figure. But remember that if it’s ok to tweak parameters a bit, you can also lose a lot of time doing that (trust me).</p>
<figure class="align-default" id="id75">
<a class="reference internal image-reference" href="rst/defaults/defaults-step-5.pdf"><img alt="rst/defaults/defaults-step-5.pdf" src="rst/defaults/defaults-step-5.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Sine and cosine functions using custom defaults and fine tuning.
(sources <span class="source">defaults/defaults-step-5.py</span>)
<span class="label">figure-defaults-step-5</span></span><a class="headerlink" href="#id75" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="id5">
<h3>Exercise<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>Starting from the code below try to reproduce figure <span class="xref std std-ref">figure-defaults-exercise-1</span>
by modifying only rc settings.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">aspect</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">markevery</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">64</span><span class="p">),</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">markevery</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">64</span><span class="p">),</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s2">&quot;-π&quot;</span><span class="p">,</span> <span class="s2">&quot;-π/2&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;+π/2&quot;</span><span class="p">,</span> <span class="s2">&quot;+π&quot;</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">((</span><span class="s1">&#39;data&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
<figure class="align-default" id="id76">
<a class="reference internal image-reference" href="rst/defaults/defaults-exercice-1.pdf"><img alt="rst/defaults/defaults-exercice-1.pdf" src="rst/defaults/defaults-exercice-1.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Alternative rendering of sine and cosine
(solution <span class="source">defaults/defaults-exercice-1.py</span>)
<span class="label">figure-defaults-exercise-1</span></span><a class="headerlink" href="#id76" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p></p>
</section>
</section>
<section id="size-aspect-layout">
<span id="chap-layout"></span><h2>Size, aspect &amp; layout<a class="headerlink" href="#size-aspect-layout" title="Permalink to this headline">¶</a></h2>
<p>The layout of figures and sub-figures is certainly one of the most
frustrating aspect of matplotlib and for new user, it is generally
difficult to obtain the desired layout without a lot of trials and
errors.. But this is not specific to matplotlib, it is actually
equally difficult with any software (and even worse for some). To
understand why it is difficult, it is necessary to gain a better
understanding of the underlying machinery.</p>
<section id="figure-and-axes-aspect">
<h3>Figure and axes aspect<a class="headerlink" href="#figure-and-axes-aspect" title="Permalink to this headline">¶</a></h3>
<p>When you create a new figure, this figure comes with a specific size, either implicitly using defaults (as explained in the previous chapter) or explicitly through the <span class="code">figsize</span> keyword. If we take the height divided by the width of the figure we obtain the figure aspect ratio. When you create an axes, you can also specify an aspect that will be enforced by matplotlib. And here, we hit the first difficulty. You have a container with a given aspect ratio and you want to put inside an item with a possibly different aspect ratio and matplotlib has to solve these constrains. This is illustrated on figure <span class="xref std std-ref">figure-aspects</span> with different cases:</p>
<p><strong>A</strong>: figure aspect is 1, axes aspect is 1, x and y range are equal</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>B</strong>: figure aspect is 1/2, axes aspect is 1, x and y range are equal</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>C</strong>: figure aspect is 1/2, axes aspect is 1, x and y range are different</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>D</strong>: figure aspect is 2, axes aspect is 1, x and y range are equal</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>E</strong>: figure aspect is 1, axes aspect is 1, x and y range are different</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>F</strong>: figure aspect is 1, axes aspect is 0.5, x and y range are equal</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>G</strong>: figure aspect is 1/2, axes aspect is 1, x and y range are different</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>H</strong>: figure aspect is 1, axes aspect is 1, x and y range are different</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>I</strong>: figure aspect is 1, axes aspect is 2, x and y range are equal</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<figure class="align-default" id="id77">
<a class="reference internal image-reference" href="rst/layout/aspects.pdf"><img alt="rst/layout/aspects.pdf" src="rst/layout/aspects.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Combination of figure and axes aspect ratio
<span class="label">figure-aspects</span></span><a class="headerlink" href="#id77" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>The final layout of a figure results from a set of constraints that makes it  difficult to predict the end result. This is actually even more acute when you combine several axes on the same figure as shown on figures
<span class="xref std std-ref">figure-layout-aspect-1</span>, <span class="xref std std-ref">figure-layout-aspect-2</span> &amp; <span class="xref std std-ref">figure-layout-aspect-3</span>. Depending on what is important in your figure (aspect, range or size), you’ll privilege one of these layout. In any case, you should now have realized that if you over-constrained your layout, it might be unsolvable and matplotlib will try to find the best compromise.</p>
<figure class="align-default" id="id78">
<a class="reference internal image-reference" href="rst/layout/layout-aspect-1.pdf"><img alt="rst/layout/layout-aspect-1.pdf" src="rst/layout/layout-aspect-1.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Same size, same range, different aspect
(sources <span class="source">layout/layout-aspect.py</span>)
<span class="label">figure-layout-aspect-1</span></span><a class="headerlink" href="#id78" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="id79">
<a class="reference internal image-reference" href="rst/layout/layout-aspect-2.pdf"><img alt="rst/layout/layout-aspect-2.pdf" src="rst/layout/layout-aspect-2.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Same range, same aspect, different size
(sources <span class="source">layout/layout-aspect.py</span>)
<span class="label">figure-layout-aspect-2</span></span><a class="headerlink" href="#id79" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="id80">
<a class="reference internal image-reference" href="rst/layout/layout-aspect-3.pdf"><img alt="rst/layout/layout-aspect-3.pdf" src="rst/layout/layout-aspect-3.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Same size, same aspect, different range
(sources <span class="source">layout/layout-aspect.py</span>)
<span class="label">figure-layout-aspect-3</span></span><a class="headerlink" href="#id80" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="axes-layout">
<h3>Axes layout<a class="headerlink" href="#axes-layout" title="Permalink to this headline">¶</a></h3>
<p>Now that we know how figure and axes aspect may interact, it’s time to organize our figure into subfigures. We’ve already seen one example in the previous section, but let’s now look at the details. There exist indeed several <a class="reference external" href="https://matplotlib.org/stable/tutorials/intermediate/gridspec.html">different methods</a> to create subfigures and each have their pros and cons. Let’s take a very simple example where we want to have two axes side by side. To do so, we can use <a class="reference external" href="https://matplotlib.org/stable/api/figure_api.html?highlight=add_subplot#matplotlib.figure.Figure.add_subplot">add_subplot</a>, <a class="reference external" href="https://matplotlib.org/stable/api/figure_api.html?highlight=add_axes#matplotlib.figure.Figure.add_axes">add_axes</a>, <a class="reference external" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.gridspec.GridSpec.html?highlight=gridspec#matplotlib.gridspec.GridSpec">GridSpec</a> and <a class="reference external" href="https://matplotlib.org/stable/api/figure_api.html?#matplotlib.figure.Figure.subplot_mosaic">subplot_mosaic</a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>

<span class="c1"># Using subplots</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Using gridspecs</span>
<span class="n">G</span> <span class="o">=</span> <span class="n">GridSpec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">G</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">G</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># Using axes</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">])</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">])</span>

<span class="c1"># Using mosaic</span>
<span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_mosaic</span><span class="p">(</span><span class="s2">&quot;AB&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>As a general advice, I would encourage users to use the gridspec
approach because if offers a lot of flexibility compared to the
classical approach. For example, figure <span class="xref std std-ref">figure-layout-classical</span>
shows a nice and simple 3x3 layout but does not offer much control
over the relative aspect of each axes whereas in figure
<span class="xref std std-ref">figure-layout-gridspec</span>, we can very easily specify different
sizes for each axes.</p>
<figure class="align-default" id="id81">
<a class="reference internal image-reference" href="rst/layout/layout-classical.pdf"><img alt="rst/layout/layout-classical.pdf" src="rst/layout/layout-classical.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Subplots using classical layout.
(source <span class="source">layout/layout-classical.py</span>)
<span class="label">figure-layout-classical</span></span><a class="headerlink" href="#id81" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="id82">
<a class="reference internal image-reference" href="rst/layout/layout-gridspec.pdf"><img alt="rst/layout/layout-gridspec.pdf" src="rst/layout/layout-gridspec.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Subplots using gridspec layout
(source <span class="source">layout/layout-gridspec.py</span>)
<span class="label">figure-layout-gridspec</span></span><a class="headerlink" href="#id82" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>The biggest difficulty with gridspec is to get axes right, that is, at
the right position with the right size and this depends on the initial
partition of the grid spec, taking into account the different height &amp;
width ratios. Let’s consider for example figure
<span class="xref std std-ref">figure-complex-layout</span> that display a moderately complex
layout. The question is: how do we partition it? Do we need a single
axis for the small image of individual axes ? Are the text on the left
part of axes or do they use their own axes. There are indeed several
solutions and figure <span class="xref std std-ref">figure-complex-layout-bare</span> shows the
solution I chose to design this figure. There are individual axes for
subplots and left label. There is also a small line of axes for titles
in order to ensure that subplots have all the same size. If I had used
a title on the first row of subplots, this would have modified their
relative size compared to others. The legend on the top is using two
axes, one axes for the color legend and another for detailed
explanation. In this case, I use the central axes and write the text
outside the axes, specifying this does not need to be clipped.</p>
<figure class="align-default" id="id83">
<a class="reference internal image-reference" href="rst/layout/complex-layout.pdf"><img alt="rst/layout/complex-layout.pdf" src="rst/layout/complex-layout.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Complex layout
(source <span class="source">layout/complex-layout.py</span>)
<span class="label">figure-complex-layout</span></span><a class="headerlink" href="#id83" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="id84">
<a class="reference internal image-reference" href="rst/layout/complex-layout-bare.pdf"><img alt="rst/layout/complex-layout-bare.pdf" src="rst/layout/complex-layout-bare.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Complex layout structure
(source <span class="source">layout/complex-layout-bare.py</span>)
<span class="label">figure-complex-layout-bare</span></span><a class="headerlink" href="#id84" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="exercices">
<h3>Exercices<a class="headerlink" href="#exercices" title="Permalink to this headline">¶</a></h3>
<p><strong>Standard layout 1</strong> Using gridspec, the goal is to reproduce figure
<span class="xref std std-ref">figure-standard-layout-1</span> where the colorbar is the same size as the main axes and its width is one tenth of main axis width.</p>
<figure class="align-default" id="id85">
<a class="reference internal image-reference" href="rst/layout/standard-layout-1.pdf"><img alt="rst/layout/standard-layout-1.pdf" src="rst/layout/standard-layout-1.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Image and colorbar
(sources <span class="source">layout/standard-layout-1.py</span>)
<span class="label">figure-standard-layout-1</span></span><a class="headerlink" href="#id85" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p><strong>Standard layout 2</strong> Using gridspec, the goal is to reproduce figure
<span class="xref std std-ref">figure-standard-layout-2</span> with top and right histograms aligned with the main axes.</p>
<figure class="align-default" id="id86">
<a class="reference internal image-reference" href="rst/layout/standard-layout-2.pdf"><img alt="rst/layout/standard-layout-2.pdf" src="rst/layout/standard-layout-2.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Scatter plot and histograms
(sources <span class="source">layout/standard-layout-2.py</span>)
<span class="label">figure-standard-layout-2</span></span><a class="headerlink" href="#id86" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p></p>
</section>
</section>
<section id="ornaments">
<span id="chap-ornaments"></span><h2>Ornaments<a class="headerlink" href="#ornaments" title="Permalink to this headline">¶</a></h2>
<p>Ornaments designate all the extra elements you can add to a figure to
beautify it or to make it clearer. Ornaments include standard elements
such as legend, annotation, colorbars, text but you can also design
your own element specifically for your figure. For example, figure
<span class="xref std std-ref">figure-bessel-functions</span> displays a mix of standard elements
(annotation and text) as well as specific elements (roots reported on
the x axis using vertical markers).</p>
<figure class="align-default" id="id87">
<a class="reference internal image-reference" href="rst/ornaments/bessel-functions.pdf"><img alt="rst/ornaments/bessel-functions.pdf" src="rst/ornaments/bessel-functions.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Bessel functions
<span class="label">figure-bessel-functions</span>
(sources: <span class="source">ornaments/bessel-functions.py</span>).</span><a class="headerlink" href="#id87" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>There is no theoretical limit in the number of ornaments you can add
to a figure. However, you have to take care that your figure is still
easily readable and not too overloaded.</p>
<section id="legend">
<h3>Legend<a class="headerlink" href="#legend" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://matplotlib.org/stable/tutorials/intermediate/legend_guide.html">Legends</a>
are quite easy to use and only require for the user to name
plots. Matplotlib will take care of placing the legend automatically
(which is really tricky and consequently it can fail) and display the
necessary information (see figure
<span class="xref std std-ref">figure-legend-regular</span>). Legend comes with several options that
allows you to control every aspect of the legend even if, most of the
time, a simple <span class="code">legend()</span> call is sufficient as shown below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mf">2.5</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">()</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;cosine&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;sine&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default" id="id88">
<a class="reference internal image-reference" href="rst/ornaments/legend-regular.pdf"><img alt="rst/ornaments/legend-regular.pdf" src="rst/ornaments/legend-regular.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Regular legend
<span class="label">figure-legend-regular</span>
(sources: <span class="source">ornaments/legend-regular.py</span>).</span><a class="headerlink" href="#id88" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="id89">
<a class="reference internal image-reference" href="rst/ornaments/legend-alternatives.pdf"><img alt="rst/ornaments/legend-alternatives.pdf" src="rst/ornaments/legend-alternatives.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Alternative legends
<span class="label">figure-legend-alternatives</span>
(sources: <span class="source">ornaments/legend-alternatives.py</span>).</span><a class="headerlink" href="#id89" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>However, there are some cases where legend might not be the most
appropriate way to add information. For example, when you have several
plots, it may become tedious for the reader to go back and forth
between plots and legend. An alternative way is to add information
directly on the plots as shown on figure
<span class="xref std std-ref">figure-legend-alternatives</span>.</p>
<p>This figure introduces four different ways to directly label plots
even though there is no best alternative because it really depends on
the data. For the displayed sine / cosine example (which is quite
simple) the four solutions are appropriate, but when used with real
data, it may happen that none of these alternative suits the data. In
such case, you might need an alternate way of labelling data or you
may need to split your figure into several plots.</p>
</section>
<section id="title-labels">
<h3>Title &amp; labels<a class="headerlink" href="#title-labels" title="Permalink to this headline">¶</a></h3>
<p>We’ve already manipulated title and labels using <span class="code">set_title</span>,
<span class="code">set_xlabel</span> and <span class="code">set_ylabel</span> methods. When used without any extra
argument, they do a fairly good job and their placement is usually
good for most figures. Nonetheless, it is possible to play with the
various parameters such as to beautify the figure as shown on figure
<span class="xref std std-ref">figure-title-regular</span>. In this example, I simply displaced the
labels in order to be closer to the axis and I took care of removing
the central tick that would have else collided with the label. For the
title, I simply moved it to the right and I moved the legend box
(using two columns) accordingly, that is, under the title. Nothing
complicated here but I think the result is visually more pleasant.</p>
<figure class="align-default" id="id90">
<a class="reference internal image-reference" href="rst/ornaments/title-regular.pdf"><img alt="rst/ornaments/title-regular.pdf" src="rst/ornaments/title-regular.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Regular title
<span class="label">figure-title-regular</span>
(sources: <span class="source">ornaments/title-regular.py</span>).</span><a class="headerlink" href="#id90" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>In some cases (e.g. conference poster), you may need to have titles to
be a little more eye catching like shown on figure
<span class="xref std std-ref">figure-latex-text-box</span>. This is made possible by dividing
each axis with the <span class="code">make_axes_locatable</span> method and to reserve 15% of
height for the actual title. In this figure, I also inserted a fully
justified text using Latex that may be considered as another form or
(advanced) ornament.</p>
<figure class="align-default" id="id91">
<a class="reference internal image-reference" href="rst/ornaments/latex-text-box.png"><img alt="rst/ornaments/latex-text-box.png" src="rst/ornaments/latex-text-box.png" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Advanced text box
<span class="label">figure-latex-text-box</span>
(sources: <span class="source">ornaments/latex-text-box.py</span>).</span><a class="headerlink" href="#id91" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="annotations">
<h3>Annotations<a class="headerlink" href="#annotations" title="Permalink to this headline">¶</a></h3>
<p>Annotation is probably the most difficult object to handle inside
matplotlib. The reason is that it involves a number of different
concepts that results in a potential high number of parameters.
Furthermore, there is a supplementary difficulty because annotation
involve text whose size is expressed in points. In the end, you may
have to mix absolute or relative coordinates in pixels, points,
fractions or data units. If you add the fact that you can annotate any
axis having any kind of projection, you may now realize why the annotate
method offer so many parameters.</p>
<p>The simplest way to annotate a figure is to add labels very close to
the points you want to annotate as shown on figure
<span class="xref std std-ref">figure-annotation-direct</span>. In this figure, I took care of adding
a white outline to the labels such that they remain readable,
independently of the data distribution. However, if you have too many
points, all the different labels may end up cluttering your figure and
hide potentially important information.</p>
<figure class="align-default" id="id92">
<a class="reference internal image-reference" href="rst/ornaments/annotation-direct.pdf"><img alt="rst/ornaments/annotation-direct.pdf" src="rst/ornaments/annotation-direct.pdf" style="width: 65%;" /></a>
<figcaption>
<p><span class="caption-text">Direct annotations
<span class="label">figure-annotation-direct</span>
(sources: <span class="source">ornaments/annotation-direct.py</span>).</span><a class="headerlink" href="#id92" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>An alternative is to push labels on the side of the figure and to use
broken lines to establish the link between the point and the label as
shown on figure <span class="xref std std-ref">figure-annotation-side</span>. But this is far from
being automatic and to design this figure, I had to compute pretty
much everything. First, to have lines to not cross each other, I order
the point I want to label:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">.35</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">.35</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">Px</span><span class="p">,</span> <span class="n">Py</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">I</span><span class="p">],</span> <span class="n">Y</span><span class="p">[</span><span class="n">I</span><span class="p">]</span>
<span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">Y</span><span class="p">[</span><span class="n">I</span><span class="p">])[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">Px</span><span class="p">,</span> <span class="n">Py</span> <span class="o">=</span> <span class="n">Px</span><span class="p">[</span><span class="n">I</span><span class="p">],</span> <span class="n">Py</span><span class="p">[</span><span class="n">I</span><span class="p">]</span>
</pre></div>
</div>
<p>From these points, I’ve been able to annotate them using a quite
complex connection style:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">y</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="mf">.25</span><span class="p">,</span> <span class="mf">0.125</span>
<span class="n">style</span> <span class="o">=</span> <span class="s2">&quot;arc,angleA=-0,angleB=0,armA=-100,armB=0,rad=0&quot;</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">I</span><span class="p">)):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s2">&quot;Point &quot;</span> <span class="o">+</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">)</span><span class="o">+</span><span class="n">i</span><span class="p">),</span>
                <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="n">Px</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">Py</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>    <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span>
                <span class="n">xytext</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.25</span><span class="p">,</span> <span class="n">y</span><span class="o">-</span><span class="n">i</span><span class="o">*</span><span class="n">dy</span><span class="p">),</span>  <span class="n">textcoords</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span>
                <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;-&gt;&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                                <span class="n">linewidth</span><span class="o">=</span><span class="mf">.75</span><span class="p">,</span>
                                <span class="n">shrinkA</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">shrinkB</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                <span class="n">patchA</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">patchB</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                <span class="n">connectionstyle</span><span class="o">=</span><span class="n">style</span><span class="p">))</span>
</pre></div>
</div>
<figure class="align-default" id="id93">
<a class="reference internal image-reference" href="rst/ornaments/annotation-side.pdf"><img alt="rst/ornaments/annotation-side.pdf" src="rst/ornaments/annotation-side.pdf" style="width: 75%;" /></a>
<figcaption>
<p><span class="caption-text">Side annotations
<span class="label">figure-annotation-side</span>
(sources: <span class="source">ornaments/annotation-side.py</span>).</span><a class="headerlink" href="#id93" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>It is also possible to annotate objects outside the axes using a
<a class="reference external" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.patches.ConnectionPatch.html">connection patch</a>
as shown on figure <span class="xref std std-ref">figure-annotation-zoom</span>. In this example, I
created several rectangles showing areas of interest around some
points and I created a connection to the corresponding zoomed
axes. Note how the connection starts on the outside of the rectangle,
which is one of the nice feature offered by annotation: you can
specify the nature of the object you want to annotate (by providing a
patch) and matplotlib will take care of having the origin of the
connection to the border of the patch.</p>
<figure class="align-default" id="id94">
<a class="reference internal image-reference" href="rst/ornaments/annotation-zoom.pdf"><img alt="rst/ornaments/annotation-zoom.pdf" src="rst/ornaments/annotation-zoom.pdf" style="width: 75%;" /></a>
<figcaption>
<p><span class="caption-text">Zoomed annotations
<span class="label">figure-annotation-zoom</span>
(sources: <span class="source">ornaments/annotation-zoom.py</span>).</span><a class="headerlink" href="#id94" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="id6">
<h3>Exercise<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>It is now your turn to experiment with ornaments by trying to
reproduce the figure <span class="xref std std-ref">figure-elegant-scatter</span> which displays
several ornaments, including a custom one on the left and bottom
side. This ornament provides a quick way to show respective
distributions along weight and height and can be rendered with a
scatter plot using large vertical and horizontal markers.</p>
<figure class="align-default" id="id95">
<a class="reference internal image-reference" href="rst/ornaments/elegant-scatter.pdf"><img alt="rst/ornaments/elegant-scatter.pdf" src="rst/ornaments/elegant-scatter.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Elegant scatter plot
<span class="label">figure-elegant-scatter</span>
(sources: <span class="source">ornaments/elegant-scatter.py</span>).</span><a class="headerlink" href="#id95" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p></p>
</section>
</section>
</section>
<section id="advanced-concepts">
<h1>Advanced concepts<a class="headerlink" href="#advanced-concepts" title="Permalink to this headline">¶</a></h1>
<section id="animation">
<span id="chap-animation"></span><h2>Animation<a class="headerlink" href="#animation" title="Permalink to this headline">¶</a></h2>
<p>Animation with matplotlib can be created very easily using the
<a class="reference external" href="https://matplotlib.org/stable/api/animation_api.html">animation framework</a>. Let’s start
with a very simple animation. We want to make an animation where the
sine and cosine functions are plotted progressively on the screen.  To
do that, we need first to tell matplotlib we want to make an animation
and then, we have to specify what we want to draw at each frame. One
common mistake is to re-draw everything at each frame that makes the
whole process very slow. Instead, we can only update what is necessary
because we know that (in our case) a lot of things won’t change from
one frame to the other. For a line plot, we’ll use the <span class="code">set_data</span>
method to update the drawing and matplotlib will take care of of the
rest.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.animation</span> <span class="k">as</span> <span class="nn">animation</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">()</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">C</span><span class="p">,</span> <span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">line1</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">markevery</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                       <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>
<span class="n">line2</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">markevery</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                       <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="n">frame</span><span class="p">):</span>
    <span class="n">line1</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">X</span><span class="p">[:</span><span class="n">frame</span><span class="p">],</span> <span class="n">C</span><span class="p">[:</span><span class="n">frame</span><span class="p">])</span>
    <span class="n">line2</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">X</span><span class="p">[:</span><span class="n">frame</span><span class="p">],</span> <span class="n">S</span><span class="p">[:</span><span class="n">frame</span><span class="p">])</span>

<span class="n">ani</span> <span class="o">=</span> <span class="n">animation</span><span class="o">.</span><span class="n">FuncAnimation</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">update</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>Notice the end point marker that move with the animation. The reason
is that we specify a single marker at the end (<span class="code">markevery=[-1]</span>) such
that each time we set new data, marker is automatically updated and
moves with the animation. See figure
<span class="xref std std-ref">figure-animation-sine-cosine</span>.</p>
<figure class="align-default" id="id96">
<a class="reference internal image-reference" href="rst/animation/sine-cosine.pdf"><img alt="rst/animation/sine-cosine.pdf" src="rst/animation/sine-cosine.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Snapshots of the sine cosine animation
<span class="label">figure-animation-sine-cosine</span>
(sources: <span class="source">chapter-12/sine-cosine.py</span>).</span><a class="headerlink" href="#id96" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>If we now want to save this animation, matplotlib can create a movie
file but options are rather scarce. A better solution is to use an
external library such as <a class="reference external" href="https://ffmpeg.org/">FFMpeg</a> which is
available on most systems. Once installed, we can use the dedicated
<a class="reference external" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.animation.FFMpegWriter.html">FFMpegWriter</a> as shown below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">writer</span> <span class="o">=</span> <span class="n">animation</span><span class="o">.</span><span class="n">FFMpegWriter</span><span class="p">(</span><span class="n">fps</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">anim</span> <span class="o">=</span> <span class="n">animation</span><span class="o">.</span><span class="n">FuncAnimation</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">update</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">frames</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">))</span>
<span class="n">anim</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;sine-cosine.mp4&quot;</span><span class="p">,</span> <span class="n">writer</span><span class="o">=</span><span class="n">writer</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<p>You may have noticed that when we save the movie, the animation does
not start immediately because there is actually a delay that
corresponds to the movie creation. For sine and cosine, the delay is
rather short and it is not really a problem. However, for long and
complex animations, this delay can become quite significant and it
becomes necessary to track its progress. So let’s add some information
using the <a class="reference external" href="https://github.com/tqdm/tqdm">tqdm</a> library.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tqdm.autonotebook</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="n">bar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">))</span>
<span class="n">anim</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;../data/sine-cosine.mp4&quot;</span><span class="p">,</span> <span class="n">writer</span><span class="o">=</span><span class="n">writer</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
          <span class="n">progress_callback</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="n">bar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="n">bar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>Creation time remains the same, but at least now, we can check how
slow or fast it is. Here is some output of the animation:</p>
<a class="reference internal image-reference" href="rst/animation/sine-cosine-frame-032.pdf"><img alt="rst/animation/sine-cosine-frame-032.pdf" src="rst/animation/sine-cosine-frame-032.pdf" style="width: 100%;" /></a>
<a class="reference internal image-reference" href="rst/animation/sine-cosine-frame-128.pdf"><img alt="rst/animation/sine-cosine-frame-128.pdf" src="rst/animation/sine-cosine-frame-128.pdf" style="width: 100%;" /></a>
<figure class="align-default" id="id97">
<a class="reference internal image-reference" href="rst/animation/sine-cosine-frame-255.pdf"><img alt="rst/animation/sine-cosine-frame-255.pdf" src="rst/animation/sine-cosine-frame-255.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Still from the sine/cosine animation
(sources <span class="source">animation/sine-cosine.py</span>).</span><a class="headerlink" href="#id97" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<section id="make-it-rain">
<h3>Make it rain<a class="headerlink" href="#make-it-rain" title="Permalink to this headline">¶</a></h3>
<p>A very simple rain effect can be obtained by having small growing
rings randomly positioned over a figure. Of course, they won’t grow
forever since ripples are supposed to damp with time. To simulate this
phenomenon, we can use an increasingly transparent color as the ring
is growing, up to the point where it is no more visible. At this
point, we remove the ring and create a new one. First step is to
create a blank figure.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
</pre></div>
</div>
<p>Then we create an empty scatter plot but we take care of settings
linewidth (0.5) and facecolors (“None”) that will apply to any new
data.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">scatter</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">s</span><span class="o">=</span><span class="p">[],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                     <span class="n">edgecolors</span><span class="o">=</span><span class="p">[],</span> <span class="n">facecolors</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Next, we need to create several rings. For this, we can use the
scatter plot object that is generally used to visualize points cloud,
but we can also use it to draw rings by specifying we don’t have a
facecolor. We also have to take care of initial size and color for
each ring such that we have all sizes between a minimum and a maximum
size. In addition, we need to make sure the largest ring is almost
transparent.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="p">[</span> <span class="p">(</span><span class="s2">&quot;position&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,)),</span>
                        <span class="p">(</span><span class="s2">&quot;size&quot;</span><span class="p">,</span>     <span class="nb">float</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)),</span>
                        <span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">,</span>    <span class="nb">float</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,))</span> <span class="p">])</span>
<span class="n">R</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">R</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">R</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">][:,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
<p>Now, we need to write the update function for our animation. We know
that at each time step each ring should grow and become more
transparent while the largest ring should be totally transparent and
thus removed. Of course, we won’t actually remove the largest ring but
re-use it to set a new ring at a new random position, with nominal
size and color. Hence, we keep the number of rings constant.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">rain_update</span><span class="p">(</span><span class="n">frame</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">R</span><span class="p">,</span> <span class="n">scatter</span>

    <span class="c1"># Transparency of each ring is increased</span>
    <span class="n">R</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">][:,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">R</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">][:,</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">R</span><span class="p">))</span>

    <span class="c1"># Size of each rings is increased</span>
    <span class="n">R</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>

    <span class="c1"># Reset last ring</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">frame</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
    <span class="n">R</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">R</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">R</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># Update scatter object accordingly</span>
    <span class="n">scatter</span><span class="o">.</span><span class="n">set_edgecolors</span><span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">])</span>
    <span class="n">scatter</span><span class="o">.</span><span class="n">set_sizes</span><span class="p">(</span><span class="mi">1000</span><span class="o">*</span><span class="n">R</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
    <span class="n">scatter</span><span class="o">.</span><span class="n">set_offsets</span><span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>Last step is to tell matplotlib to use this function as an update
function for the animation and display the result (or save it as a
movie):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">animation</span> <span class="o">=</span> <span class="n">animation</span><span class="o">.</span><span class="n">FuncAnimation</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">rain_update</span><span class="p">,</span>
                                    <span class="n">interval</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">frames</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-default" id="id98">
<a class="reference internal image-reference" href="rst/animation/rain.pdf"><img alt="rst/animation/rain.pdf" src="rst/animation/rain.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Still from the rain animation (sources <span class="source">animation/rain.py</span>).</span><a class="headerlink" href="#id98" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="visualizing-earthquakes-on-earth">
<h3>Visualizing earthquakes on Earth<a class="headerlink" href="#visualizing-earthquakes-on-earth" title="Permalink to this headline">¶</a></h3>
<p>We’ll now use the rain animation to visualize earthquakes on the
planet from the last 30 days. The USGS Earthquake Hazards Program is
part of the National Earthquake Hazards Reduction Program (NEHRP) and
provides several data on their website. Those data are sorted
according to earthquakes magnitude, ranging from significant only down
to all earthquakes, major or minor. You would be surprised by the
number of minor earthquakes happening every hour on the planet. Since
this would represent too much data for us, we’ll stick to earthquakes
with magnitude &gt; 4.5. At the time of writing, this already represent
more than 300 earthquakes in the last 30 days.</p>
<p>First step is to read and convert data. We’ll use the urllib library
that allows us to open and read remote data. Data on the website use
the CSV format whose content is given by the first line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">time</span><span class="p">,</span><span class="n">latitude</span><span class="p">,</span><span class="n">longitude</span><span class="p">,</span><span class="n">depth</span><span class="p">,</span><span class="n">mag</span><span class="p">,</span><span class="n">magType</span><span class="p">,</span><span class="n">nst</span><span class="p">,</span><span class="n">gap</span><span class="p">,</span><span class="n">dmin</span><span class="p">,</span><span class="n">rms</span><span class="p">,</span><span class="o">...</span>
<span class="mi">2015</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">17</span><span class="n">T13</span><span class="p">:</span><span class="mi">49</span><span class="p">:</span><span class="mf">17.320</span><span class="n">Z</span><span class="p">,</span><span class="mf">37.8365</span><span class="p">,</span><span class="o">-</span><span class="mf">122.2321667</span><span class="p">,</span><span class="mf">4.82</span><span class="p">,</span><span class="mf">4.01</span><span class="p">,</span><span class="n">mw</span><span class="p">,</span><span class="o">...</span>
<span class="mi">2015</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">15</span><span class="n">T07</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mf">06.640</span><span class="n">Z</span><span class="p">,</span><span class="o">-</span><span class="mf">10.9045</span><span class="p">,</span><span class="mf">163.8766</span><span class="p">,</span><span class="mf">6.35</span><span class="p">,</span><span class="mf">6.6</span><span class="p">,</span><span class="n">mwp</span><span class="p">,</span><span class="o">...</span>
</pre></div>
</div>
<p>We are only interested in latitude, longitude and magnitude and
consequently, we won’t parse the time of event.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">urllib</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># -&gt; http://earthquake.usgs.gov/earthquakes/feed/v1.0/csv.php</span>
<span class="n">feed</span> <span class="o">=</span> <span class="s2">&quot;http://earthquake.usgs.gov/&quot;</span> \
     <span class="o">+</span> <span class="s2">&quot;earthquakes/feed/v1.0/summary/&quot;</span>

<span class="c1"># Magnitude &gt; 4.5</span>
<span class="n">url</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">feed</span> <span class="o">+</span> <span class="s2">&quot;4.5_month.csv&quot;</span><span class="p">)</span>

<span class="c1"># Magnitude &gt; 2.5</span>
<span class="c1"># url = urllib.request.urlopen(feed + &quot;2.5_month.csv&quot;)</span>

<span class="c1"># Magnitude &gt; 1.0</span>
<span class="c1"># url = urllib.request.urlopen(feed + &quot;1.0_month.csv&quot;)</span>

<span class="c1"># Reading and storage of data</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;position&#39;</span><span class="p">,</span>  <span class="nb">float</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,)),</span>
                               <span class="p">(</span><span class="s1">&#39;magnitude&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,))])</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
    <span class="n">row</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="n">E</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span><span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">E</span><span class="p">[</span><span class="s1">&#39;magnitude&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
</pre></div>
</div>
<p>We need to draw the earth to show precisely where the earthquake
center is and to translate latitude/longitude in some coordinates
matplotlib can handle. Fortunately, there is the <a class="reference external" href="https://scitools.org.uk/cartopy/docs/latest/">cartopy</a> library that is not
so simple to install but really easy to use.</p>
<p>First step is to define a projection to draw the earth onto a screen.
There exists many different projections but we’ll use the <a class="reference external" href="https://en.wikipedia.org/wiki/Equirectangular_projection">Equirectangular
projection</a> which
is rather standard for non-specialists like me.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default" id="id99">
<a class="reference internal image-reference" href="rst/animation/platecarree.pdf"><img alt="rst/animation/platecarree.pdf" src="rst/animation/platecarree.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Equirectangular projection
<span class="label">figure-animation-equirectangular</span>
(sources: <span class="source">animation/platecarree.py</span>).</span><a class="headerlink" href="#id99" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>We can now adapt the rain animation to display eartquakes. To do that,
we just need to add a <span class="code">transform</span> to the scatter plot such that
coordinates will be automatically transformed (by cartopy).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">scatter</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
</pre></div>
</div>
<figure class="align-default" id="id100">
<a class="reference internal image-reference" href="rst/animation/earthquakes-frame-50.pdf"><img alt="rst/animation/earthquakes-frame-50.pdf" src="rst/animation/earthquakes-frame-50.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Earthquakes still (July 23, 2021 at 11am CET)
<span class="label">figure-animation-earthquakes</span>
(sources: <span class="source">animation/earthquakes.py</span>).</span><a class="headerlink" href="#id100" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="scenarized-animation">
<h3>Scenarized animation<a class="headerlink" href="#scenarized-animation" title="Permalink to this headline">¶</a></h3>
<p>We’ve seen the basic principles of animation. It is now time to define
a more elaborated scenario for our animation. To do that, we’ll play
with fluid simulation because it’s fun. In
<span class="source">animation/fluid.py</span>, you’ll find an implementation of stable
fluid simulation written by <a class="reference external" href="https://github.com/GregTJ/stable-fluids">Gregory Johnson</a> based on the paper of
<a class="reference external" href="https://d2f99xq7vri1nk.cloudfront.net/legacy_app_files/pdf/ns.pdf">Joe Stam</a>.</p>
<p>I’ve modified the original script and written an <span class="code">inflow</span> method that
define a source at a given position (angle). At each frame, we want to
define active sources such that the overall animation displays a
sequence of emitting sources.</p>
<p>In the scenario below, I define arbitrarily a rotating sequence of
sources to maximize blending in the center but you could also imagine
synchronizing this animation with some music for example.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">fluid</span> <span class="kn">import</span> <span class="n">Fluid</span><span class="p">,</span> <span class="n">inflow</span>
<span class="kn">from</span> <span class="nn">scipy.special</span> <span class="kn">import</span> <span class="n">erf</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.animation</span> <span class="k">as</span> <span class="nn">animation</span>

<span class="n">shape</span> <span class="o">=</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">256</span>
<span class="n">duration</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">fluid</span> <span class="o">=</span> <span class="n">Fluid</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="s1">&#39;dye&#39;</span><span class="p">)</span>
<span class="n">inflows</span> <span class="o">=</span> <span class="p">[</span><span class="n">inflow</span><span class="p">(</span><span class="n">fluid</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
           <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span>

<span class="c1"># Animation setup</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([]);</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([]);</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">),</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s2">&quot;lower&quot;</span><span class="p">,</span>
                <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;bicubic&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">RdYlBu</span><span class="p">)</span>

<span class="c1"># Animation scenario</span>
<span class="n">scenario</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
    <span class="n">scenario</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span> <span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="o">*</span><span class="mi">20</span> <span class="p">)</span>
<span class="n">scenario</span><span class="o">.</span><span class="n">extend</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">]]</span><span class="o">*</span><span class="mi">30</span><span class="p">)</span>
<span class="n">scenario</span><span class="o">.</span><span class="n">extend</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">]]</span><span class="o">*</span><span class="mi">30</span><span class="p">)</span>

<span class="c1"># Animation update</span>
<span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="n">frame</span><span class="p">):</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">scenario</span><span class="p">[</span><span class="n">frame</span><span class="p">]:</span>
        <span class="n">inflow_velocity</span><span class="p">,</span> <span class="n">inflow_dye</span> <span class="o">=</span> <span class="n">inflows</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">fluid</span><span class="o">.</span><span class="n">velocity</span> <span class="o">+=</span> <span class="n">inflow_velocity</span>
        <span class="n">fluid</span><span class="o">.</span><span class="n">dye</span> <span class="o">+=</span> <span class="n">inflow_dye</span>
    <span class="n">divergence</span><span class="p">,</span> <span class="n">curl</span><span class="p">,</span> <span class="n">pressure</span> <span class="o">=</span> <span class="n">fluid</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="n">curl</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="p">(</span><span class="n">erf</span><span class="p">(</span><span class="n">Z</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span>

    <span class="n">im</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>
    <span class="n">im</span><span class="o">.</span><span class="n">set_clim</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">Z</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">vmax</span><span class="o">=</span><span class="n">Z</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

<span class="n">anim</span> <span class="o">=</span> <span class="n">animation</span><span class="o">.</span><span class="n">FuncAnimation</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">update</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">frames</span><span class="o">=</span><span class="n">duration</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default" id="id101">
<a class="reference internal image-reference" href="rst/animation/fluid-animation.png"><img alt="rst/animation/fluid-animation.png" src="rst/animation/fluid-animation.png" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Fluid simulation
<span class="label">figure-fluid-animation</span>
(sources: <span class="source">animation/fluid-animation.py</span>).</span><a class="headerlink" href="#id101" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Note that in the update function, I took care of updating the limits
of the colormap. This is necessary because the displayed image is
dynamic and the minimum and maximum values may vary from one frame ot
the other. If you don’t do that, you might have some flickering.</p>
<p>You can also have much more elaborated scenario such as in the
following example which is a <a class="reference external" href="https://github.com/rougier/less-is-more">remake</a> of an animation
originally designed by dark horse analytics.</p>
<figure class="align-default" id="id102">
<a class="reference internal image-reference" href="rst/animation/less-is-more.png"><img alt="rst/animation/less-is-more.png" src="rst/animation/less-is-more.png" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Less is more <span class="label">figure-less-is-more</span>
(sources: <span class="source">animation/less-is-more.py</span>).</span><a class="headerlink" href="#id102" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="id8">
<h3>Exercise<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>The goal of this exercise is to create an animation showing how
<a class="reference external" href="https://en.wikipedia.org/wiki/Lissajous_curve">Lissajous curves</a>
are generated. Figure <span class="xref std std-ref">figure-lissajous</span> shows a still from the
animation. Make sure to try to copy the exact style.</p>
<figure class="align-default" id="id103">
<a class="reference internal image-reference" href="rst/animation/lissajous.pdf"><img alt="rst/animation/lissajous.pdf" src="rst/animation/lissajous.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Lissajous curves <span class="label">figure-lissajous</span>
(sources: <span class="source">animation/lissajous.py</span>).</span><a class="headerlink" href="#id103" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p></p>
</section>
</section>
<section id="going-3d">
<span id="chap-3d"></span><h2>Going 3D<a class="headerlink" href="#going-3d" title="Permalink to this headline">¶</a></h2>
<p>Matplotlib has a really nice <a class="reference external" href="https://matplotlib.org/mpl_toolkits/mplot3d/tutorial.html">3D interface</a> with
many capabilities (and some limitations) that is quite popular among
users. Yet, 3D is still considered to be some kind of black magic for
some users (or maybe for the majority of users). I would thus like to
explain in this chapter that 3D rendering is really easy once you’ve
understood a few concepts. To demonstrate that, we’ll render the bunny
on figure above with 60 lines of Python and one matplotlib call. That
is, without using the 3D axis.</p>
<figure class="align-default" id="id104">
<a class="reference internal image-reference" href="rst/threed/bunny.pdf"><img alt="rst/threed/bunny.pdf" src="rst/threed/bunny.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Stanford bunny.
(sources: <span class="source">threed/bunny.py</span>).
<span class="label">figure-bunny</span></span><a class="headerlink" href="#id104" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<section id="loading-the-bunny">
<h3>Loading the bunny<a class="headerlink" href="#loading-the-bunny" title="Permalink to this headline">¶</a></h3>
<p>First things first, we need to load our model. We’ll use a simplified
version of the <a class="reference external" href="https://en.wikipedia.org/wiki/Stanford_bunny">Stanford bunny</a>.  The file uses the
<a class="reference external" href="https://en.wikipedia.org/wiki/Wavefront_.obj_file">wavefront format</a> which is one of
the simplest format, so let’s make a very simple (but error-prone)
loader that will just do the job for this specific model. Else, you
can use the <a class="reference external" href="https://pypi.org/project/meshio/">meshio library</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">V</span><span class="p">,</span> <span class="n">F</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;bunny.obj&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
   <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
       <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">):</span> <span class="k">continue</span>
       <span class="n">values</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
       <span class="k">if</span> <span class="ow">not</span> <span class="n">values</span><span class="p">:</span> <span class="k">continue</span>
       <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;v&#39;</span><span class="p">:</span>
           <span class="n">V</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]])</span>
       <span class="k">elif</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;f&#39;</span><span class="p">:</span>
           <span class="n">F</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]])</span>
<span class="n">V</span><span class="p">,</span> <span class="n">F</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">V</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">F</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
</pre></div>
</div>
<p><span class="code">V</span> is now a set of vertices (3D points if you prefer) and <span class="code">F</span> is a set of
faces (= triangles). Each triangle is described by 3 indices relatively to the
vertices array. Now, let’s normalize the vertices such that the overall bunny
fits the unit box:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">V</span> <span class="o">=</span> <span class="p">(</span><span class="n">V</span><span class="o">-</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">+</span><span class="n">V</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">-</span><span class="n">V</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
<p>Now, we can have a first look at the model by getting only the x,y
coordinates of the vertices and get rid of the z coordinate. To do
this we can use the powerful <a class="reference external" href="https://matplotlib.org/3.1.1/api/collections_api.html#matplotlib.collections.PolyCollection">PolyCollection</a>
object that allow to render efficiently a collection of non-regular
polygons. Since, we want to render a bunch of triangles, this is a
perfect match. So let’s first extract the triangles and get rid of the
<span class="code">z</span> coordinate:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">T</span> <span class="o">=</span> <span class="n">V</span><span class="p">[</span><span class="n">F</span><span class="p">][</span><span class="o">...</span><span class="p">,:</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
<p>We can now render it:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span>
                  <span class="n">aspect</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">collection</span> <span class="o">=</span> <span class="n">PolyCollection</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                            <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>Result is shown on figure <span class="xref std std-ref">figure-bunny-1</span>.</p>
<figure class="align-default" id="id105">
<a class="reference internal image-reference" href="rst/threed/bunny-1.pdf"><img alt="rst/threed/bunny-1.pdf" src="rst/threed/bunny-1.pdf" style="width: 50%;" /></a>
<figcaption>
<p><span class="caption-text">Stanford bunny without any transformation.
(sources: <span class="source">threed/bunny-1.py</span>).
<span class="label">figure-bunny-1</span></span><a class="headerlink" href="#id105" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="perspective-projection">
<h3>Perspective Projection<a class="headerlink" href="#perspective-projection" title="Permalink to this headline">¶</a></h3>
<p>The rendering we’ve just made is actually an <a class="reference external" href="https://en.wikipedia.org/wiki/Orthographic_projection">orthographic projection</a> while the
previous bunny uses a <a class="reference external" href="https://en.wikipedia.org/wiki/3D_projection#Perspective_projection">perspective projection</a>:</p>
<figure class="align-default" id="id106">
<a class="reference internal image-reference" href="rst/threed/projection.pdf"><img alt="rst/threed/projection.pdf" src="rst/threed/projection.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Orthographic and perspective projections.
<span class="label">figure-projections</span></span><a class="headerlink" href="#id106" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>In both cases, the proper way of defining a projection is first to
define a viewing volume, that is, the volume in the 3d space we want
to render on the scree. To do that, we need to consider 6 clipping
planes (left, right, top, bottom, far, near) that enclose the viewing
volume (frustum) relatively to the camera. If we define a camera
position and a viewing direction, each plane can be described by a
single scalar. Once we have this viewing volume, we can project onto
the screen using either the orthographic or the perspective
projection.</p>
<p>Fortunately for us, these projections are quite well known and can be
expressed using 4x4 matrices:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">frustum</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="n">znear</span><span class="p">,</span> <span class="n">zfar</span><span class="p">):</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">+</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">znear</span> <span class="o">/</span> <span class="p">(</span><span class="n">right</span> <span class="o">-</span> <span class="n">left</span><span class="p">)</span>
    <span class="n">M</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">+</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">znear</span> <span class="o">/</span> <span class="p">(</span><span class="n">top</span> <span class="o">-</span> <span class="n">bottom</span><span class="p">)</span>
    <span class="n">M</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">zfar</span> <span class="o">+</span> <span class="n">znear</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">zfar</span> <span class="o">-</span> <span class="n">znear</span><span class="p">)</span>
    <span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">right</span> <span class="o">+</span> <span class="n">left</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">right</span> <span class="o">-</span> <span class="n">left</span><span class="p">)</span>
    <span class="n">M</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">top</span> <span class="o">+</span> <span class="n">bottom</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">top</span> <span class="o">-</span> <span class="n">bottom</span><span class="p">)</span>
    <span class="n">M</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">znear</span> <span class="o">*</span> <span class="n">zfar</span> <span class="o">/</span> <span class="p">(</span><span class="n">zfar</span> <span class="o">-</span> <span class="n">znear</span><span class="p">)</span>
    <span class="n">M</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
    <span class="k">return</span> <span class="n">M</span>

<span class="k">def</span> <span class="nf">perspective</span><span class="p">(</span><span class="n">fovy</span><span class="p">,</span> <span class="n">aspect</span><span class="p">,</span> <span class="n">znear</span><span class="p">,</span> <span class="n">zfar</span><span class="p">):</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">radians</span><span class="p">(</span><span class="n">fovy</span><span class="p">))</span> <span class="o">*</span> <span class="n">znear</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">h</span> <span class="o">*</span> <span class="n">aspect</span>
    <span class="k">return</span> <span class="n">frustum</span><span class="p">(</span><span class="o">-</span><span class="n">w</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">znear</span><span class="p">,</span> <span class="n">zfar</span><span class="p">)</span>
</pre></div>
</div>
<p>For the perspective projection, we also need to specify the aperture
angle that (more or less) sets the size of the near plane relatively
to the far plane. Consequently, for high apertures, you’ll get a lot
of “deformations”.</p>
<p>However, if you look at the two functions above, you’ll realize they
return 4x4 matrices while our coordinates are 3d. How to use these
matrices then ? The answer is <a class="reference external" href="https://en.wikipedia.org/wiki/Homogeneous_coordinates">homogeneous coordinates</a>. To make a
long story short, homogeneous coordinates are best to deal with
transformation and projections in 3D. In our case, because we’re
dealing with vertices (and not vectors), we only need to add 1 as the
fourth coordinates (w) to all our vertices. Then we can apply the
perspective transformation using the dot product.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">V</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">V</span><span class="p">))]</span> <span class="o">@</span> <span class="n">perspective</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
<p>Last step, we need to re-normalize the homogeneous coordinates. This
means we divide each transformed vertices with the last component (w)
such as to always have w=1 for each vertices.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">V</span> <span class="o">/=</span> <span class="n">V</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we can check the result on figure <span class="xref std std-ref">figure-bunny-2</span> that looks totally wrong.</p>
<figure class="align-default" id="id107">
<a class="reference internal image-reference" href="rst/threed/bunny-2.pdf"><img alt="rst/threed/bunny-2.pdf" src="rst/threed/bunny-2.pdf" style="width: 50%;" /></a>
<figcaption>
<p><span class="caption-text">Wrong rendering when camera is inside.
(sources: <span class="source">threed/bunny-2.py</span>).
<span class="label">figure-bunny-2</span></span><a class="headerlink" href="#id107" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>It looks wrong because the camera is actually inside the bunny. To
have a proper rendering, we need to move the bunny away from the
camera or to move the camera away from the bunny. Let’s do the
later. The camera is currently positioned at (0,0,0) and looking up in
the z direction (because of the frustum transformation). We thus need
to move the camera away a little bit in the z negative direction and
before the perspective transformation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">V</span> <span class="o">=</span> <span class="n">V</span> <span class="o">-</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">3.5</span><span class="p">)</span>
<span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">V</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">V</span><span class="p">))]</span> <span class="o">@</span> <span class="n">perspective</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">V</span> <span class="o">/=</span> <span class="n">V</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>The corrected output is shown on figure <span class="xref std std-ref">figure-bunny-3</span>.</p>
<figure class="align-default" id="id108">
<a class="reference internal image-reference" href="rst/threed/bunny-3.pdf"><img alt="rst/threed/bunny-3.pdf" src="rst/threed/bunny-3.pdf" style="width: 50%;" /></a>
<figcaption>
<p><span class="caption-text">Corrected rendering with camera away.
(sources: <span class="source">threed/bunny-3.py</span>).
<span class="label">figure-bunny-3</span></span><a class="headerlink" href="#id108" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="model-view-projection-mvp">
<h3>Model, view, projection (MVP)<a class="headerlink" href="#model-view-projection-mvp" title="Permalink to this headline">¶</a></h3>
<p>It might be not obvious, but the last rendering is actually a perspective
transformation. To make it more obvious, we’ll rotate the bunny around. To do
that, we need some rotation matrices (4x4) and we can as well define the
translation matrix in the meantime:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">translate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">],</span>
                     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="p">],</span>
                     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">z</span><span class="p">],</span>
                     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">xrotate</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">theta</span> <span class="o">/</span> <span class="mi">180</span>
    <span class="n">c</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span>  <span class="n">c</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">yrotate</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">theta</span> <span class="o">/</span> <span class="mi">180</span>
    <span class="n">c</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="k">return</span>  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span> <span class="n">c</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                      <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                      <span class="p">[</span><span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                      <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
</pre></div>
</div>
<p>We’ll now decompose the transformations we want to apply in term of model
(local transformations), view (global transformations) and projection such that
we can compute a global MVP matrix that will do everything at once:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">xrotate</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="o">@</span> <span class="n">yrotate</span><span class="p">(</span><span class="mi">45</span><span class="p">)</span>
<span class="n">view</span>  <span class="o">=</span> <span class="n">translate</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mf">3.5</span><span class="p">)</span>
<span class="n">proj</span>  <span class="o">=</span> <span class="n">perspective</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">MVP</span>   <span class="o">=</span> <span class="n">proj</span>  <span class="o">@</span> <span class="n">view</span>  <span class="o">@</span> <span class="n">model</span>
</pre></div>
</div>
<p>and we now write:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">V</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">V</span><span class="p">))]</span> <span class="o">@</span> <span class="n">MVP</span><span class="o">.</span><span class="n">T</span>
<span class="n">V</span> <span class="o">/=</span> <span class="n">V</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>You should obtain results shown on figure <span class="xref std std-ref">figure-bunny-4</span>.</p>
<figure class="align-default" id="id109">
<a class="reference internal image-reference" href="rst/threed/bunny-4.pdf"><img alt="rst/threed/bunny-4.pdf" src="rst/threed/bunny-4.pdf" style="width: 50%;" /></a>
<figcaption>
<p><span class="caption-text">Rotated and translated bunny.
(sources: <span class="source">threed/bunny-4.py</span>).
<span class="label">figure-bunny-4</span></span><a class="headerlink" href="#id109" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Let’s now play a bit with the aperture such that you can see the
difference (see figure <span class="xref std std-ref">figure-bunny-5</span>).  Note that we also need
to adapt the distance to the camera in order for the bunnies to have
the same apparent size</p>
<figure class="align-default" id="id110">
<a class="reference internal image-reference" href="rst/threed/bunny-5.pdf"><img alt="rst/threed/bunny-5.pdf" src="rst/threed/bunny-5.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Different apertures
(sources: <span class="source">threed/bunny-5.py</span>).
<span class="label">figure-bunny-5</span></span><a class="headerlink" href="#id110" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="depth-sorting">
<h3>Depth sorting<a class="headerlink" href="#depth-sorting" title="Permalink to this headline">¶</a></h3>
<p>Let’s try now to fill the triangles and see what happens (figure
<span class="xref std std-ref">figure-bunny-6</span>).</p>
<figure class="align-default" id="id111">
<a class="reference internal image-reference" href="rst/threed/bunny-6.pdf"><img alt="rst/threed/bunny-6.pdf" src="rst/threed/bunny-6.pdf" style="width: 50%;" /></a>
<figcaption>
<p><span class="caption-text">Rendering without depth sorting.
(sources: <span class="source">threed/bunny-6.py</span>).
<span class="label">figure-bunny-6</span></span><a class="headerlink" href="#id111" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>As you can see, the result is totally wrong. The problem is that the
PolyCollection draws the triangles in the order they are given
while we would like to have them from back to front. This means we
need to sort them according to their depth. The good news is that we
already computed this information when we applied the MVP
transformation. It is stored in the new z coordinates. However, these
z values are vertices based while we need to sort the triangles. We’ll
thus take the mean z value as being representative of the depth of a
triangle. If triangles are relatively small and do not intersect, this
works beautifully:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">T</span> <span class="o">=</span>  <span class="n">V</span><span class="p">[:,:,:</span><span class="mi">2</span><span class="p">]</span>
<span class="n">Z</span> <span class="o">=</span> <span class="o">-</span><span class="n">V</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="p">[</span><span class="n">I</span><span class="p">,:]</span>
</pre></div>
</div>
<p>And now everything is rendered correctly as shown on figure
<span class="xref std std-ref">figure-bunny-7</span>.</p>
<figure class="align-default" id="id112">
<a class="reference internal image-reference" href="rst/threed/bunny-7.pdf"><img alt="rst/threed/bunny-7.pdf" src="rst/threed/bunny-7.pdf" style="width: 50%;" /></a>
<figcaption>
<p><span class="caption-text">Rendering with depth sorting.
(sources: <span class="source">threed/bunny-7.py</span>).
<span class="label">figure-bunny-7</span></span><a class="headerlink" href="#id112" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Let’s add some colors using the depth buffer. We’ll color each triangle
according to it depth. The beauty of the PolyCollection object is that you can
specify the color of each of the triangle using a numpy array, so let’s just do
that:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">zmin</span><span class="p">,</span> <span class="n">zmax</span> <span class="o">=</span> <span class="n">Z</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">Z</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">Z</span> <span class="o">=</span> <span class="p">(</span><span class="n">Z</span><span class="o">-</span><span class="n">zmin</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">zmax</span><span class="o">-</span><span class="n">zmin</span><span class="p">)</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;magma&quot;</span><span class="p">)(</span><span class="n">Z</span><span class="p">)</span>
<span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>
<span class="n">T</span><span class="p">,</span> <span class="n">C</span> <span class="o">=</span> <span class="n">T</span><span class="p">[</span><span class="n">I</span><span class="p">,:],</span> <span class="n">C</span><span class="p">[</span><span class="n">I</span><span class="p">,:]</span>
</pre></div>
</div>
<p>And our final display is show on figure <span class="xref std std-ref">figure-bunny-8</span>.</p>
<figure class="align-default" id="id113">
<a class="reference internal image-reference" href="rst/threed/bunny-8.pdf"><img alt="rst/threed/bunny-8.pdf" src="rst/threed/bunny-8.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Rendering with depth colors.
(sources: <span class="source">threed/bunny-8.py</span>).
<span class="label">figure-bunny-8</span></span><a class="headerlink" href="#id113" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>The final script (<span class="source">threed/bunny-8.py</span>) is 57 lines but
hardly readable. However, it shows that 3D rendering can be done quite
easily with matplotlib and a few transformations.</p>
</section>
<section id="id10">
<h3>Exercises<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>Using the definition of the orthographic projection, try to reproduce
the figure <span class="xref std std-ref">figure-bunnies</span> that mix perspective (top left) and
orthographic projections. Each bunny is contained in one axes.</p>
<figure class="align-default" id="id114">
<a class="reference internal image-reference" href="rst/threed/bunnies.pdf"><img alt="rst/threed/bunnies.pdf" src="rst/threed/bunnies.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Stanford bunnies
(sources: <span class="source">threed/bunnies.py</span>).
<span class="label">figure-bunnies</span></span><a class="headerlink" href="#id114" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p></p>
</section>
</section>
<section id="architecture-optimization">
<span id="chap-optimization"></span><h2>Architecture &amp; optimization<a class="headerlink" href="#architecture-optimization" title="Permalink to this headline">¶</a></h2>
<p>Even though a deep understanding of the matplotlib architecture is not
necessary to use it, it is nonetheless useful to know a bit of its
architecture to optimize either speed, memory and even
rendering.</p>
<section id="transparency-levels">
<h3>Transparency levels<a class="headerlink" href="#transparency-levels" title="Permalink to this headline">¶</a></h3>
<p>We’ve already seen how to use transparency in a scatter plot to have
a perception of data density. This works reasonably well if you don’t
have too much data. But what is too much exactly? It would be hard to
give a definitive limit because it depends on a number of parameters
such as the size of your figure, the shape and size of your markers
and the alpha level (i.e. transparency). For this latter, there is
actually a limit in how much transparent a color can be and it is
exactly 0.002 (= 1/500). This means that if you plot 500 black points
with a transparency of 0.002, you obtain get a quasi black marker as
shown on figure <span class="xref std std-ref">figure-transparency</span>.</p>
<figure class="align-default" id="id115">
<a class="reference internal image-reference" href="rst/optimization/transparency.pdf"><img alt="rst/optimization/transparency.pdf" src="rst/optimization/transparency.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Transparency levels
<span class="label">figure-transparency</span>
(sources: <span class="source">optimization/transparency.py</span>).</span><a class="headerlink" href="#id115" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>It is not exactly black for 500 points because it also depends on how
alpha compositing is computed internally but it provides nonetheless a
useful approximation. Knowing this limit exists, it explains why you
get a solid color in dense areas when you have a lot of data. This is
illustrated on figure <span class="xref std std-ref">figure-scatters</span> where the number of data
is respectively 10,000, 100,000 and 1,000,000. For 10,000 and 100,000
points we can adapt the transparency level to show where are the dense
areas. In this case, this is simple normal distribution and we can
observe the central are is darker. For one million points, we reached
the limit of the transparency trick (alpha=0.002) and we now have a
central dark spot that hide information.</p>
<figure class="align-default" id="id116">
<a class="reference internal image-reference" href="rst/optimization/scatters.png"><img alt="rst/optimization/scatters.png" src="rst/optimization/scatters.png" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Scatter, hist2d and hexbin
<span class="label">figure-scatters</span>
(sources: <span class="source">optimization/scatters.py</span>).</span><a class="headerlink" href="#id116" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>This means we need a new strategy to display the data. Fortunately,
matplotlib provides <a class="reference external" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.hist2d.html">hist2d</a>
and <a class="reference external" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.hexbin.html">hexbin</a>
that will both aggregate points into bins (with square or hex
shape) that are eventually colored according to the number in the
bins. This allows to visualize density for any number of data points
and do not require to manipulate size and/or transparency of
markers. You’re now ready to reproduce Todd W. Schneider’s astonishing
visualization of NYC Taxi trips (<a class="reference external" href="https://toddwschneider.com/posts/analyzing-1-1-billion-nyc-taxi-and-uber-trips-with-a-vengeance/">Analyzing 1.1 Billion NYC Taxi and
Uber Trips, with a Vengeance</a>).</p>
<p>Alpha compositing induces other kind of problems with line plots,
especially when a plot is self-covering itself as exemplified of a a
high-frequency signal shown on figure <span class="xref std std-ref">figure-multisample</span>. The
signal is a product of two sine waves of different frequency and
reads:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="mi">0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
<span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.1</span><span class="p">,</span> <span class="o">+</span><span class="mf">1.1</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
<p>When we plot this signal, we can see that the density of lines becomes
higher and higher from left to right. Near the right side of the plot,
the frequency is the highest and is actually higher than the screen
resolution such that there is no empty spaces between successive
waves. However, when we use a regular plot (first line of figure
<span class="xref std std-ref">figure-multisample</span>) with some transparency, we do not see a
change in color (while we could expect the plot to self-cover itself).
The reason is that matplotlib rendering engine takes care of not
overdrawing an area that belong to the same plot as shown on the figure
below:</p>
<figure class="align-default" id="id117">
<a class="reference internal image-reference" href="rst/optimization/self-cover.pdf"><img alt="rst/optimization/self-cover.pdf" src="rst/optimization/self-cover.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Self-covering example
<span class="label">figure-self-cover</span>
(sources: <span class="source">optimization/self-cover.py</span>).</span><a class="headerlink" href="#id117" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>This explains why we do not have color change in figure
<span class="xref std std-ref">figure-multisample</span>. To counter this effect, we can render the
same plot using a line collection made of individual segments. In
such case, each segment is considered separately and will influence
other segments. This corresponds to the second line on the figure and
now we can observe a change in the color with darker colors on the
right suggesting a higher frequency.</p>
<p>We can also adopt a totally different strategy by multisampling the
signal, which is a standard techniques in signal processing. Instead
of plotting the signal, I created an empty image with enough
resolution and for each point (pixel) of this image, I considered 8
samples point randomly but closely distributed around the point to
decide of its value. This is of course a slower compared to a regular
plot but the rendering is more faithful to the signal as shown on the
third line.</p>
<figure class="align-default" id="id118">
<a class="reference internal image-reference" href="rst/optimization/multisample.png"><img alt="rst/optimization/multisample.png" src="rst/optimization/multisample.png" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">High-frequency signal.
<span class="label">figure-multisample</span>
(sources: <span class="source">optimization/multisample.py</span>).</span><a class="headerlink" href="#id118" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="speed-up-rendering">
<h3>Speed-up rendering<a class="headerlink" href="#speed-up-rendering" title="Permalink to this headline">¶</a></h3>
<p>The overall speed of rendering a given figure depends on a number of
matplotlib internal factors that are good to know. Even though the
rendering speed is pretty decent in most cases, things can degrade
very noticeably when you have a large number of objects and we’ve been
already experienced such slowdown with the previous scatter plot
examples. You may have noticed that there are two ways to render a
scatter plot. Either you use the plot command with only markers or you
use the dedicated scatter command. The two methods are similar and yet
different. If you need a scatter plot where the size, shape and color
of markers are the same, then you can use the plot command that is
faster (by a factor of two approximately). For any other case, the
scatter command is the one to use. We can try to measure the time to
prepare a one million scatter plot using the following code:</p>
<figure class="align-default" id="id119">
<a class="reference internal image-reference" href="rst/optimization/scatter-benchmark.png"><img alt="rst/optimization/scatter-benchmark.png" src="rst/optimization/scatter-benchmark.png" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Scatter benchmark
<span class="label">figure-scatter-benchmark</span>
(sources: <span class="source">optimization/scatter-benchmark.py</span>).</span><a class="headerlink" href="#id119" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>By they way, you may have noticed the difference in size between plot
(<span class="code">markersize=2</span>) and scatter (<span class="code">s=2**2</span>). The reason is that the size
of marker in plot is measured in points while the size of markers in
scatter is measured in squared points.</p>
<p>In the case of line plots, the difference in rendering speed between
one solution or is the other can be dramatic as illustrated on figure
<span class="xref std std-ref">figure-line-benchmark</span>. In this example, I drew 1,000 line
segments using 1,000 calls to the plot method (left), a single plot
call (middle) with individual segment coordinates separated by <span class="code">None</span>
and a line collection (right). In this specific case, the choice of
the rendering method makes a big difference such that for a large
number of lines, your rendering can takes a few seconds or several
minutes. Note that the fastest rendering (unified plot, middle) is not
exactly equivalent to the others due to the absence of self-coverage
as explained previously.</p>
<figure class="align-default" id="id120">
<a class="reference internal image-reference" href="rst/optimization/line-benchmark.png"><img alt="rst/optimization/line-benchmark.png" src="rst/optimization/line-benchmark.png" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Line benchmark
<span class="label">figure-line-benchmark</span>
(sources: <span class="source">optimization/line-benchmark.py</span>).</span><a class="headerlink" href="#id120" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="file-sizes">
<h3>File sizes<a class="headerlink" href="#file-sizes" title="Permalink to this headline">¶</a></h3>
<p>Depending on the format you save a figure, the resulting file can be
relatively small but it can also be huge, up to several megabytes and
this does not relate to the complexity of your script but rather to
the amount of details or the number of elements. Let’s consider for
example the following script:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mf">1e6</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mf">1e6</span><span class="p">)))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;vector.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The resulting file size is approximately 15 megabytes. The reason for
such a large file being the pdf format to be a vector format. This
means that the coordinates of each point needs to be encoded. In our
example, we have a million points and two float coordinates per
points. If we consider a float to be represented by 4 bytes, we
already need 8,000,000 bytes to store coordinates. If we now add
individual color (4 bytes, RGBA ) and size (1 float, 4 bytes) we can
easily reached 16 megabytes.</p>
<p>Let me now slightly modify the code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mf">1e6</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mf">1e6</span><span class="p">)),</span>
            <span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;vector.pdf&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
<p>The new file size is approximately 50 kilobytes and the quality is
roughly equivalent even if it is not a pure vector format anymore. In
fact, the <span class="code">rasterized</span> keyword means that maplotlib will create a
rasterized (i.e. bitmap) representation of the scatter plot saving a
lot of memory when saved on disk. Incidentally, it will also make the
rendering of your figure much faster because your pdf viewer does not
need to render individual elements.</p>
<p>However, the combination of a vector format with rasterized elements is
not always the best choice. For example, if you need to produce a huge
figure (e.g. for a poster) with a very high definition, a pure vector
format might be the best format provided you do not have too much
elements. There’s no definitive recipes and the choice is mostly a
matter of experience.</p>
</section>
<section id="multithread-rendering">
<h3>Multithread rendering<a class="headerlink" href="#multithread-rendering" title="Permalink to this headline">¶</a></h3>
<p>Multithread rendering is not natively supported by matplotlib but it
is possible to do it anyway. The most obvious situation happens when
you need to render several different plots. In such a case, there’s no
real difficulty and it’s only matter of starting several threads
concurrently. What is more interesting is to produce a single figure
using multithread rendering. To do that, we need to split the figure
into different and non overlapping parts such that each part can be
rendered independently. Let’s consider, for example, a figure whose
full extent is <span class="code">xlim=[0,9]</span> and <span class="code">ylim=[0,9]</span>. In such as case, we can
define quit easily 9 non-overlapping parts:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mf">4.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5_000_000</span><span class="p">)</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mf">4.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5_000_000</span><span class="p">)</span>

<span class="n">extents</span> <span class="o">=</span> <span class="p">[[</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
                         <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">3</span><span class="p">)]</span>
</pre></div>
</div>
<p>For each of these parts, we can plot an offline figure using a <a class="reference external" href="https://matplotlib.org/stable/api/backend_agg_api.html#matplotlib.backends.backend_agg.FigureCanvasAgg">Figure
Canvas</a>
and save the result in an image:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="n">extent</span><span class="p">):</span>

    <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">extent</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">Figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">canvas</span> <span class="o">=</span> <span class="n">FigureCanvas</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="n">xlim</span> <span class="o">=</span> <span class="p">[</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">],</span> <span class="n">xticks</span><span class="o">=</span><span class="p">[],</span>
                      <span class="n">ylim</span> <span class="o">=</span> <span class="p">[</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="p">],</span> <span class="n">yticks</span><span class="o">=</span><span class="p">[])</span>
    <span class="n">epsilon</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">((</span><span class="n">X</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">xmin</span><span class="o">-</span><span class="n">epsilon</span><span class="p">))</span> <span class="o">&amp;</span>
                    <span class="p">(</span><span class="n">X</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">xmax</span><span class="o">+</span><span class="n">epsilon</span><span class="p">))</span> <span class="o">&amp;</span>
                    <span class="p">(</span><span class="n">Y</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">ymin</span><span class="o">-</span><span class="n">epsilon</span><span class="p">))</span> <span class="o">&amp;</span>
                    <span class="p">(</span><span class="n">Y</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">ymax</span><span class="o">+</span><span class="n">epsilon</span><span class="p">)))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">I</span><span class="p">],</span> <span class="n">Y</span><span class="p">[</span><span class="n">I</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.0025</span><span class="p">)</span>
    <span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">canvas</span><span class="o">.</span><span class="n">renderer</span><span class="o">.</span><span class="n">buffer_rgba</span><span class="p">())</span>
</pre></div>
</div>
<p>Note that I took care of selecting X and Y that are inside the
provided extent (modulo epsilon). This is quite important because we
do not want to plot all the data in each subparts. Else, this would
slow down things.</p>
<p>We can now put back every parts together using several imshow:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span>

<span class="n">extents</span> <span class="o">=</span> <span class="p">[[</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
                         <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">3</span><span class="p">)]</span>
<span class="n">pool</span> <span class="o">=</span> <span class="n">Pool</span><span class="p">()</span>
<span class="n">images</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">plot</span><span class="p">,</span> <span class="n">extents</span><span class="p">)</span>
<span class="n">pool</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">9</span><span class="p">],</span> <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">9</span><span class="p">])</span>
<span class="k">for</span> <span class="n">img</span><span class="p">,</span> <span class="n">extent</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">extents</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>If you look at the result on figure
<span class="xref std std-ref">figure-multithread-rendering</span>, you can observe a flawless
montage of the different pieces. If you set the epsilon value to zero,
you’ll observe white spaces appearing between the different parts. The
reason is that if you enforce very strict clipping, a marker whose
center is outside extent will not be drawn while it may overlap because
of its size.</p>
<figure class="align-default" id="id121">
<a class="reference internal image-reference" href="rst/optimization/multithread.png"><img alt="rst/optimization/multithread.png" src="rst/optimization/multithread.png" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Multithread rendering
<span class="label">figure-multithread-rendering</span>
(sources: <span class="source">optimization/multithread.py</span>).</span><a class="headerlink" href="#id121" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Such multithread rendering is not totally straightforward to implement
because it depends on the possibility to split your in segregated
elements. However, if you have a very complex plots that take several
minutes to render, this is an option worth to be explored.</p>
<p></p>
</section>
</section>
<section id="graphic-library">
<span id="chap-beyond"></span><h2>Graphic library<a class="headerlink" href="#graphic-library" title="Permalink to this headline">¶</a></h2>
<p>Beyond its usage for scientific visualization, matplotlib is also <em>a
comprehensive library for creating static, animated, and interactive
visualizations in Python</em> as written on the <a class="reference external" href="https://matplotlib.org/">website</a>. Said differently, matplotlib is a
graphic library that can be used for virtually any purpose, even
though the performance may vary greatly from one application to the
other, depending on the complexity of the rendering. Such versatility
can be explained by the presence of a number of low-level objects,
that allow to produce virtually any rendering, and supported by a
number of standard operations as shown on figure
<span class="xref std std-ref">figure-polygon-clipping</span></p>
<figure class="align-default" id="id122">
<a class="reference internal image-reference" href="rst/beyond/polygon-clipping.pdf"><img alt="rst/beyond/polygon-clipping.pdf" src="rst/beyond/polygon-clipping.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Polygon clipping
<span class="label">figure-polygon-clipping</span>
(sources: <span class="source">beyond/polygon-clipping.py</span>).</span><a class="headerlink" href="#id122" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Here is a first example showing the capability of matplotlib in terms
of polygon and clipping. As you can see on figure
<span class="xref std std-ref">figure-polygon-clipping</span>, clipping allows to render any
combination of two polygons.</p>
<p>Such clipping can be used as well in a regular figure to make some
interesting effect as shown on figure <span class="xref std std-ref">figure-interactive-loupe</span>.</p>
<figure class="align-default" id="id123">
<a class="reference internal image-reference" href="rst/beyond/interactive-loupe.pdf"><img alt="rst/beyond/interactive-loupe.pdf" src="rst/beyond/interactive-loupe.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Polygon clipping
<span class="label">figure-interactive-loupe</span>
(sources: <span class="source">beyond/interactive-loupe.py</span>).</span><a class="headerlink" href="#id123" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<section id="matplotlib-dungeon">
<h3>Matplotlib dungeon<a class="headerlink" href="#matplotlib-dungeon" title="Permalink to this headline">¶</a></h3>
<p>If you ever played role playing game (especially Dungeons &amp; Dragons),
you may have encountered “Dyson hatching” as shown on figure
<span class="xref std std-ref">figure-matplotlib-dungeon</span> (look at the outside border of
the walls). This kind of hatching is quite unique and immediately
identifies the plan as some kind of dungeon. This hatching has been
originally designed by <a class="reference external" href="https://dysonlogos.blog/">Dyson Logos</a> who
was kind enough to explain <a class="reference external" href="https://dysonlogos.blog/2011/09/03/dungeon-doodles-a-crosshatching-tutorial/">how he draws it (by hand)</a>. Question is then, how to reproduce it using matplotlib?</p>
<p>It’s actually not too difficult but it’s not totally straightforward
either because we have to take care of several details to get a nice
result. The starting point is a random two-dimensional distribution
where points needs to be not too close to each other. To achieve such
result, can use Bridson’s Algorithm which is a very popular method to
produce such blue noise sample point distributions that guarantees
that no two points are closer than a given distance. If you observe
figure <span class="xref std std-ref">figure-bluenoise</span>, you can see the algorithm makes a real
difference when compared to either a pure uniform distribution or a
regular grid with some normal jitters.</p>
<figure class="align-default" id="id124">
<a class="reference internal image-reference" href="rst/beyond/bluenoise.pdf"><img alt="rst/beyond/bluenoise.pdf" src="rst/beyond/bluenoise.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Uniform distribution, jittered grid and blue noise distribution
<span class="label">figure-bluenoise</span>
(sources: <span class="source">beyond/bluenoise.py</span>).</span><a class="headerlink" href="#id124" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>From this blue noise distribution, we can insert hatch pattern at each
location with a random orientation. A hatch pattern is a set of
n parallel lines with some noise:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">hatch</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">theta</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">P</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">P</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">+</span><span class="mf">0.5</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">P</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">P</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">c</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span> <span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">],[</span><span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">P</span> <span class="o">@</span> <span class="n">Z</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
<p>You can see the result in the center of figure
<span class="xref std std-ref">figure-dyson-hatching</span>. This starts to look like Dyson hatching
but it is not yet satisfactory because hatches cover each others. To
avoid that, we need to clip hatches using the corresponding voronoi
cells. The easiest way to do that is to use the <a class="reference external" href="https://github.com/Toblerity/Shapely">shapely library</a> that provides methods to
compute intersection with generic polygons. You can see the result on
the right part of figure <span class="xref std std-ref">figure-dyson-hatching</span> and it looks
much nicer (in my honest opinion).</p>
<figure class="align-default" id="id125">
<a class="reference internal image-reference" href="rst/beyond/dyson-hatching.pdf"><img alt="rst/beyond/dyson-hatching.pdf" src="rst/beyond/dyson-hatching.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Dyson hatching
<span class="label">figure-dyson-hatching</span>
(sources: <span class="source">beyond/dyson-hatching.py</span>).</span><a class="headerlink" href="#id125" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>We are not done yet. Next part is to generate a dungeon. If you search
for dungeon generator on the internet, you’ll find many generators,
from the most basic ones to the much more complex. In my case, I
simply designed the dungeon using inkscape and I extracted the
coordinates of the walls from the svg file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Walls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">11</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">11</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">],[</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">],[</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">],[</span><span class="mi">13</span><span class="p">,</span><span class="mi">8</span><span class="p">],[</span><span class="mi">13</span><span class="p">,</span><span class="mi">10</span><span class="p">],[</span><span class="mi">11</span><span class="p">,</span><span class="mi">10</span><span class="p">],[</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">12</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">7</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">10</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">11</span><span class="p">],[</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">],[</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">],[</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">],[</span><span class="mi">9</span><span class="p">,</span><span class="mi">8</span><span class="p">],[</span><span class="mi">11</span><span class="p">,</span><span class="mi">8</span><span class="p">],[</span><span class="mi">11</span><span class="p">,</span><span class="mi">7</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">7</span><span class="p">],[</span><span class="mi">9</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">walls</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">Walls</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span>
                <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">joinstyle</span><span class="o">=</span><span class="s2">&quot;round&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">walls</span><span class="p">)</span>
</pre></div>
</div>
<p>The next step is to restrict the hatching to the vicinity of the
walls. Since hatches corresponds to our initial point distribution, it
is only a matter of filtering hatches whose centers are sufficiently
close to any wall. It thus only requires to compute the distance of a
point to a line segment. At this point, we do not care it the the
hatch is inside or outside the dungeon since the internal hatches are
hidden by the interior of the dungeon (see zorder above). I proceeded
by adding dotted squares inside corridors using a collection of
vertical and horizontal lines as well as some random “rocks” which are
actually collection of small ellipses. Last, I added a nice title
using an old looking font. I used <a class="reference external" href="https://www.dafont.com/fr/morris-roman.font">Morris Roman</a> font by Dieter
Steffmann.</p>
<p>The result looks nice but it can be further improved. For example, we
could introduce some noise in walls to suggest manual drawing, we
could improve rocks by adding noise, etc. Matplotlib provides
everything that is needed and the only limit is your imagination. If
you’re curious on what could be achieved, make sure to have a look at
<a class="reference external" href="https://watabou.itch.io/one-page-dungeon">one page dungeon</a> by
Oleg Dolya or the <a class="reference external" href="https://mewo2.com/notes/terrain/">Fantasy map generator</a> by Martin O’Leary.</p>
<figure class="align-default" id="id126">
<a class="reference internal image-reference" href="rst/beyond/dungeon.pdf"><img alt="rst/beyond/dungeon.pdf" src="rst/beyond/dungeon.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Matplotlib dungeon
<span class="label">figure-matplotlib-dungeon</span>
(sources: <span class="source">beyond/dungeon.py</span>).</span><a class="headerlink" href="#id126" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="tiny-bot-simulator">
<h3>Tiny bot simulator<a class="headerlink" href="#tiny-bot-simulator" title="Permalink to this headline">¶</a></h3>
<p>Using the same approach, it is possible to design a tiny bot simulator
as shown on figure <span class="xref std std-ref">figure-tinybot</span> which is a snapshot of the
simulation. To design this simulator, I started by splitting the figure
using gridspec as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">G</span> <span class="o">=</span> <span class="n">GridSpec</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">width_ratios</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span> <span class="n">G</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="o">...</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span> <span class="c1"># 8 sensors</span>
    <span class="n">sax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span> <span class="n">G</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    <span class="o">...</span>
</pre></div>
</div>
<p><span class="code">ax</span> is the axes on the left showing the maze and the bot while sax
are axes to display sensors value on the right. Maze walls are
rendered using a line collection while the robot is rendered using a
circle (for the body), a line (for the “head”, i.e. a line indicating
direction) and a line collection for the sensors. The overall
simulation is a matplotlib animation where the update function is
responsible for updating the bot position and sensors values.</p>
<figure class="align-default" id="id127">
<a class="reference internal image-reference" href="rst/beyond/tinybot.pdf"><img alt="rst/beyond/tinybot.pdf" src="rst/beyond/tinybot.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Tiny bot simulator
<span class="label">figure-tinybot</span>
(sources: <span class="source">beyond/tinybot.py</span>).</span><a class="headerlink" href="#id127" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>There is no real difficulty but the computation of sensors &amp; wall
intersection which can be vectorized using Numpy to make it fast:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">line_intersect</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">P3</span><span class="p">,</span> <span class="n">P4</span><span class="p">):</span>

    <span class="n">p1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
    <span class="n">p2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
    <span class="n">P3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">P3</span><span class="p">)</span>
    <span class="n">P4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">P4</span><span class="p">)</span>

    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">p1</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">p1</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">p2</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">p2</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">X3</span><span class="p">,</span> <span class="n">Y3</span> <span class="o">=</span> <span class="n">P3</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">P3</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">X4</span><span class="p">,</span> <span class="n">Y4</span> <span class="o">=</span> <span class="n">P4</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">P4</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">D</span> <span class="o">=</span> <span class="p">(</span><span class="n">Y4</span><span class="o">-</span><span class="n">Y3</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">x2</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">X4</span><span class="o">-</span><span class="n">X3</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">y2</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span>

    <span class="c1"># Colinearity test</span>
    <span class="n">C</span> <span class="o">=</span> <span class="p">(</span><span class="n">D</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">UA</span> <span class="o">=</span> <span class="p">((</span><span class="n">X4</span><span class="o">-</span><span class="n">X3</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">y1</span><span class="o">-</span><span class="n">Y3</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">Y4</span><span class="o">-</span><span class="n">Y3</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">x1</span><span class="o">-</span><span class="n">X3</span><span class="p">))</span>
    <span class="n">UA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">UA</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">C</span><span class="p">)</span>
    <span class="n">UB</span> <span class="o">=</span> <span class="p">((</span><span class="n">x2</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">y1</span><span class="o">-</span><span class="n">Y3</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">y2</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">x1</span><span class="o">-</span><span class="n">X3</span><span class="p">))</span>
    <span class="n">UB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">UB</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">C</span><span class="p">)</span>

    <span class="c1"># Test if intersections are inside each segment</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">C</span> <span class="o">*</span> <span class="p">(</span><span class="n">UA</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">UA</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">UB</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">UB</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">UA</span><span class="o">*</span><span class="p">(</span><span class="n">x2</span><span class="o">-</span><span class="n">x1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">UA</span><span class="o">*</span><span class="p">(</span><span class="n">y2</span><span class="o">-</span><span class="n">y1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>This simulator could be easily extended with a camera showing the
environment in 3D using the renderer I introduced in chapter
<a class="reference internal" href="#chap-3d">chap-3D</a>. In the end, it is possible to write a complete simulator
in a few lines of Python. The goal is of course not to replace a real
simulator, but it comes handy to rapidly prototype an idea which is
exactly what I did to study decision making using the reservoir
computing paradigm.</p>
</section>
<section id="real-example">
<h3>Real example<a class="headerlink" href="#real-example" title="Permalink to this headline">¶</a></h3>
<p>When put together, these graphical primitives allow to draw quite
elaborated figures as shown on figure
<span class="xref std std-ref">figure-basal-ganglia</span>. This figure comes from the article <a class="reference external" href="https://arxiv.org/pdf/1710.05189.pdf">A
graphical, scalable and intuitive method for the placement and the
connection of biological cells</a> that introduces a graphical
method originating from the computer graphics domain that is used for
the arbitrary placement of cells over a two-dimensional manifold. The
figure represents a schematic slice of the basal ganglia (striatum and
globus pallidus) that has been split in four different subfigures:</p>
<ul class="simple">
<li><p><strong>Subfigure A</strong> is made of a bitmap image showing an arbitrary
density of neurons. I used a bitmap image because it is not yet
possible to render such arbitrary gradient using
matplotlib. However, I also read the corresponding SVG image to
extract the paths delimiting each structure and plot them on the
figure.</p></li>
<li><p><strong>Subfigure B</strong> represents the actual method for positioning an
arbitrary number of neurons enforcing the density represented by the
color gradient. To represent them, I used a simple scatter plot and
colored some neurons according to their input/output status.</p></li>
<li><p><strong>Subfigure C</strong> represents an interpolation of the activity of the
neurons and has been made using a 2D histogram mode. To do that, I
simply built a big array representing the whole image and I set the
activity around the neuron using a disc of constant radius. This is
only a matter of translating the 2d coordinates of the neuron to a
2D index inside the image array. I then used an <span class="code">imshow</span> to show the
result and I drew over the frontiers of each structure. This kind of
rendering helps to see the overall activity inside the structure.</p></li>
<li><p><strong>Subfigure D</strong> is probably the most complex because it involved the
computation of Voronoi cells and their intersection with the border
of the structure. Once again, the shapely library is incredibly
useful to achieve such result. Once the cell have been computed, it
is only a matter of painting them with a colormap according to their
activity. For efficiency, this is made using a poly collection.</p></li>
</ul>
<p>This is actually quite a complex example, but once you’ve written the
code, it can be adapted to any input (the SVG file in this case) such
that your final result is fully automated. Of course, the amount of
work this represents should be balanced with your actual needs. If you
need the figure only once, it is probably not worth the effort if you
can do it manually.</p>
<figure class="align-default" id="id128">
<a class="reference internal image-reference" href="rst/beyond/basal-ganglia.pdf"><img alt="rst/beyond/basal-ganglia.pdf" src="rst/beyond/basal-ganglia.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">A schematic view of a slice of the basal
ganglia. Sources availables from the <a class="reference external" href="https://github.com/rougier/spatial-computation">spatial-computation</a> repository on
GitHub. <span class="label">figure-basal-ganglia</span></span><a class="headerlink" href="#id128" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="id11">
<h3>Exercises<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p><strong>Stamp like effect</strong> <a class="reference external" href="https://matplotlib.org/stable/gallery/shapes_and_collections/fancybox_demo.html">Fancy boxes</a> offer several style that can be used to achieve different effect as shown on figure <span class="xref std std-ref">figure-mona-lisa-stamp</span>. The goal is to achieve the same effect.</p>
<figure class="align-default" id="id129">
<a class="reference internal image-reference" href="rst/beyond/stamp.png"><img alt="rst/beyond/stamp.png" src="rst/beyond/stamp.png" style="width: 75%;" /></a>
<figcaption>
<p><span class="caption-text">Mona Lisa stamp
<span class="label">figure-mona-lisa-stamp</span>
(sources: <span class="source">beyond/stamp.py</span>).</span><a class="headerlink" href="#id129" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p><strong>Radial Maze</strong> Try to redo the figure <span class="xref std std-ref">figure-radial-maze</span> which
displays a radial maze (that is used quite often in neuroscience to
study mouse or rat behavior) and a simulated path representing a rat
exploring the maze (this has been generated by recording the
(computer) mouse movements). The color of each block represents the
occupancy rate, that is, the number of recorded point inside the
block.</p>
<figure class="align-default" id="id130">
<a class="reference internal image-reference" href="rst/beyond/radial-maze.pdf"><img alt="rst/beyond/radial-maze.pdf" src="rst/beyond/radial-maze.pdf" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Radial maze
<span class="label">figure-radial-maze</span>
(sources: <span class="source">beyond/radial-maze.py</span>).</span><a class="headerlink" href="#id130" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p></p>
</section>
</section>
</section>
<section id="showcase">
<h1>Showcase<a class="headerlink" href="#showcase" title="Permalink to this headline">¶</a></h1>
<p id="chap-showcase">Showtime.</p>
<p>
</p>
<p><strong>Filled contours with dropshadows</strong> is a nice effet that allows you
to use a sequential colormap (here Viridis) while distinguishing
positive and negative values. If you look closely at the figure, you
can see that the drop shadow is external for positive values and
internal for negative values. To achieve this result, the contours
need to be rendered individually twice. In the first pass, I render a
contour offscreen and read the resulting image into an array. I then
use a Gaussian filter to blur it a bit and transform the image to make
it full black but the alpha channel. I can then display the image
using imshow and it will gracefully blend with elements already
presents in the figure. I then add the same contour using the colormap
and I iterate the process. The trick is to start from bottom to top
such that dropshadows remain visible.</p>
<p><strong>Sources:</strong> <span class="source">showcases/contour-dropshadow.py</span></p>
<p>
</p>
<p><strong>Domain coloring</strong> is a “technique for visualizing complex functions
by assigning a color to each point of the complex plane. By assigning
points on the complex plane to different colors and brightness, domain
coloring allows for a four dimensional complex function to be easily
represented and understood. This provides insight to the fluidity of
complex functions and shows natural geometric extensions of real
functions” <a class="reference external" href="https://en.wikipedia.org/wiki/Domain_coloring">[Wikipedia]</a>.  On the figure on
the left, I represented the imaginary function <span class="math notranslate nohighlight">\(z +
\nicefrac{1}{z}\)</span> in the domain <span class="math notranslate nohighlight">\([-2.5, 2.5]^2\)</span>. I used the angle
of the (complex) result for setting the color and the absolute cosine
of the norm for modulating it periodically.  I could have used a cyclic
colormap such as <span class="code">twilight</span> but I think the <span class="code">Spectral</span> is visually
more pleasant, even though it induces some discontinuities. To draw
the grid, I used a contour plot using integer values in the real and
imaginary domain.</p>
<p><strong>Sources:</strong> <span class="source">showcases/domain-coloring.py</span></p>
<p>
</p>
<p><strong>Escher like projections</strong> can be obtained using the complex exponential
function and some specific periods that can be computed quite
easily. To do the figure on the left, I mostly followed explanations
given by Craig S. Kaplan, professor at the University of Waterloo on
his blog post <a class="reference external" href="https://isohedral.ca/escher-like-spiral-tilings/">Escher-like Spiral Tilings (2019)</a>. The only
difficulty in making this figure is line thickness. If you compare this
figure with the previous one, you may have noticed that in the
previous figure, lines have a constant thickness while in this figure,
thickness varies. To achieve such effect, we have to use a polygon
made of several segment with varying thickness. This poses no real
difficulty, only some geometrical computations.</p>
<p><strong>Sources:</strong> <span class="source">showcases/escher.py</span></p>
<p>
</p>
<p><strong>Self-organizing map</strong> (SOM) “is a type of artificial neural network
that is trained using unsupervised learning to produce a
low-dimensional (typically two-dimensional), discretized
representation of the input space of the training samples, called a
map, and is therefore a method to do dimensionality reduction”
<a class="reference external" href="https://en.wikipedia.org/wiki/Self-organizing_map">[Wikipedia]</a>. I
developed with Georgios Detorakis a <a class="reference external" href="https://arxiv.org/pdf/2011.09534.pdf">randomized self-organizing map</a> based on blue noise
distribution of neurons. The figure on the left shows the
self-organisation of the map when fed with random RGB colors. The
figure itself is made of a polygon collection where each polygon is
painted with the color of the neuron. No real difficuly but I had to
take care fo disabling antialias, else, thin lines appear
between polygons.</p>
<p><strong>Sources:</strong> <a class="reference external" href="https://github.com/rougier/VSOM">github.com/rougier/VSOM</a></p>
<p>
</p>
<p><strong>Waterfall plot</strong> “is a three-dimensional plot in which multiple
curves of data, typically spectra, are displayed
simultaneously. Typically the curves are staggered both across the
screen and vertically, with ‘nearer’ curves masking the ones
behind. The result is a series of “mountain” shapes that appear to be
side by side. The waterfall plot is often used to show how
two-dimensional information changes over time or some other variable”
<a class="reference external" href="https://en.wikipedia.org/wiki/Waterfall_plot">[Wikipedia]</a> To do
the figure, I used a 3D axis and polygons (i.e. not filled plot). The
reason to use polygon is to obtain the color gradient effect on each
curve. The only way to do that (to the best of my knowledge), is to
slice horizontally each curve in several stripes and to render the
slice using a specific color. The difficulty is to compute those
irregular slices and this is the reason I use the <a class="reference external" href="https://github.com/Toblerity/Shapely">Shapely library</a> that allows, among many other
things, to compute the intersection between polygons.</p>
<p><strong>Sources:</strong> <span class="source">showcases/waterfall-3d.py</span></p>
<p>
</p>
<p><strong>Streamlines</strong> are a “family of curves that are instantaneously
tangent to the velocity vector of the flow. These show the direction
in which a massless fluid element will travel at any point in time”
<a class="reference external" href="https://en.wikipedia.org/wiki/Streamlines,_streaklines,_and_pathlines">[Wikipedia]</a>. The
figure on the left shows such stream lines and is actually a still
from an animation. Each streamline has been split into line segments
and gathered in a line collection such that each segment has its own
color. From there, it is easy to suggest stream direction using
gradients. Note that I could have used a single line collection for
all streamlines. Strangely enough, the only difficulty in this figure
are the line round caps. For the reason explained <a class="reference external" href="https://stackoverflow.com/questions/11578760">here</a>, I had to create a
specific graphic context such as to have round caps.</p>
<p><strong>Sources:</strong> <span class="source">showcases/windmap.py</span></p>
<p>
</p>
<p>The <strong>Mandelbrot set</strong> “is the set of complex numbers <span class="math notranslate nohighlight">\(c\)</span> does not diverge when
iterated from <span class="math notranslate nohighlight">\(z = 0\)</span>, i.e., for which the sequence
<span class="math notranslate nohighlight">\(f_{c}(0)\)</span>, <span class="math notranslate nohighlight">\(f_{c}(f_{c}(0))\)</span>, etc., remains bounded in
absolute value <a class="reference external" href="https://en.wikipedia.org/wiki/Mandelbrot_set">[Wikipedia]</a>.  To plot the figure
on the left, I used a regular imshow with shading and normalized
recounts that is explained on this post <a class="reference external" href="https://linas.org/art-gallery/escape/smooth.html">Smooth Shading for the
Mandelbrot Exterior</a>. The script is
also present in the matplotlib gallery which I contributed some years
ago.</p>
<p><strong>Sources:</strong> <span class="source">showcases/mandelbrot.py</span></p>
<p>
</p>
<p>This <strong>recursive Voronoi set</strong> has been quite painful to design
because it requires some quite precise settings to obtain what I think
is a beautiful result. These settings are the placement of random
points with good visual properties and for that, I use the <a class="reference external" href="https://www.cct.lsu.edu/~fharhad/ganbatte/siggraph2007/CD2/content/sketches/0250.pdf">Fast
Poisson Disk Sampling</a>
by Robert Bridson which is simple and fast. I also use quite
extensively the shapely library to clip he different polygons and I
discovered in the meantime how to draw random points inside a
polygon. Finally, I played with lines thickness, polygons color and
transparency to achieve this result, involving 5 levels of
recursion. On my computer, it takes around 1 minute to compute.</p>
<p><strong>Sources:</strong> <span class="source">showcases/recursive-voronoi.py</span></p>
<p>
</p>
<p>A <strong>3D heightmap</strong> of Mount St Helens after it exploded. This has been
made with my <a class="reference external" href="https://github.com/rougier/matplotlib-3d">experimental 3D axis</a>. Nothing really
complicated here, just a bit slow because it needs to sort a bunch of
triangles.</p>
<p>
</p>
<p>This <strong>Voronoi mosaic</strong> is based on blue noise distribution where each
Voronoi cell has been painted according to the color of the center of
the Voronoi cell in the original image. This results in a cheap
stained glass window effect.</p>
<p><strong>Sources:</strong> <span class="source">showcases/mosaic.py</span></p>
<p>
</p>
<p>This <strong>shadowed text</strong> is harder to design than it seems. I started
from a text path object and iterated over the segments composing the
path in order to create sheared rectangles that constitute the shadow. To
make the shadow disappear in the background, I created an image with a
vertical gradient using semi-transparent color (fully transparent on
top and fully opaque on the bottom). This results in a nice fading
shadow effect.</p>
<p><strong>Sources:</strong> <span class="source">showcases/text-shadow.py</span></p>
<p>
</p>
<p>This <strong>spiral text</strong> has been made using an <a class="reference external" href="https://en.wikipedia.org/wiki/Archimedean_spiral">Archimedean spiral</a> (<span class="math notranslate nohighlight">\(r =
a + b\theta\)</span>) that guarantees a constant speed along a line that
rotates with constant angular velocity. Said differently, successive
turnings of the spiral have a constant separation distance. Starting
from a very long text path representing some of the decimals of pi
(using the <a class="reference external" href="https://github.com/fredrik-johansson/mpmath">mpmath</a>
library), it’s then only a matter of transforming the vertices to
follow the spiral.</p>
<p><strong>Sources:</strong> <span class="source">showcases/text-spiral.py</span></p>
<p></p>
</section>
<section id="conclusion">
<h1>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h1>
<p id="chap-conclusion"></p>
<p>You’ve now reached the end of this book that took me nearly two years
to write, mostly due to the pandemic that slowed down things quite a
bit. I’m not totally satisfied with the result because there is a
lot of features I wanted to introduce but I’ve never found the time to
do so and the book had to be released at some point. This will be
included in the second edition, depending how the first edition is
perceived by the community.</p>
<p>In any case, I hope you’ll find the book useful for your own work and
spread the word if you like it. If you want to support my work, you
can buy a printed edition on Amazon.</p>
<p></p>
</section>
<section id="appendix">
<h1>Appendix<a class="headerlink" href="#appendix" title="Permalink to this headline">¶</a></h1>
<p></p>
<section id="external-resources">
<span id="chap-resources"></span><h2>External resources<a class="headerlink" href="#external-resources" title="Permalink to this headline">¶</a></h2>
<p>One of the strength of matplotlib is the extensive documentation available from
the website. But there is also a large set of external resources that are
incredibly useful when you’re looking to design a specific figure:</p>
<ul>
<li><p>The matplotlib documentation is the primary source of information whenever
you need to know the parameters of this or that function. It has also a very
well written set of tutorials that are worth to be read:</p>
<ul class="simple">
<li><p>The <a class="reference external" href="https://matplotlib.org/tutorials/introductory/usage.html">starter guide</a> helps you to get started with Matplotlib</p></li>
<li><p>The <a class="reference external" href="https://matplotlib.org/tutorials/introductory/pyplot.html">pyplot tutorial</a> is an introduction to the <span class="code">pyplot</span> interface</p></li>
<li><p>The <a class="reference external" href="https://matplotlib.org/tutorials/introductory/images.html">image tutorial</a> explains the basic of image display</p></li>
<li><p>The <a class="reference external" href="https://matplotlib.org/tutorials/introductory/sample_plots.html">catalogue</a> shows some neat and standard visualizations</p></li>
<li><p>The <a class="reference external" href="https://matplotlib.org/faq/index.html">frequently asked questions</a> are worth a read</p></li>
</ul>
</li>
<li><p>Online help is available from two mailing lists (users and
developers) and from stack overflow which has a dedicated matplotlib
tag and a lot of questions have been asked and answered:</p>
<blockquote>
<div><ul class="simple">
<li><p>The <a class="reference external" href="https://mail.python.org/mailman/listinfo/matplotlib-users">matplotlib users mailing list</a></p></li>
<li><p>The <a class="reference external" href="https://mail.python.org/mailman/listinfo/matplotlib-devel">matplotlib developers mailing lists</a></p></li>
<li><p><a class="reference external" href="https://stackoverflow.com/questions/tagged/matplotlib">Stack overflow</a> (more than 40,000 questions related to matplotlib)</p></li>
</ul>
</div></blockquote>
</li>
<li><p>There exist various galleries online among which the matplotlib gallery that
is probably the best gallery to start with. The other galleries are worth a
look because they explain the rationale for each kind of plot:</p>
<ul class="simple">
<li><p>The <a class="reference external" href="https://matplotlib.org/gallery.html">Matplotlib Gallery</a> is probably the best resource if you’re looking
for how to do a specific figure. Just search for the closest example and
get the code.</p></li>
<li><p>The <a class="reference external" href="https://datavizcatalogue.com/">Data Visualization Catalogue</a> is a project developed by Severino
Ribecca to create a library of different information visualisation types.</p></li>
<li><p>The <a class="reference external" href="https://python-graph-gallery.com/">Python Graph gallery</a> displays hundreds of charts and aims to
showcase the awesome dataviz possibilities of Python.</p></li>
<li><p>The <a class="reference external" href="https://www.r-graph-gallery.com/">R Graph Gallery</a> is a collection of charts made displayed in several
sections, always with their (R) reproducible code available.</p></li>
</ul>
</li>
<li><p>Finally, there exists many books about matplotlib and data visualization. I
selected only a few of them that are well written and open access. You can
find them in the <span class="nameref">chap-bibliography</span> appendix.</p></li>
</ul>
<p></p>
</section>
<section id="quick-references">
<span id="chap-cheatsheets"></span><h2>Quick References<a class="headerlink" href="#quick-references" title="Permalink to this headline">¶</a></h2>
<p>Here are cheatsheets and handouts I’ve designed for Matplotlib. They
are also available in A4 format at <a class="reference external" href="https://github.com/matplotlib/cheatsheets">github.com/matplotlib/cheatsheets</a>.</p>
<p>






</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">scientific-visualization</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="anatomy.html">Anatomy of a figure</a></li>
<li class="toctree-l1"><a class="reference internal" href="animation.html">Animation</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, rougier et al.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.3.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/rst/main.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>